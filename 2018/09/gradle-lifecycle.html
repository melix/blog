<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog: Gradle myth busting: lifecycle</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		<li><a href="/blog/projects.html">Projects</a></li>
		<li><a href="/blog/astronomy.html">Astronomy</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
				<li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://twitter.com/CedricChampeau"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">
	
	<div class="page-header">
		<h1>Gradle myth busting: lifecycle</h1>
	</div>

	<p><em>11 September 2018</em></p>
	<p><em>Tags: </em>
		<a href="/blog/tags/gradle.html">gradle</a> 
	</em>
		<a href="/blog/tags/maven.html">maven</a> 
	</em>
		<a href="/blog/tags/lifecycle.html">lifecycle</a> 
	</p>
	<p><div class="sect1">
<h2 id="_the_build_lifecycle">The build lifecycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There&#8217;s a very common misconception I read from Maven users about Gradle: that there&#8217;s no default lifecycle. Not only this is <a href="https://scans.gradle.com/s/alokg5xymahwa/timeline?task=345te4gku5gw4" target="_blank" rel="noopener">wrong</a>, but actually the Gradle lifecycle is significanly richer.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s explain in a few words what the lifecycle is in Maven. Detailed explanations can be found <a href="https://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html" target="<em>blank">here</a>, but in a nutshell, the idea is that _any</em> build will always consist in a sequence of phases, and that each phase is built on top of the previous one. This has the advantage of being simple to explain: to deploy an application, you first need compile it, run the tests, package it, perform validation (checkstyle, &#8230;&#8203;) and deploy. Let me ignore <em>install</em> which is an artifact of how Maven works.</p>
</div>
<div class="paragraph">
<p>Maven plugins attach themselves to those lifecycle phases, and define goals on different phases. For example, a code generator would attach itself to the <code>generate-sources</code> phase, and define a <em>goal</em> that runs at this phase. Fun begins when you have dependencies between the goals, and ordering matters&#8230;&#8203; Anyway, the general idea is that if you want to get the outcome of, say, packaging, you have to execute all previous phases and consequently all goals that are defined on those phases. The other consequence is that the Maven lifecycle is biased towards the Java model, and more specifically, building Java libraries. It&#8217;s even clearer when you think about the term <code>deploy</code>, which doesn&#8217;t mean "deploy this application on production", but "push this jar on the external Maven repository". Similarly "install" doesn&#8217;t mean "install this application on my laptop", but "copy this library into my local .m2 repository". This, I would argue, is rather counter-intuitive&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Gradle, on the other hand, is a generic build tool. It&#8217;s aimed at the Java ecosystem, but also the native one, the Android ecosystem, Python, Go, &#8230;&#8203; It doesn&#8217;t matter. All of those ecosystems have an underlying model, and the way you build applications or libraries in each of those ecosystems is different. Gradle offers the APIs to <em>model the builds</em> of each ecosystem. This flexibility is often what troubles Maven users, and makes them think there&#8217;s no lifecycle, but it&#8217;s not true.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_goals_vs_tasks">Goals vs tasks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To understand why, we need to explain that Gradle model is not <em>phase</em> based, but <em>task</em> based. It&#8217;s a bit like what Ant did, but the similarity stops there. While Ant didn&#8217;t define <em>any</em> convention, <em>any</em> lifecycle, and everything was different from one build to the other, this is not true with Gradle. By default, if you apply this "Java library" plugin, you&#8217;ll get <em>all the conventions you find with Maven</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="prettyprint highlight"><code>plugins {
   id 'java-library'
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the minimal build file you need to build, test and package a Java library with Gradle, with the same conventions as Maven <code>src/main/java</code>, &#8230;&#8203; By applying this plugin, Gradle internally applies a sequence of plugins, which, in turn, would define new tasks, and more specifically for the topic of this blog post, <em>lifecycle tasks</em>.</p>
</div>
<div class="paragraph">
<p>In Gradle, a task is responsible for executing a unit of work. For example, "compile this source set". A task has inputs (the source files) and outputs (the class files). But a task also has <em>dependencies</em>. In particular, dependencies on other tasks. Gradle makes sure that a task graph is a DAG (direct, acyclic graph). This means that if you run <code>compile</code> on the command-line, what Gradle does is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>compute the task dependencies of <code>compile</code></p>
</li>
<li>
<p>execute the tasks <em>in order</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Task dependencies can be explicit (say, <code>compile.dependsOn(compileJava)</code>), or implicit (because you add a source set as an input, <strong>and</strong> that this source set is generated by another task, then we know we need to run the code generation <em>for this source set</em> before). This model is nice because it&#8217;s significantly more fine grained than the phase one. When you execute a task, Gradle will always perform the minimal amount of work required to get the output of this task. Let&#8217;s illustrate with an example: say you want to run the unit tests of your library. You would run the <code>test</code> task with Gradle. Gradle would then determine that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it needs to compile the sources of the library (<code>compileJava</code>)</p>
</li>
<li>
<p>but the sources includes a generated source set, so it needs to execute it (<code>generateSources</code>)</p>
</li>
<li>
<p>it would also find that the "resources" are an input of the test classpath, so execute the <code>processResources</code> task</p>
</li>
<li>
<p>etc&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>But, in the end, it would <em>not</em> generate the jar file. Because Gradle knows that to run the tests, there&#8217;s no need to get the jar: we can build a classpath that consists of the generated classes and the resources directories. It&#8217;s actually very easy to figure out what the task dependencies are by running with <code>--dry-run</code>, or using a <a href="https://scans.gradle.com/s/mfihmuxqj2b2u/dependencies?focusedDependency=WzE3LDEsNTgsWzE3LDEsWzIzNiw1OF1dXQ&amp;toggled=W1s4XSxbMTddLFsxNywxXSxbMTcsMSxbMjM2XV1d" target="_blank" rel="noopener">build scan</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_so_will_you_tell_me_what_the_lifecycle_of_gradle_is_then">So, will you tell me what the lifecycle of Gradle is then?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is the trick. With Gradle, everything boils down to tasks, which are a bit like functions, with inputs and outputs. But there are special kinds of tasks, that we call "lifecycle tasks", which are <em>binding other tasks together</em>. They, effectively, produce no output individually. Their only role is to have dependencies on other tasks, so that we have nice shortcuts to produce our outputs. For example, the <code>check</code> task is a lifecycle task which has dependencies on the <code>test</code> task, but also the <code>checkstyle</code> task, etc&#8230;&#8203; Plugins are free to add dependencies to the <code>check</code> task, and <em>enrich</em> the check lifecycle this way. But even better, by defining dependencies between tasks like that, and clearly defining the inputs and outputs of each task, we make it possible to get <em>correct</em> incremental builds, as well as <em>caching</em> (and no, this <a href="https://docs.gradle.org/current/userguide/build_cache.html" target="_blank" rel="noopener">has nothing to do with <code>~/.m2</code></a>).</p>
</div>
<div class="paragraph">
<p>The good news is that because lifecycle tasks are just regular tasks, it means they can also depend on each other, and you can build your own lifecycle tasks. It becomes very easy to model your build production pipeline. So here is a simple correspondance matrix for Maven users, for the Java library plugin:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Lifecycle correspondance matrix</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Maven</th>
<th class="tableblock halign-left valign-top">Gradle</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes the outputs of tasks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates the classes from source files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executes unit tests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assemble</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a jar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">verify</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs all tests, integration tests, quality checks, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">install</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">publishToMavenLocal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gradle doesn&#8217;t need a local repository, but should you need Maven interoperability, you can add the <code>maven-publish</code> plugin to add this task</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deploy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">publishToMavenRepository</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This tasks is <em>not</em> available by default, as it depends on which type of repository you deploy to. In general you just apply the <code>maven-publish</code> plugin to add this task</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>But remember: in Gradle, tasks depend on each other. So it means that if you run a lifecycle task, <em>only the tasks required for that specific target are going to be executed</em>. Nothing more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_see_us_at_devoxx_belgium">See us at Devoxx Belgium!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to discover more of the differences between Gradle and Maven, come see my colleague Louis Jacomet and I during Devoxx Belgium, we&#8217;re giving a <a href="https://dvbe18.confinabox.com/talk/UAH-5130/Switching_to_Gradle:_maturity,_performance,_and_pleasure!" target="_blank" rel="noopener">deep dive into Gradle</a> where we&#8217;re going to cover what is explained here, and much more!</p>
</div>
</div>
</div></p>
   


<div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'melixblog';
	var disqus_identifier = 'gradle-lifecycle-tasks';
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">&copy; 2013 | Mixed with <a href="https://twitter.github.com/bootstrap/">Bootstrap v3.0.3</a> | Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
   <script>hljs.highlightAll();</script>
    <script type="text/javascript">
    var disqus_shortname = 'melixblog';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
<script type="text/javascript">
  window.___gcfg = {lang: 'fr'};

  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45962373-1', 'melix.github.io');
  ga('send', 'pageview');

</script>
  </body>
</html>
