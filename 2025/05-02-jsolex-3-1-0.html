<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog: Jagged Edges Correction with JSol&#8217;Ex 3.1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
    <script defer data-domain="melix.github.io" src="https://analytics.champeau.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		          <li><a href="/blog/projects.html">Projects</a></li>
				    <li><a href="/blog/jsolex.html">JSol'Ex</a></li>
		<li><a href="/blog/astrophotography.html">Astrophotography</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
		          <li><a href="/blog/tags/jsolex.html">JSol'Ex</a></li>
				    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://bsky.app/profile/melix.champeau.me"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">
	
	<div class="page-header">
		<h1>Jagged Edges Correction with JSol&#8217;Ex 3.1</h1>
	</div>

	<p><em>02 mai 2025</em></p>
	<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	</em>
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	</em>
		<a href="/blog/tags/solar.html">solar</a> 
	</em>
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	</p>
	<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
<div class="paragraph">
<p>I&#8217;m happy to announce the release of JSol&#8217;Ex 3.1, which ships with a long awaited feature: jagged edges correction! Let&#8217;s explore in this article what this is about.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_dreaded_jagged_edges">The dreaded jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spectroheliographs like the Sol&#8217;Ex or the Sunscan are not using a traditional imaging system like, for example, in planetary imaging, where you can capture dozens to hundreds of frames per second and do the so called "lucky imaging" to get the best frames and stack them together to get a high resolution image.</p>
</div>
<div class="paragraph">
<p>In the case of a spectroheliograph, the image is built by scanning the solar disk in a series of "slices" of the sun: it takes several seconds and sometimes minutes (~3 minutes when you let the sun pass "naturally" through the slit) to get a full image of the sun.</p>
</div>
<div class="paragraph">
<p>In practice, this means that between each frame, each "slice" of the sun, the atmosphere will have slightly moved, causing some misalignment between the frames.
This is also particularly visible when there is some wind, which can cause the telescope to shake a bit, and the image to be misaligned.
Lastly, you may even have a mount which is not perfectly balanced, or which has some resonance at certain scan speeds.</p>
</div>
<div class="paragraph">
<p>As an illustration, let&#8217;s take this image captured using a Sunscan (courtesy of Oscar Canales):</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/original.jpg" alt="original">
</div>
</div>
<div class="paragraph">
<p>This image shows 3 problems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the jagged edges, which cause some unpleasant "spikes" on the edges of the sun</p>
</li>
<li>
<p>misalignment of features of the sun, particularly visible on filaments</p>
</li>
<li>
<p>a disk which isn&#8217;t perfectly round</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These issues are typical of spectroheliographs, and are the main limiting factor when it comes to achieving high resolution images.
Therefore, excellent seeing conditions are a must to get high quality images.
Even if you do stacking, the fact that the reference image will show spikes is often a problem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_correcting_jagged_edges">Correcting jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with release 3.1.0, JSol&#8217;Ex ships with an <strong>experimental</strong> feature to correct jagged edges.
It is not perfect yet, but good enough for you to provide feedback and even improve the quality of your images.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the same image, but with jagged edges correction applied:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/corrected.jpg" alt="corrected">
</div>
</div>
<div class="paragraph">
<p>And so that it&#8217;s even easier to see the difference, here&#8217;s a blinking animation of the two images:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/blink.gif" alt="blink">
</div>
</div>
<div class="paragraph">
<p>The jagged edges are now mostly gone, the features in the sun are better aligned, and the image is much more pleasant to look at.
There is still some jagging visible, the correction will never be perfect, but it is a good start.</p>
</div>
<div class="paragraph">
<p>In particular, you should be careful when applying the correction, because it could cause some artifacts in the image, in particular on prominences.
As usual, with great powers comes great responsibilities!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_does_it_work">How does it work?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To illustrate how the correction works, let&#8217;s imagine a perfect scan: a scan speed giving us a perfectly circular disk, no turbulence, no wind, etc.</p>
</div>
<div class="paragraph">
<p>In this case, what we would see during the scan is a spectrum which width slowly increases, reaches a maximum, and then decreases.
The pace at which the width increases and decreases is determined by the scan speed and is predictable.
In particular, the left and right borders of the spectrum will follow a circular curve.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get back to a "real world" scan.
In that case, the left and right edges will slightly deviate from the circular curve.
They will also follow the path of an ellipse: in fact, this ellipse is already required in order to perform geometric correction.</p>
</div>
<div class="paragraph">
<p>The idea is therefore quite simple in theory: we need to detect the left and right edges of the spectrum, then compare them to the ideal ellipse that we have computed.
Pixels which deviate from this curve give us an information about the jagged edges.
We can then compute a distortion map, which will be used to correct the image.</p>
</div>
<div class="paragraph">
<p>In practice, we also need to apply some filtering of samples: in practice, while the detection of edges is robust enough to provide us with a good geometric correction, it is not perfect.
It can also be skewed by the presence of proms for example.
Therefore, we are performing a sigma clipping on the detected edges, in order to remove outliers, that is to say pixels which deviate too much from the average deviation.</p>
</div>
<div class="paragraph">
<p>This is also why the correction will not work properly if the image is not focused correctly: you would combine two problems in one, and the correction would not be able to detect the edges properly.</p>
</div>
<div class="paragraph">
<p>In addition, in the image above you can see that the bottom most prominence is slightly distorted, which is caused by the fact that it&#8217;s far away from the 2 points which were used to compute the distortion.
It may be possible to reduce such artifacts by using a smaller sigma factor (at the risk of undercorrecting edges).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this blog post, I have described the new jagged edges correction feature in JSol&#8217;Ex 3.1.
This solves one of the most common issues users are having with spectroheliographs, and I hope it will help you get better images.
However, as usual, it&#8217;s a work in progress, so do not hesitate to provide feedback!</p>
</div>
</div>
</div></p>
   
	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
   <script>hljs.highlightAll();</script>
  </body>
</html>
