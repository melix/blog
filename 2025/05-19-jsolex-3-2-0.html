<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog: Ellerman Bombs Detection with JSol&#8217;Ex 3.2</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../favicon.ico">
    <script defer data-domain="melix.github.io" src="https://analytics.champeau.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		          <li><a href="/blog/projects.html">Projects</a></li>
				    <li><a href="/blog/jsolex.html">JSol'Ex</a></li>
		<li><a href="/blog/astrophotography.html">Astrophotography</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
		          <li><a href="/blog/tags/jsolex.html">JSol'Ex</a></li>
				    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://bsky.app/profile/melix.champeau.me"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">
	
	<div class="page-header">
		<h1>Ellerman Bombs Detection with JSol&#8217;Ex 3.2</h1>
	</div>

	<p><em>17 mai 2025</em></p>
	<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	</em>
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	</em>
		<a href="/blog/tags/solar.html">solar</a> 
	</em>
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	</em>
		<a href="/blog/tags/ellerman.html">ellerman</a> 
	</em>
		<a href="/blog/tags/bombs.html">bombs</a> 
	</p>
	<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
</div>
</div>
<div class="sect1">
<h2 id="_about_ellerman_bombs">About Ellerman Bombs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ellerman bombs were first described by Ferdinand Ellerman back in 1917.
Ellerman&#8217;s article was named -Solar Hydrogen "Bombs"- and it&#8217;s only later that these were commonly referred to as "Ellerman bombs".</p>
</div>
<div class="paragraph">
<p>I came upon this term while reading <a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">an article from Sylvain or André Rondi</a> quite early in my solar imaging journey, and I was since then obsessed by these phenomena.</p>
</div>
<div class="paragraph">
<p>Ellerman Bombs are small, transient, and explosive events that occur in the solar atmosphere, particularly in the vicinity of sunspots.
These are very short lived compared to other solar features: from several dozens of seconds to a few minutes.
The most common explanation is magnetic reconnection, which occurs when two magnetic regions opposite polarity come into contact and reconnect, releasing energy in the form of heat and light.
This is for example described in <a href="https://dx.doi.org/10.1051/0004-6361/201321632">this article from González, Danilovic and Kneer</a>.</p>
</div>
<div class="paragraph">
<p>Amateur observations of Ellerman bombs are quite rare, but Rondi described such observations using a spectroheliograph back in 2005.
They are rare because they are mostly invisible where the amateur observations are made (the center of the H-alpha line), and are too small to notice.
However, these are visible in the wings of the H-alpha line: this is where a spectroheliograph comes in handy, since the cropping window that is used to capture an image contains more than just the H-alpha line.</p>
</div>
<div class="paragraph">
<p>I had a <a href="https://github.com/melix/astro4j/issues/382">long standing issue</a> to do something about it in JSol&#8217;Ex, and I finally got around to it: all it took was getting some test data to entertain the ideas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observation_of_an_ellerman_bomb">Observation of an Ellerman Bomb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I am doing many observations of the sun: I started in 2023 with a Sol&#8217;Ex, then I recently got an SHG 700, so I have accumulated quite a bit of data, which is completed by scans which are shared with me by other users of JSol&#8217;Ex.</p>
</div>
<div class="paragraph">
<p>I have been looking for Ellerman bombs in my data, but I never found any yet.
This changed a couple weeks ago: I was doing some routine work on JSol&#8217;Ex and using a capture I had done in April, 29, 2025 at 08:32 UTC, when I noticed, by accident, a bright spot in the continuum image:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/continuum.jpg" alt="continuum">
</div>
</div>
<div class="paragraph">
<p>It may not be obvious at first, which is precisely why these are hard to spot, so here&#8217;s a hint:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/zoom-continuum.png" alt="zoom continuum">
</div>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex offers the ability to easily generate animations of the data captured at different wavelengths, so I generated a quick animation, which shows the same image at ±2.5Å from the center of the H-alpha line:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/anim_ellerman.gif" alt="anim ellerman">
</div>
</div>
<div class="paragraph">
<p>We can see the typical behavior of an Ellerman bomb: it is bright in the wings of the H-alpha line,  but it vanishes when we are at the center of the line.
The fine spectral dispersion of the spectroheliograph makes it possible to highlight this phenomenon very precisely.</p>
</div>
<div class="paragraph">
<p>The corresponding frame of the SER file shows the aspect of the Ellerman bomb in the spectrum:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-spectrum.png" alt="ellerman spectrum">
</div>
</div>
<div class="paragraph">
<p>The shape that you can see is often referred to as the "moustache".
At this stage I was pretty sure I had observed my first Ellerman bomb, and that I could implement an algorithm to detect it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_3_2_auto_detection">JSol&#8217;Ex 3.2 auto-detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSol&#8217;Ex 3.2 ships with a new feature to automatically detect Ellerman bombs in the data.
Currently, it is limited to H-alpha, but it should be possible to detect these in CaII as well.</p>
</div>
<div class="paragraph">
<p>The algorithm I implemented uses statistical analysis of the spectrum to match the characteristics of the "moustache" shape, in particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a maximum of intensity around 1Å from the center of the line</p>
</li>
<li>
<p>a distance which spreads up to 5Å from the center of the line</p>
</li>
<li>
<p>a brightening which is only visible in the wings of the line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex will generate, for each detection, an image showing the location of the detected bombs:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-location.jpg" alt="ellerman location">
</div>
</div>
<div class="paragraph">
<p>And for each bomb, it will create an image which shows the region of the spectrum which is used to detect the bomb.
This is for example what is automatically generated for the bomb described above:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/spectrum-detection.jpg" alt="spectrum detection">
</div>
</div>
<div class="sect2">
<h3 id="_algorithm_details">Algorithm details</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a description of the algorithm that I implemented in an <em>adhoc</em> fashion: I&#8217;m not a mathematician nor a scientist: I&#8217;m an engineer and the algorithm above was implemented using my "intuition" of what I thought would work. It is likely to change as new versions are released.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The algorithm is based on the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for each frame in the SER file, identify the "borders" of the sun</p>
</li>
<li>
<p>perform a Gaussian blur on the spectrum to reduce noise</p>
</li>
<li>
<p>within the borders, compute, for each column, the average intensity of the spectrum for the center of the line and the wings separately. The center of the line is defined as the range [-0.35Å, 0.35Å] and the wings as the range [-5Å, -0.35Å[ ∪ ]0.35Å, 5Å]</p>
</li>
<li>
<p>compute the maximum intensity of the wings, starting from the center of the line, and going outwards until we reach the maximum intensity (local extremum)</p>
</li>
<li>
<p>compute the average of each column average intensity for the wings (the "global average")</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Ellerman bomb scoring parameters defined below, the algorithm proceeds per column:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each column index <code>x</code> in the spectrum image:</p>
</li>
<li>
<p>Build a neighborhood of up to 16 columns around <code>x</code>:
<code>Nₓ = { x + k  |  k ∈ ℤ,  |k| ≤ 8 }</code>, clamped to the image boundaries.</p>
</li>
<li>
<p>Compute the overall mean column intensity
<code>Ī_global = (1 / N_total) ∑_{j=1..N_total} Ī(j)</code>.</p>
</li>
<li>
<p>Exclude any columns in <code>Nₓ</code> whose average intensity falls below 90 % of <code>Ī_global</code>, since very dark columns (usually sunspots) would pull down our estimate of the local wing background and hide true brightening events. Call the remaining set <code>Mₓ</code> and let <code>m = |Mₓ|</code>.</p>
</li>
<li>
<p>If <code>m &lt; 1</code>, there aren’t enough valid neighbors to form a reliable background—skip column <code>x</code>.</p>
</li>
<li>
<p>On the Gaussian-smoothed data, measure three key values at column <code>x</code>:</p>
</li>
<li>
<p><code>c₀ ≔ I_center(x)</code>, the mean intensity in the core region of the spectral line.</p>
</li>
<li>
<p><code>c_w ≔ I_wing(x)</code>, the average intensity across the two wing windows at ±1 Å.</p>
</li>
<li>
<p><code>c_max ≔ max_{p ∈ wing-pixels nearest ±1 Å} I(p, x)</code>, the single highest wing intensity near the expected shift.</p>
</li>
<li>
<p>Compute the local wing background
<code>r₀ = (1 / (m−1)) ∑_{j ∈ Mₓ, j≠x} I_wing(j)</code>.
Using only nearby “bright enough” columns keeps the background estimate from being skewed by dark features.</p>
</li>
<li>
<p>Define a line-brightening factor
<code>B = max(1, c₀ / min(r₀, I_center,global))</code>.
Ellerman bombs boost the wings without greatly brightening the core, whereas flares brighten both.</p>
</li>
<li>
<p>Form an initial score
<code>S₀ = 1 + c_max / min(r₀, I_wing,global)</code>,
where <code>I_wing,global = (1/N_total) ∑_{j=1..N_total} I_wing(j)</code>.
This compares the local wing peak to the typical wing level across the image.</p>
</li>
<li>
<p>Adjust for how many neighbors were used:
<code>S₁ = S₀ × (m / 16)</code>.
Fewer valid neighbors mean less confidence, so the score is scaled down proportionally.</p>
</li>
<li>
<p>Compute the wing-to-background ratio
<code>rᵢ = c_max / r₀</code>.
If <code>rᵢ ≤ 1.05</code>, the wing peak is too close to the local background and the column is discarded. Otherwise, we boost the score further:</p>
</li>
<li>
<p>Raise <code>S₁</code> to the power of <code>e^{rᵢ}</code>, giving
<code>S₂ = S₁^( e^{rᵢ} )</code>.
This makes the score grow quickly when the wing peak stands out strongly.</p>
</li>
<li>
<p>Multiply by <code>√(c_max / c₀)</code> to get
<code>S₃ = S₂ · √(c_max / c₀)</code>.
That emphasizes cases where the wings are much brighter than the core.</p>
</li>
<li>
<p>Finally, penalize any shift away from the ideal ±1 Å wing position. If <code>y_core</code> and <code>y_max</code> are the pixel locations of line center and wing peak, compute
<code>Δλ = |y_max – y_core| × (Å / pixel)</code>,
then
<code>S_final = S₃ / (1 + |1 Å – Δλ|)</code>.</p>
</li>
<li>
<p>If <code>S_final &gt; 12</code>, mark column <code>x</code> as a candidate event. Use the value of <code>B</code> to decide:</p>
</li>
<li>
<p>When <code>B &lt; 1.5</code>, it behaves like an Ellerman bomb (wings bright, core unchanged).</p>
</li>
<li>
<p>When <code>B &gt; 2</code>, it matches a flare (both core and wings bright).</p>
</li>
<li>
<p>If <code>1.5 ≤ B ≤ 2</code>, the result is ambiguous and ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All thresholds (0.9× global mean, 1.05 ratio, score &gt; 12, B cutoffs) were chosen by testing on data and visually inspecting results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_filtering">Post-filtering</h3>
<div class="paragraph">
<p>There will often be cases where the same bomb is detected in multiple frames.
Therefore, we need to do some merging of bombs which are spatially connected.</p>
</div>
<div class="paragraph">
<p>Eventually, we apply a limit threshold: if there are more than 5 Ellerman Bombs detected in an image, then we consider the detection to be false positives (this happens typically on saturated images, or images with too much noise).
This is a bit arbitrary, but it seems to work well in practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_data">Test data</h3>
<div class="paragraph">
<p>I had about ~1100 scans I could reuse for detection, and it successfully discovered Ellerman bombs candidates in about 10% of them.
Of course this required some tuning and several runs to get the parameters right.
This doesn&#8217;t mean that you have 10% chances of finding an Ellerman bomb in your data, because the test data I have is biased (I often do 10 to 20 scans in a row, within a few minutes, to perform stacking, so if a bomb is detected in an image, it has decent chances of being detected in the next one).
Also, I am using the term "Ellerman Bomb candidate", because there&#8217;s nothing better than visual confirmation to make sure that what you see is indeed an Ellerman bomb: an algorithm is not perfect, and it may fail for many reasons (noise, saturation, artifacts, etc.)</p>
</div>
<div class="paragraph">
<p>Here are a few examples of Ellerman bombs candidates detected in my data:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate1.jpg" alt="candidate1">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate2.jpg" alt="candidate2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate3.jpg" alt="candidate3">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate4.jpg" alt="candidate4">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate5.jpg" alt="candidate5">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate6.jpg" alt="candidate6">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post described my first visual Ellerman bomb detection.
Then I described how I implemented an algorithm to automatically detect Ellerman bombs in JSol&#8217;Ex 3.2.
I am very happy to release this to the wild, so that this kind of discovery is made more accessible to everyone.
Of course, as I always say, you should take the detections with care, and always review the results.
This is why you get both a global "map" of the detected bombs, and a detailed view of each bomb, which can be used to confirm the detection.
In addition, I recommend that you create animations of the regions, which you can simply do in JSol&#8217;Ex by CTLR+clicking on the image then selecting an area around the bomb.</p>
</div>
<div class="paragraph">
<p>Finally, I&#8217;d like to thank my friends of the Astro Club de Challans, who heard me talk about Ellerman bombs detection for a while, showing them preliminary results, and who were very supportive of my work.
Last but not least, thanks again to my wife for her patience, seeing me work on this (too) late at night!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibiography">Bibiography</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1917ApJ&#8230;&#8203;.46..298E/abstract">Ellerman, F. (1917) - Solar Hydrogen "Bombs"</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">S. Rondi, A. Rondi - Bombes d&#8217;Ellerman</a></p>
</li>
<li>
<p><a href="https://dx.doi.org/10.1051/0004-6361/201321632">N. Bello González , S. Danilovic , and F. Kneer - On the structure and dynamics of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://www.jstage.jst.go.jp/article/starsandgalaxies/6/0/6_3/_article/-char/en">R. Ichikawa, S. Nozawa - Detailed altitude analysis of Ellerman bomb using the domeless solar telescope at the Hida Observatory, Kyoto University</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1407.3048">Jie Hong, M. D. Ding, Ying Li, Cheng Fang, Wenda Cao - Spectral observations of Ellerman bombs and fitting with a two-cloud model</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1406.5702">A. Berlicki, P. Heinzel - Observations and NLTE modeling of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://adsabs.harvard.edu/full/2007ASPC..368..253P">E. Pariat, B. Schmieder, A. Berlicki., A. López Ariste - Spectrophotometry of Ellerman Bombs with THEMIS</a></p>
</li>
</ul>
</div>
</div>
</div></p>
   
	<hr>
	
		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
   <script>hljs.highlightAll();</script>
  </body>
</html>
