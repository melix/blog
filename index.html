<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">

    <!-- MathJax for LaTeX math rendering -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['\\(', '\\)']],
          displayMath: [['\\[', '\\]']],
          processEscapes: true
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <script defer data-domain="melix.github.io" src="https://analytics.champeau.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		          <li><a href="/blog/projects.html">Projects</a></li>
				    <li><a href="/blog/jsolex.html">JSol'Ex</a></li>
		<li><a href="/blog/astrophotography.html">Astrophotography</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
		          <li><a href="/blog/tags/jsolex.html">JSol'Ex</a></li>
				    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://bsky.app/profile/melix.champeau.me"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">

	<div class="page-header">
		<h1>Blog</h1>
	</div>
  			<a href="/blog/2026/02/05-measuring-solar-rotation.html"><h1>Measuring Solar Differential Rotation with JSol&#8217;Ex</h1></a>
  			<p>05 February 2026</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	
		<a href="/blog/tags/doppler.html">doppler</a> 
	
		<a href="/blog/tags/rotation.html">rotation</a> 
	</p>
			
  			<p><div class="sect1">
<h2 id="_a_rotating_ball_of_plasma">A Rotating Ball of Plasma</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One fascinating aspect of the Sun is that it doesn&#8217;t rotate like a solid body.
Unlike the Earth, which completes one rotation in 24 hours regardless of latitude, the Sun&#8217;s rotation rate varies with latitude: the equator rotates faster than the poles.
This phenomenon, called <strong>differential rotation</strong>, has been studied since the 19th century and remains an important research topic in solar physics.</p>
</div>
<div class="paragraph">
<p>The equatorial regions of the Sun complete a rotation in approximately 25 days, while near the poles, it takes about 35 days.
This differential rotation is thought to play a key role in the solar dynamo mechanism that generates the Sun&#8217;s magnetic field and drives the 11-year solar cycle.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/differential-rotation-concept.svg" alt="Differential rotation concept" width="600">
</div>
</div>
<div class="paragraph">
<p>In this blog post, I will explain how I implemented a feature in JSol&#8217;Ex 4.5.0 that allows amateur astronomers to measure this differential rotation directly from their spectroheliograph data.
A common mistake is to think that this measurement is not possible because the spectral dispersion of a SHG like the Sol&#8217;Ex is typically around 0.1 to 0.2Å, which larger than the scale of what we&#8217;re trying to measure (2 km/s, which is about 0.04Å).
In fact, what we are trying to measure requires sub-pixel precision and we can achieve that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_doppler_effect">The Doppler Effect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The principle behind the measurement is simple: the <strong>Doppler effect</strong>.
When a light source moves towards us, the wavelength is shifted towards the blue end of the spectrum (blueshift).
When it moves away, the wavelength shifts towards the red (redshift).</p>
</div>
<div class="paragraph">
<p>Since the Sun rotates, one limb is always moving towards us (let&#8217;s say the East limb) while the other is moving away (the West limb).
By measuring the wavelength shift of a spectral line at both limbs, we can calculate the rotation velocity.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/doppler-effect-sun.svg" alt="Doppler effect for measuring solar rotation" width="700">
</div>
</div>
<div class="paragraph">
<p>One might wonder about the Earth&#8217;s own motion: we orbit the Sun at approximately 30 km/s, which is much larger than the ~2 km/s solar rotation velocity we&#8217;re trying to measure.
This orbital motion does produce a Doppler shift of the entire solar spectrum.
However, this affects equally all points we can measure: this is a global shift which affects all measurements equally and cancels out.
The same is true for any radial velocity of the Sun relative to the Earth (which varies slightly throughout the year as Earth&#8217;s orbit is elliptical).</p>
</div>
<div class="paragraph">
<p>The fundamental formula relating Doppler shift to velocity is:</p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\Delta\lambda}{\lambda_0} = \frac{v}{c}\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\Delta\lambda\) is the wavelength shift</p>
</li>
<li>
<p>\(\lambda_0\) is the rest wavelength of the spectral line (typically the H-alpha wavelength)</p>
</li>
<li>
<p>\(v\) is the velocity along the line of sight</p>
</li>
<li>
<p>\(c\) is the speed of light (299,792 km/s)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_measurement_methodology">The Measurement Methodology</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_previous_work">Previous Work</h3>
<div class="paragraph">
<p>I am not the first person to try to make this measurement in amateur spectroheliography.
In 2017, Peter Zetner <a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">explained on CloudyNights</a> how to measure differential velocity using a spectroheliograph.
He explained this methodology in depth in the <a href="https://solar-astronomy-book.com/">Solar Astronomy - Observing, imaging and studying the Sun</a> book.
His methodology relies on measurements using the Na D2 line, but can also be applied on other bright lines including the commonly used Fe I line at 5250.2 Å, and involves comparing the pixel intensities, by averaging them at different latitudes.
The best results are obtained by performing several scans and averaging data.
While this works, I wanted to try a different methodology:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a single scan: the Doppler images that JSol&#8217;Ex or INTI can produce are in general very consistent and show that all the data we need is already present</p>
</li>
<li>
<p>Avoid pixel intensities: these are very sensitive to limb darkening, observing conditions (e.g clouds, even if thin) or vignetting (darkening of the images along the slit)</p>
</li>
<li>
<p>Make it possible to use H-alpha scans, not because they would give an accurate value of the velocity of the photosphere plasma, but because that&#8217;s the most widely imaged line in amateur solar observations</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The results, of course, will depend on the observed line.
The methodology that I describe below is capable of returning reasonable results on several lines (H-alpha, Na D2, Fe I) but will completely fail on some others (e.g Ca II K, typically because the line is too wide).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s dive into the methodology.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The implementation described here was developed iteratively based on real observations. I&#8217;m not a solar physicist, just an engineer trying to extract meaningful data from spectroheliograph captures. The algorithm works reasonably well in practice but should be validated against professional measurements for any scientific application. Therefore why it is advertised as experimental.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_east_west_limb_comparison">East-West Limb Comparison</h3>
<div class="paragraph">
<p>The key to understanding the methodology is that it relies on spectral line profile analysis and fitting.
It requires extracting the spectral line profiles at different locations of the solar disk, preferably near the limbs where the velocities are highest.</p>
</div>
<div class="paragraph">
<p>The differential rotation measurement extracts solar rotation velocities by comparing Doppler shifts between East and West limb points at the same heliographic latitude.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/spectral-profiles.svg" alt="Doppler Shifted Profiles" width="500">
</div>
</div>
<div class="paragraph">
<p>For each latitude (say, 20° North), the algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selects a point on the East limb</p>
</li>
<li>
<p>Selects the corresponding point on the West limb at the same latitude</p>
</li>
<li>
<p>Measures the spectral line position at each point</p>
</li>
<li>
<p>Computes the difference: West - East</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This differential approach has a crucial advantage: it cancels out systematic errors.
Any instrumental offset, wavelength calibration error, or baseline shift affects both measurements equally and disappears when we take the difference.</p>
</div>
<div class="paragraph">
<p>However, a single East-West measurement at each latitude is not reliable enough.
Seeing conditions, local solar activity, or fitting errors can corrupt individual measurements.
To improve accuracy, JSol&#8217;Ex samples <strong>multiple longitudes</strong> across the limb region (typically 14 points from 62° to 88° longitude) and aggregates these measurements.
This redundancy allows outliers to be rejected and provides an error estimate based on measurement consistency.</p>
</div>
<div class="paragraph">
<p>The measured velocity is then:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{measured} = \frac{\Delta\lambda}{\lambda_0} \times \frac{c}{2}\]
</div>
</div>
<div class="paragraph">
<p>The factor of 2 appears because we&#8217;re measuring the difference between approaching and receding limbs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_from_measured_velocity_to_equatorial_velocity">From Measured Velocity to Equatorial Velocity</h3>
<div class="paragraph">
<p>The velocity we measure depends on the geometry: how much of the rotation velocity is projected along our line of sight.
At the equator and at the limb, we see the full rotation velocity.
At higher latitudes or closer to disk center, we see only a fraction.</p>
</div>
<div class="paragraph">
<p>The geometric correction factor is:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{equatorial} = \frac{v_{measured}}{\cos(\phi) \times \sin(\theta)}\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) is the heliographic latitude</p>
</li>
<li>
<p>\(\theta\) is the heliographic longitude (0° at disk center, ±90° at the limbs)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_finding_the_spectral_line_center">Finding the Spectral Line Center</h3>
<div class="paragraph">
<p>The most challenging part of the measurement is accurately determining the center of the absorption line.
A shift of just 0.01 Å corresponds to a velocity of about 0.5 km/s, which is significant compared to the typical equatorial velocity of ~2 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex uses <strong>Voigt profile fitting</strong> to measure the line center.
The Voigt profile is the convolution of a Gaussian and a Lorentzian profile, which accurately models the shape of solar absorption lines.
The Gaussian component represents thermal Doppler broadening, while the Lorentzian component represents natural and pressure broadening.</p>
</div>
<div class="paragraph">
<p>For each measurement point, the algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extracts a spectral profile from the SER file at the corresponding position</p>
</li>
<li>
<p>Fits a Voigt profile to the absorption line</p>
</li>
<li>
<p>Records the fitted line center position</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configurable "Voigt fit half-width" parameter (default: 2 Å) controls how much of the line wings are included in the fit.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coordinate_systems">Coordinate Systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the trickier aspects of this implementation is correctly mapping between the different coordinate systems involved.
The algorithm starts with heliographic coordinates (where we want to measure) and maps them back to the original SER frames (where the spectral data lives).</p>
</div>
<div class="paragraph">
<p><strong>1. Heliographic Coordinates (starting point)</strong></p>
</div>
<div class="paragraph">
<p>We begin by specifying points in heliographic coordinates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Latitude</strong>: -90° (south pole) to +90° (north pole)</p>
</li>
<li>
<p><strong>Longitude</strong>: 0° at disk center, ±90° at the limbs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requires two solar parameters computed from the observation date:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>B0</strong>: The heliographic latitude of the disk center (varies throughout the year)</p>
</li>
<li>
<p><strong>P</strong>: The position angle of the rotation axis (the "tilt" of the Sun as seen from Earth)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>2. Image Coordinates</strong></p>
</div>
<div class="paragraph">
<p>The heliographic coordinates are converted to pixel positions in the reconstructed image.
This involves reversing the corrections applied during reconstruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>P-angle correction</p>
</li>
<li>
<p>Flip/rotation</p>
</li>
<li>
<p>Geometric distortion</p>
</li>
<li>
<p>Tilt angle</p>
</li>
<li>
<p>Cropping</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>3. SER File Coordinates (destination)</strong></p>
</div>
<div class="paragraph">
<p>Finally, the image coordinates are mapped to the raw SER video file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Frame number</strong>: Position in the scan sequence (derived from x-coordinate)</p>
</li>
<li>
<p><strong>Column</strong>: Position along the slit (derived from y-coordinate)</p>
</li>
<li>
<p><strong>Row</strong>: Spectral direction (wavelength)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This reverse mapping allows us to extract the exact spectral profile at any heliographic location.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_data_processing_pipeline">The Data Processing Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The raw measurements are noisy.
To produce a clean rotation curve, JSol&#8217;Ex uses a two-stage processing pipeline:</p>
</div>
<div class="sect2">
<h3 id="_stage_1_longitude_aggregation">Stage 1: Longitude Aggregation</h3>
<div class="paragraph">
<p>As described earlier, at each latitude, multiple longitudes are sampled (typically 14 points across the limb region).
These measurements are combined using one of three methods (the default is median but you can choose):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Median</strong>: Robust to outliers, uses the middle value</p>
</li>
<li>
<p><strong>Average</strong>: Simple arithmetic mean</p>
</li>
<li>
<p><strong>Weighted Average</strong>: Points closer to the limb (where Doppler signal is stronger) get higher weight</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The error estimate from this stage represents the consistency of measurements across longitudes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stage_2_latitude_smoothing">Stage 2: Latitude Smoothing</h3>
<div class="paragraph">
<p>Even after longitude aggregation, the latitude-by-latitude measurements remain noisy.
Individual latitude bins can still be affected by localized features (sunspots, faculae) or simply measurement scatter.</p>
</div>
<div class="paragraph">
<p>Since we expect solar rotation to vary <strong>smoothly</strong> with latitude (following the \(\sin^2\phi\) and \(\sin^4\phi\) terms of the differential rotation law), we can exploit this physical constraint to reduce noise further.
JSol&#8217;Ex applies a smoothing filter that combines nearby latitude points within a configurable window (default: 5°).</p>
</div>
<div class="paragraph">
<p>Importantly, the errors from Stage 1 are <strong>propagated</strong> rather than recomputed from the spread in the smoothing window.
This ensures the error bars represent measurement uncertainty, not physical latitude variations.</p>
</div>
<div class="paragraph">
<p>For the median aggregation:</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{median(\sigma_i)}{\sqrt{n}}\]
</div>
</div>
<div class="paragraph">
<p>For the average:</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{\sqrt{\sum \sigma_i^2}}{n}\]
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_outcome_and_comparison_with_theory">The Outcome and Comparison with Theory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The standard form of the differential rotation law (also known as the Faye formula, even if the original formula didn&#8217;t include the 3rd term) is:</p>
</div>
<div class="stemblock">
<div class="content">
\[\omega(\phi) = A + B \sin^2(\phi) + C \sin^4(\phi)\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) is the heliographic latitude</p>
</li>
<li>
<p>\(A\) is the equatorial rotation rate</p>
</li>
<li>
<p>\(B\) and \(C\) control the decrease in velocity with latitude</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex compares measured results with the widely-used coefficients from <strong>Snodgrass &amp; Ulrich (1990)</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(A = 14.713\) deg/day (equatorial rotation rate)</p>
</li>
<li>
<p>\(B = -2.396\) deg/day</p>
</li>
<li>
<p>\(C = -1.787\) deg/day</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This gives an equatorial rotation period of about 24.5 days and a polar period of about 34 days.
Converting to linear velocity at the solar surface (radius ≈ 696,000 km), the equatorial rotation velocity is approximately 2.0 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex also fits its own A, B, C coefficients from your measurements, allowing direct comparison with the reference values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below are example differential rotation profiles measured with JSol&#8217;Ex using two different spectral lines.
These measurements were taken on different dates with different seeing conditions.</p>
</div>
<div class="sect2">
<h3 id="_fe_i_5883_å">Fe I 5883 Å</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-FeI.png" alt="velocity FeI">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_h_alpha">H-alpha</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-Ha.png" alt="velocity Ha">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_observations">Observations</h3>
<div class="paragraph">
<p>The measured profiles show the expected general shape: higher velocities at the equator, decreasing toward the poles.
The fitted curves follow the theoretical Snodgrass profile reasonably well.</p>
</div>
<div class="paragraph">
<p>However, I observe differences between spectral lines that I cannot fully explain.
The Fe I measurements show different absolute velocities than H-alpha, and the fitted coefficients differ between scans.</p>
</div>
<div class="paragraph">
<p>Several factors could contribute to these differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Formation height</strong>: Different spectral lines form at different heights in the solar atmosphere, and rotation rates may vary with height (as suggested by recent research from the <a href="https://www.nature.com/articles/s41550-024-02299-4">CHASE mission</a>)</p>
</li>
<li>
<p><strong>Seeing conditions</strong>: The scans were taken on different dates with different atmospheric conditions</p>
</li>
<li>
<p><strong>Line profile differences</strong>: H-alpha and Fe I have different line widths and depths, which may affect the Voigt fitting precision</p>
</li>
<li>
<p><strong>Systematic effects</strong>: There may be instrumental or algorithmic factors I haven&#8217;t identified</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I present these results as they are, without attempting to draw conclusions about which measurement is "correct" or what causes the observed differences.
More measurements across different dates, spectral lines, and instruments would be needed to understand these variations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_measuring_in_practice">Measuring in Practice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quality of results depends heavily on atmospheric seeing.
Poor seeing blurs the spectral lines and makes accurate center determination difficult.
Best results are obtained with excellent seeing conditions and a well-focused instrument.
Last but not least, a high spectral resolution is preferred, which is normally the case with Sol&#8217;Ex (HR) or the SHG 700.</p>
</div>
<div class="paragraph">
<p>You may also wonder which spectral line you should observe.
I tested the algorithm with Fe I, Na D2 and H-alpha, giving the results below.
In practice, strong absorption lines should in theory produce the best results, because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The line depth should be sufficient for accurate fitting</p>
</li>
<li>
<p>The wings should be well-defined for Voigt fitting</p>
</li>
<li>
<p>The signal-to-noise ratio should be high</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Very broad lines like Ca II K are too wide for accurate Voigt fitting and will produce unreliable results.
Too narrow lines may also represent a challenge for Voigt fitting but may work too.</p>
</div>
<div class="sect2">
<h3 id="_the_impact_of_the_spectral_line_detection">The Impact of the Spectral Line Detection</h3>
<div class="paragraph">
<p>One subtle but important factor affecting the absolute accuracy of the measurements is the <strong>polynomial correction</strong> used during image reconstruction.
Understanding this is essential for interpreting your results correctly.</p>
</div>
<div class="paragraph">
<p>During spectroheliograph processing, JSol&#8217;Ex computes a polynomial that maps each column position along the slit to the expected row position of the spectral line center.
This polynomial is computed from the <strong>average of SER frames</strong> in the scan (a heuristic is used to include frames containing actual solar data, not sky background).</p>
</div>
<div class="paragraph">
<p>Such a detection is crucial because the spectral line is not straight across the slit due to optical phenomenons: it consistutes what we often call the "smile".
Therefore, the line center might be at row 300 at column 500, but at row 350 at column 1000.
The polynomial captures this curvature.</p>
</div>
<div class="paragraph">
<p>By measuring line positions <strong>relative to the polynomial</strong>, we effectively remove the optical distortion from our measurements.
Without this reference, we would be measuring the sum of optical curvature plus Doppler shift, making it impossible to extract the tiny velocity signals we&#8217;re after.</p>
</div>
<div class="paragraph">
<p>A key question is: why can&#8217;t we just measure the absolute position of the spectral line in each frame and compute velocities directly?</p>
</div>
<div class="paragraph">
<p>The answer lies in the precision required.
A velocity of 2 km/s corresponds to a wavelength shift of only ~0.04 Å at H-alpha.
With a typical spectral dispersion of 0.1-0.2 Å/pixel, this is a shift of only <strong>0.2 to 0.4 pixels</strong>.</p>
</div>
<div class="paragraph">
<p>The optical curvature across the slit, on the other hand, can easily span 10-30 pixels or more.
Any attempt to measure absolute line positions would be completely dominated by this curvature, making Doppler detection impossible.</p>
</div>
<div class="paragraph">
<p>The polynomial serves as our <strong>reference baseline</strong>.
By measuring how the line position in each individual frame <strong>deviates from the polynomial</strong>, we isolate the Doppler component from the optical component.
This is the key insight that makes sub-pixel precision measurements possible, alongside the Voigt fitting.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_word_about_doppler_images">A Word About Doppler Images</h3>
<div class="paragraph">
<p>This, by the way, is also a reason why the Doppler images look different when scanning in RA vs DEC.
Because this is a question that is often asked, and that it took <strong>months</strong> for me to understand the reason, I think it&#8217;s worth spending a bit of time explaining the phenomenon.
I owe this explanation to Jean-François Pittet and Christian Buil, from a discussion weeks ago on the Sol&#8217;Ex mailing list.</p>
</div>
<div class="sect3">
<h4 id="_ra_scanning_vs_dec_scanning_a_critical_difference_for_doppler_images">RA Scanning vs DEC Scanning: A Critical Difference for Doppler Images</h4>
<div class="paragraph">
<p>Spectroheliographs can scan the Sun in two directions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RA scanning</strong> (Right Ascension): The slit is oriented North-South, and the scan proceeds East-West</p>
</li>
<li>
<p><strong>DEC scanning</strong> (Declination): The slit is oriented East-West, and the scan proceeds North-South</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This choice has <strong>profound implications</strong> for Doppler visibility, as explained by Jean-François Pittet on the Sol&#8217;Ex mailing list.</p>
</div>
<div class="sect4">
<h5 id="_ra_scanning_doppler_visible_in_images">RA Scanning: Doppler Visible in Images</h5>
<div class="paragraph">
<p>In RA scanning mode, each frame captures a vertical slice of the Sun from North pole to South pole.
Over the course of the scan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Early frames capture the <strong>East limb</strong> (approaching, blueshifted)</p>
</li>
<li>
<p>Middle frames capture the <strong>disk center</strong> (no radial velocity)</p>
</li>
<li>
<p>Late frames capture the <strong>West limb</strong> (receding, redshifted)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When JSol&#8217;Ex computes the polynomial from the average of all frames, the East and West contributions <strong>balance out</strong>.
The blueshift from the East limb is canceled by the redshift from the West limb.
The resulting polynomial represents the "neutral" baseline: approximately the line position at disk center with no Doppler shift.</p>
</div>
<div class="paragraph">
<p>As a result, when we reconstruct the image at pixel shift 0, the Doppler shifts become <strong>visible as contrast differences</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>East limb appears darker (line shifted into the passband)</p>
</li>
<li>
<p>West limb appears brighter (line shifted out of the passband)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is why Doppler images from RA scans show the characteristic East-West asymmetry.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dec_scanning_doppler_absorbed_by_the_polynomial">DEC Scanning: Doppler "Absorbed" by the Polynomial</h5>
<div class="paragraph">
<p>In DEC scanning mode, each frame captures a horizontal slice of the Sun from East to West.
Here&#8217;s the critical difference: <strong>all pixels within a single frame see approximately the same Doppler shift</strong>.</p>
</div>
<div class="paragraph">
<p>For example, if the current frame is capturing the Eastern half of the disk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All points in that frame are approaching us</p>
</li>
<li>
<p>All points have similar blueshift</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When JSol&#8217;Ex computes the polynomial from the average of all frames, it doesn&#8217;t just capture the optical curvature: it also captures the <strong>average Doppler shift</strong> across the scan.
But here&#8217;s the problem: the Doppler shift varies systematically across the scan (East frames are blueshifted, West frames are redshifted).</p>
</div>
<div class="paragraph">
<p>The polynomial effectively "absorbs" a weighted average of these Doppler shifts.
When we then measure line positions relative to this polynomial, much of the Doppler signal has already been subtracted out.
The resulting Doppler images will <strong>no longer show the rotation of the sun</strong> (which can also be a benefit, for other kind of observations).</p>
</div>
<div class="paragraph">
<p>This is why experienced spectroheliographers often prefer RA scanning for Doppler work: the Doppler signal is more visible and easier to detect.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_p_angle_complication">The P-Angle Complication</h4>
<div class="paragraph">
<p>There&#8217;s an additional subtlety: the Sun&#8217;s rotation axis is not perpendicular to the ecliptic.
The <strong>P-angle</strong> (position angle of the rotation axis) varies throughout the year from about -26° to +26°.</p>
</div>
<div class="paragraph">
<p>Only twice per year (around early June and early December) is the P-angle close to zero.
At these times:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RA scanning is truly parallel to the solar equator</p>
</li>
<li>
<p>The East-West Doppler pattern aligns perfectly with the scan direction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At other times, when P is non-zero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The rotation axis is tilted relative to the scan direction</p>
</li>
<li>
<p>The Doppler pattern is rotated relative to the image axes</p>
</li>
<li>
<p>Some Doppler signal "leaks" into the polynomial average even in RA mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is one reason why differential rotation measurements can show slightly different results at different times of year, despite us taking the P and B0 angles into account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implications_for_differential_rotation_measurements">Implications for Differential Rotation Measurements</h4>
<div class="paragraph">
<p>This explains why <strong>RA scanning is essential</strong> for differential velocity measurements:</p>
</div>
<div class="paragraph">
<p>In RA mode, East and West limb points at the same latitude correspond to the <strong>same column</strong> on the slit (same slit position, different frames).
The polynomial value at that column is computed from the average of all frames (East limb, disk center, and West limb) so the Doppler shifts cancel out in the average.
When we compute <code>(West - polynomial) - (East - polynomial)</code>, the polynomial terms are identical and cancel, leaving us with the true Doppler difference <code>West - East</code>.</p>
</div>
<div class="paragraph">
<p>In DEC mode, East and West limb points at the same latitude correspond to <strong>opposite ends of the slit</strong> (different columns, same frame).
The polynomial at the East column is computed from frames that <strong>all see the East limb</strong> at that position, so the polynomial absorbs the blueshift.
Similarly, the polynomial at the West column absorbs the redshift.
When we compute the difference, these absorbed Doppler shifts don&#8217;t cancel: they <strong>subtract from</strong> our measurement, significantly reducing the measured signal.</p>
</div>
<div class="paragraph">
<p>This is why, in practice, DEC scans do not produce usable Doppler images or reliable differential velocity measurements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_tips">Configuration Tips</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Limb longitude</strong> (default 75°): Measurements closer to the limb give stronger Doppler signals but risk limb darkening effects</p>
</li>
<li>
<p><strong>Latitude step</strong> (default 2°): Smaller values give finer resolution but longer processing times</p>
</li>
<li>
<p><strong>Smoothing window</strong>: Should be at least 2× the latitude step for effective smoothing</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Measuring differential rotation with amateur equipment would have seemed impossible just a few years ago.
Pioneers like Peter Zetner or Christian Buil showed us the path.
What I&#8217;m trying to do, as always with JSol&#8217;Ex, is to make this accessible to even more people at the cost of "magic", which is that some people will very likely share results without understanding the science behind it.
I&#8217;m not too concerned by this, as I, myself, have been going this way: enjoying SHG image reconstruction, then figuring out how it works, then asking myself questions like "why is it even possible that we measure Doppler velocities so small?": this is an intellectual construct that takes time and we can do better, I think, at brining this to the masses, sharing our insights.</p>
</div>
<div class="paragraph">
<p>This feature joins the growing list of scientific capabilities in JSol&#8217;Ex: Ellerman bomb detection, active region identification, and now differential rotation measurement.
Each of these brings professional-level analysis within reach of amateur astronomers, but, as always, be cautious with what I&#8217;m saying: I&#8217;m not a scientist, just an engineer.
I have no doubts that I made approximations, or took liberties that I should probably not have taken.</p>
</div>
<div class="paragraph">
<p>However, I do think that this brings value to the ecosystem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliography">Bibliography</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scientific_papers">Scientific Papers</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1951MNRAS.111..413N/abstract">Newton, H.W. &amp; Nunn, M.L. (1951) - The Sun&#8217;s rotation derived from sunspots 1934-1944. MNRAS 111, 413</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF02276562">Howard, R. &amp; Harvey, J. (1970) - Spectroscopic determinations of solar rotation. Sol Phys 12, 23-51</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF00154804">Snodgrass, H.B. (1984) - Separation of large-scale photospheric Doppler patterns. Sol Phys 94, 13-31</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1086/168467">Snodgrass, H.B. &amp; Ulrich, R.K. (1990) - Rotation of Doppler features in the solar photosphere. ApJ 351, 309</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1023/A:1005226402796">Beck, J.G. (2000) - A comparison of differential rotation measurements. Sol Phys 191, 47-70</a></p>
</li>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/2000A%26A&#8230;&#8203;357..763W/abstract">Wöhl, H. &amp; Schmidt, W. (2000) - Solar equatorial plasma rotation: a comparison of different spectroscopic measurements. A&amp;A 357, 763-766</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2406.18271">Takeda, Y. &amp; Ueno, S. (2024) - Measurement of Solar Differential Rotation by Absolutely Calibrated Iodine-Cell Spectroscopy</a></p>
</li>
<li>
<p><a href="https://www.aanda.org/articles/aa/full_html/2025/10/aa56102-25/aa56102-25.html">Corbard, T. et al. (2025) - Rotational radial shear in the low solar photosphere. A&amp;A 702, A93</a></p>
</li>
<li>
<p><a href="https://www.nature.com/articles/s41550-024-02299-4">Li, Z. et al. (2024) - Height-dependent differential rotation of the solar atmosphere detected by CHASE. Nature Astronomy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_amateur_resources">Amateur Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">Zetner, P. (2017) - Solar differential rotation measured with a spectroheliograph (CloudyNights)</a></p>
</li>
<li>
<p><a href="https://solar-astronomy-book.com/">Zetner, P. et al. - Solar Astronomy: Observing, imaging and studying the Sun</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/solex/">Sol&#8217;Ex - Christian Buil&#8217;s spectroheliograph project</a></p>
</li>
<li>
<p><a href="https://melix.github.io/astro4j/latest/en/jsolex.html">JSol&#8217;Ex Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></p>
  			<a href="/blog/2025/09-11-jsolex-4.0.0.html"><h1>JSol&#8217;Ex 4.0.0 est sorti !</h1></a>
  			<p>11 September 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solaire.html">solaire</a> 
	
		<a href="/blog/tags/astronomie.html">astronomie</a> 
	
		<a href="/blog/tags/ia.html">ia</a> 
	
		<a href="/blog/tags/claude.html">claude</a> 
	
		<a href="/blog/tags/bass2000.html">bass2000</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Le 18 février 2023, je montais à l&#8217;Observatoire du Pic du Midi de Bigorre pour y passer une "Nuit au Sommet", une expérience mêlant observation nocturne et visite des installations scientifiques. J&#8217;y ai découvert avec fascination le coronographe Bernard-Lyot, l&#8217;expérience <a href="https://climso.fr/">CLIMSO</a> gérée par les Observateurs Associés de l&#8217;Observatoire Midi-Pyrénées.</p>
</div>
<div class="paragraph">
<p>Des étoiles plein les yeux (et une en particulier, notre soleil), ma vie d&#8217;astronome amateur centrée sur le ciel profond allait basculer vers l&#8217;observation de notre Soleil. De retour à la maison, j&#8217;ai commencé à me renseigner sur le matériel solaire, et découvrait avec stupéfaction qu&#8217;il fallait investir, beaucoup, pour pouvoir observer notre astre en toute sécurité : filtres pleine ouverture, étalons, &#8230;&#8203; tout avait un coût démesuré pour un débutant comme moi. De quoi décourager, jusqu&#8217;à ce que je tombe par hasard <a href="http://www.astrosurf.com/solex/">sur le projet Sol&#8217;Ex</a>, initié par la légende Christian Buil.</p>
</div>
<div class="paragraph">
<p>Ce projet, très didactique, permet de se construire un spectrohéliographe, par impression 3D. Un tel instrument présente de nombreux avantages : coût modeste, résolution élevée et la possibilité d&#8217;observer dans de nombreuses longueurs d&#8217;ondes tout en mettant à disposition des données exploitables scientifiquement !</p>
</div>
<div class="paragraph">
<p>L&#8217;inconvénient, si c&#8217;en est vraiment un, de cet instrument est qu&#8217;il ne produit pas une image du soleil observable directement à l&#8217;oculaire. Il est nécessaire d&#8217;utiliser un logiciel de reconstruction qui, à partir d&#8217;une vidéo enregistrant un "scan" du soleil, permet de générer une (voir plus) images du soleil. Ce processus de reconstruction, bien mystérieux pour moi à l&#8217;époque, était réalisé par un <a href="http://valerie.desnoux.free.fr/inti/">logiciel écrit par Valérie Desnoux, nommé INTI</a>. Etant développeur (Java), je me suis alors lancé un challenge à l&#8217;époque : puisque je ne comprenais pas comment ça fonctionnait, j&#8217;allais essayer de créer moi-même un logiciel pour faire cette reconstruction. De cet appétit est né <a href="https://melix.github.io/astro4j/latest/fr/jsolex.html">JSol&#8217;Ex</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_4_0_et_la_collaboration_scientifique">JSol&#8217;Ex 4.0 et la collaboration scientifique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous voici 2 ans et demi plus tard, JSol&#8217;Ex arrive en version 4. Entre temps, le nombre d&#8217;utilisateurs a explosé et mon logiciel est exploité non seulement par les utilisateurs du Sol&#8217;Ex de Christian Buil, mais aussi pour des spectrohéliographes commerciaux comme le <a href="https://mlastro.com/mlastro-shg">MLAstro SHG 700</a> (que j&#8217;utilise désormais). JSol&#8217;Ex a apporté de nombreuses innovations, comme la possibilité d&#8217;exécuter des scripts pour générer des animations, faire du stacking, créer des images personnalisées, ou encore la détection automatique d&#8217;éruptions, des régions actives (avec annotation), la détection de bombes d&#8217;Ellerman, la correction des bords dentelés et j&#8217;en passe.</p>
</div>
<div class="paragraph">
<p>Récemment, JSol&#8217;Ex a été utilisé pour réaliser un <a href="https://iopscience.iop.org/article/10.3847/2515-5172/adef50">Atlas de Spectrohéliogrammes</a>, et mentionné dans <a href="https://arxiv.org/abs/2508.10853">un article précisément sur la détection des bombes d&#8217;Ellerman</a>. Bref, JSol&#8217;Ex était devenu suffisamment mature pour faire de la "vraie science", chose qui m&#8217;a toujours un peu effrayé pour être honnête.</p>
</div>
<div class="paragraph">
<p>Ainsi, j&#8217;ai toujours refusé d&#8217;intégrer une fonctionnalité dans JSol&#8217;Ex, qui m&#8217;a pourtant été demandée de nombreuses fois : la possibilité de l&#8217;utiliser pour soumettre des images dans la <a href="https://bass2000.obspm.fr/">base de données BASS2000</a> de l&#8217;<a href="https://www.linkedin.com/school/lira-observatoire-de-paris/">Observatoire de Paris-Meudon</a>. Plusieurs raisons à cela : d&#8217;une, je ne faisais pas confiance à mon propre logiciel pour sa qualité "scientifique". Si je le savais capable de produire de "belles images", il est tout à fait différent de s&#8217;en servir pour une exploitation scientifique. D&#8217;autre part, il n&#8217;était pas question pour moi d&#8217;intégrer une fonctionnalité qui avait été développée par Valérie Desnoux (autrice de INTI) et l&#8217;équipe de Meudon sans son accord, par respect pour son travail.</p>
</div>
<div class="paragraph">
<p>Cependant, vous aurez compris que les temps ont changé et que la pression des utilisateurs ainsi que mes discussions avec Florence Cornu, du projet SOLAP, aux Rencontres du Ciel et de l&#8217;Espace fin 2024, puis aux <a href="https://www.mars60.fr/jason2025/">JASON</a> en Juin dernier ont eu raison de mes doutes. Avec son accord et celui de Valérie, je suis donc heureux de vous annoncer que JSol&#8217;Ex 4 est officiellement supporté pour soumettre vos images dans la base de données BASS 2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_un_assistant_pas_à_pas">Un assistant pas à pas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ne souhaitant pas faire les choses à moitié, j&#8217;ai particulièrement peaufiné le logiciel pour simplifier cette procédure. J&#8217;ai souhaité faire les choses avec sérieux, puisqu&#8217;il s&#8217;agit d&#8217;une base de données professionnelle, exploitée par des scientifiques. Ainsi, une chose importante pour moi était de guider l&#8217;utilisateur dans ce processus et de lui faire comprendre l&#8217;importance de la qualité des données, tout en simplifiant le processus de soumission.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/bass2000.jpg" alt="bass2000">
</div>
<div class="title">Figure 1. Assistant de soumission BASS2000</div>
</div>
<div class="paragraph">
<p>Ainsi par exemple, BASS2000 n&#8217;a que très peu de tolérance sur les problèmes d&#8217;orientation de l&#8217;image : il faut que le Nord solaire soit à moins de 1 degré d&#8217;erreur, sinon l&#8217;image sera refusée. L&#8217;assistant intègre donc un outil pour aider à vérifier l&#8217;orientation et corriger les erreurs minimes dues par exemple à une mise en station imparfaite.</p>
</div>
<div class="paragraph">
<p>L&#8217;assistant guidera aussi l&#8217;utilisateur dans son processus de soumission, en lui demandant de bien vérifier toutes les métadonnées associées à l&#8217;observation, et ira jusqu&#8217;à envoyer l&#8217;image sur le serveur FTP de BASS2000 pour validation par les équipes.</p>
</div>
<div class="paragraph">
<p>Je suis particulièrement reconnaissant à Florence CORNU pour son aide afin que les images JSol&#8217;Ex soient acceptées dans la base et je remercie mes beta-testeurs qui ont patiemment testé mes versions de développement pendant l&#8217;été.</p>
</div>
<div class="paragraph">
<p>Je ne vous cache pas qu&#8217;il s&#8217;agit là d&#8217;une forme de reconnaissance de mon travail, des centaines d&#8217;heures passées soirs et week-ends à développer ce logiciel qui rappelons-le est <a href="https://github.com/melix/astro4j">entièrement Open Source et gratuit</a>.</p>
</div>
<div class="paragraph">
<p>Enfin, je ne peux pas m&#8217;arrêter sans vous annoncer une deuxième bonne nouvelle : non seulement vous pourrez utiliser JSol&#8217;Ex pour soumettre vos images acquises avec un Sol&#8217;Ex, mais aussi avec le MLAstro SHG 700, qui devient officiellement supporté dans la base BASS2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changements_dans_linterface">Changements dans l&#8217;interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour cette version j&#8217;ai aussi souhaité moderniser un peu l&#8217;interface graphique et la simplifier : avec le nombre de fonctionnalités croissantes arrive ce moment fatidique que tout développeur redoute : que l&#8217;interface ne devienne trop complexe pour les nouveaux utilisateurs et ne parle qu&#8217;aux anciens. J&#8217;ai essayé d&#8217;éviter cet écueil au cours du temps en refusant certaines fonctionnalités trop "de niche", mais sans pouvoir pour autant réussir à avoir une interface totalement claire.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/interface-overview.jpg" alt="interface overview">
</div>
<div class="title">Figure 2. Aperçu des changements d&#8217;interface</div>
</div>
<div class="paragraph">
<p>Cette nouvelle version essaie donc de regrouper les paramètres par sections plus claires, tout en ajoutant des infobulles pour guider les utilisateurs, anciens comme nouveaux, dans cet esprit qui est que le logiciel se doit d&#8217;être le plus didactique possible : j&#8217;essaie, autant que faire se peut, de vous transmettre en tant qu&#8217;utilisateurs ce que moi-même j&#8217;apprends en développant ce logiciel. Un exemple frappant de cette philosophie, c&#8217;est cette fonctionnalité que j&#8217;avais ajoutée qui permet de montrer en cliquant sur le disque solaire, à quelle image il correspond dans le fichier source (une vidéo contenant des spectres).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_détection_dellipse_assistée_par_lutilisateur">Détection d&#8217;ellipse assistée par l&#8217;utilisateur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je vous parlais un peu plus haut de l&#8217;Atlas des Spectrohéliogrammes. Cet atlas, réalisé par Pál Váradi Nagy, nécessite un travail énorme d&#8217;analyse des données et est réalisé à l&#8217;aide de scripts JSol&#8217;Ex. Cependant, pour certaines longueurs d&#8217;ondes ou pour parfois des images un peu compliquées à traiter, le logiciel peut échouer à détecter correctement les contours du disque solaire. Ceci peut arriver notamment lorsque les images sont peu contrastées ou lorsqu&#8217;il y a des réflexions internes qui biaisent la détection.</p>
</div>
<div class="paragraph">
<p>Afin de résoudre ces cas complexes qui, encore une fois, nuisent à l&#8217;analyse scientifiques, j&#8217;ai ajouté la possibilité d&#8217;aider le logiciel à détecter les contours, et ainsi à obtenir un image solaire bien ronde:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/ellipse-detection-assistant.jpg" alt="ellipse detection assistant">
</div>
<div class="title">Figure 3. Détection d&#8217;ellipse assistée par l&#8217;utilisateur</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lia_à_la_rescousse">L&#8217;IA à la rescousse</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je suis développeur et en tant que tel, sur ce media, il me semblait pertinent d&#8217;ajouter une section sur la façon dont cette version a été développée.</p>
</div>
<div class="paragraph">
<p>Cette version est la première version qui a été développée avec l&#8217;aide de l&#8217;IA, en particulier Claude Code. En effet, les dernières innovations en matière d&#8217;IA agentique sont pour le coup la véritable révolution à venir : autant avant, avoir une IA qui n&#8217;était pas capable de comprendre le contexte, faire des refactorings ou prévoir un plan de développement ne les rendait pas particulièrement utiles, autant les IA à base d&#8217;agents, qui sont capables d&#8217;analyser votre code, appeler des outils de manière autonome et avoir de vraies interactions avec vous sont un "game changer" de mon point de vue.</p>
</div>
<div class="paragraph">
<p>Dans cette version, j&#8217;ai donc utilisé Claude Code (plan Pro) pour m&#8217;aider à faire les refactorings dont j&#8217;avais besoin et m&#8217;assister dans une tâche où je ne suis pas particulièrement à l&#8217;aise : le design d&#8217;interfaces graphiques.</p>
</div>
<div class="paragraph">
<p>De manière générale, ça fonctionne plutôt bien. Très bien même. La capacité de l&#8217;outil à définir un plan d&#8217;implémentation et comprendre les besoins est assez fascinante. Le code généré, en revanche, nécessite toujours beaucoup de review. On pourrait dire que j&#8217;ai l&#8217;impression d&#8217;avoir un (très bon) stagiaire avec moi, en permanence. En tant que développeur senior, je suis assez rapide à identifier là où l&#8217;IA complique les choses inutilement, ou utilise des design pattern dépréciés, ou ne respecte pas les conventions de code. Je serai, par exemple, terrifié si le code original produit était parti en production sans review. Mais, en lui donnant les bonnes directions, en lui expliquant ses erreurs, on arrive rapidement à ce que l&#8217;on souhaite avec la qualité que l&#8217;on souhaite.</p>
</div>
<div class="paragraph">
<p>Quelques exemples de choses qui ne fonctionnent pour le coup vraiment pas bien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Claude vous demande de créer un fichier CLAUDE.md qui comprend des instructions sur comment compiler votre projet, comment il est organisé, etc. Bref, du contexte qui est systématiquement ajouté à chaque session. Pourtant, à l&#8217;utilisation, Claude ignore allègrement ces instructions.</p>
</li>
<li>
<p>En Java, les fichiers .properties sont encodés en ISO-8859-1, même dans une base où tous les sources sont en UTF-8. C&#8217;est une bizarrerie historique, mais Claude ne la comprend absolument pas. A chaque fois qu&#8217;il modifie mes fichiers properties (qui servent à l&#8217;internationalisation de l&#8217;interface), il casse systématiquement l&#8217;encodage. Pour l&#8217;éviter, le dois systématiquement, avant de lui faire faire une opération dont je sais qu&#8217;elle implique ces fichiers, lui dire "respecte les guidelines du fichier CLAUDE" où je lui ai donné une technique pour éviter les problèmes (convertir le fichier en UTF-8, puis l&#8217;éditer, puis le reconvertir en ISO-8859-1)</p>
</li>
<li>
<p>Les commentaires dans le code. Quand on commence à avoir un peu de bouteille comme moi, il est assez insupportable de lire des commentaires "captain obvious", ce genre de commentaires qui dit "la ligne suivante calcule 1+1". Claude en génère beaucoup. Trop. Et malgré le fait que mon fichier CLAUDE lui interdise explicitement.</p>
</li>
<li>
<p>La confiance en soi. Claude est bien trop optimiste et tend trop à flatter l&#8217;utilisateur. Par exemple, si je lui mens explicitement ("ton algorithme est faux parce que XXX"), il répondra systématiquement "Tu as raison !" sans "réfléchir" (j&#8217;utilise les guillemets avec intention), comme un tic de langage ! Ca devient assez frustrant à la longue, lorsqu&#8217;il ne comprend pas un problème ou complique inutilement l&#8217;implémentation.</p>
</li>
<li>
<p>Les limites : on arrive, sur un projet de la taille de JSol&#8217;Ex, très rapidement aux limites d&#8217;usage même sur un forfait Pro. Si je suis satisfait de ce que ça m&#8217;apporte pour le prix, je ne suis pas prêt à payer les 200€ / mois pour augmenter ces limites. N&#8217;oublions pas que je fais ça sur mon temps libre&#8230;&#8203; je n&#8217;ai aucune obligation de résultat !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quoi qu&#8217;il en soit, il s&#8217;agit là d&#8217;avancées qu&#8217;il devient difficile d&#8217;ignorer. Et ceux qui me connaissent savent à quel point je suis critique sur l&#8217;utilisation des IA, les mythes autour de ce qu&#8217;elle est capable de faire et son impact écologique. Néanmoins, une chose est certaine : les dirigeants qui pensent économiser du temps et de l&#8217;argent en virant leurs développeurs pour les remplacer par de l&#8217;IA se mettent une balle dans le pied : elle pose de sérieux problèmes de qualité de code et donc de maintenance, et, avec l&#8217;arrivée des agents, posent de graves problèmes de sécurité (un outil autonome qui décide par lui même s&#8217;il faut vous demander l&#8217;autorisation pour exécuter une commande !"). L&#8217;IA doit être vue comme une aide à la productivité, mais qui doit être cadrée par des gens d&#8217;expérience. Bref, nous sommes à un tournant et je ne suis pas encore bien à l&#8217;aise avec ce que cela implique. Nous n&#8217;avons jamais été aussi près du rêve de gosse que j&#8217;avais d&#8217;IA "autonomes", mais la maturité me force à en avoir peur.</p>
</div>
<div class="paragraph">
<p>Mais nous nous éloignons là du sujet initial et concluons donc ce billet : dites bienvenue à JSol&#8217;Ex 4, consultez la vidéo de présentation ci-dessous et n&#8217;hésitez pas à contribuer !</p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/4SPKsNvnzKo?si=KuqIIMc1H6SLgVec" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div></p>
  			<a href="/blog/2025/05-19-jsolex-3-2-0.html"><h1>Ellerman Bombs Detection with JSol&#8217;Ex 3.2</h1></a>
  			<p>17 May 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	
		<a href="/blog/tags/ellerman.html">ellerman</a> 
	
		<a href="/blog/tags/bombs.html">bombs</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
</div>
</div>
<div class="sect1">
<h2 id="_about_ellerman_bombs">About Ellerman Bombs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ellerman bombs were first described by Ferdinand Ellerman back in 1917.
Ellerman&#8217;s article was named -Solar Hydrogen "Bombs"- and it&#8217;s only later that these were commonly referred to as "Ellerman bombs".</p>
</div>
<div class="paragraph">
<p>I came upon this term while reading <a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">an article from Sylvain or André Rondi</a> quite early in my solar imaging journey, and I was since then obsessed by these phenomena.</p>
</div>
<div class="paragraph">
<p>Ellerman Bombs are small, transient, and explosive events that occur in the solar atmosphere, particularly in the vicinity of sunspots.
These are very short lived compared to other solar features: from several dozens of seconds to a few minutes.
The most common explanation is magnetic reconnection, which occurs when two magnetic regions opposite polarity come into contact and reconnect, releasing energy in the form of heat and light.
This is for example described in <a href="https://dx.doi.org/10.1051/0004-6361/201321632">this article from González, Danilovic and Kneer</a>.</p>
</div>
<div class="paragraph">
<p>Amateur observations of Ellerman bombs are quite rare, but Rondi described such observations using a spectroheliograph back in 2005.
They are rare because they are mostly invisible where the amateur observations are made (the center of the H-alpha line), and are too small to notice.
However, these are visible in the wings of the H-alpha line: this is where a spectroheliograph comes in handy, since the cropping window that is used to capture an image contains more than just the H-alpha line.</p>
</div>
<div class="paragraph">
<p>I had a <a href="https://github.com/melix/astro4j/issues/382">long standing issue</a> to do something about it in JSol&#8217;Ex, and I finally got around to it: all it took was getting some test data to entertain the ideas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observation_of_an_ellerman_bomb">Observation of an Ellerman Bomb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I am doing many observations of the sun: I started in 2023 with a Sol&#8217;Ex, then I recently got an SHG 700, so I have accumulated quite a bit of data, which is completed by scans which are shared with me by other users of JSol&#8217;Ex.</p>
</div>
<div class="paragraph">
<p>I have been looking for Ellerman bombs in my data, but I never found any yet.
This changed a couple weeks ago: I was doing some routine work on JSol&#8217;Ex and using a capture I had done in April, 29, 2025 at 08:32 UTC, when I noticed, by accident, a bright spot in the continuum image:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/continuum.jpg" alt="continuum">
</div>
</div>
<div class="paragraph">
<p>It may not be obvious at first, which is precisely why these are hard to spot, so here&#8217;s a hint:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/zoom-continuum.png" alt="zoom continuum">
</div>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex offers the ability to easily generate animations of the data captured at different wavelengths, so I generated a quick animation, which shows the same image at ±2.5Å from the center of the H-alpha line:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/anim_ellerman.gif" alt="anim ellerman">
</div>
</div>
<div class="paragraph">
<p>We can see the typical behavior of an Ellerman bomb: it is bright in the wings of the H-alpha line,  but it vanishes when we are at the center of the line.
The fine spectral dispersion of the spectroheliograph makes it possible to highlight this phenomenon very precisely.</p>
</div>
<div class="paragraph">
<p>The corresponding frame of the SER file shows the aspect of the Ellerman bomb in the spectrum:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-spectrum.png" alt="ellerman spectrum">
</div>
</div>
<div class="paragraph">
<p>The shape that you can see is often referred to as the "moustache".
At this stage I was pretty sure I had observed my first Ellerman bomb, and that I could implement an algorithm to detect it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_3_2_auto_detection">JSol&#8217;Ex 3.2 auto-detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSol&#8217;Ex 3.2 ships with a new feature to automatically detect Ellerman bombs in the data.
Currently, it is limited to H-alpha, but it should be possible to detect these in CaII as well.</p>
</div>
<div class="paragraph">
<p>The algorithm I implemented uses statistical analysis of the spectrum to match the characteristics of the "moustache" shape, in particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a maximum of intensity around 1Å from the center of the line</p>
</li>
<li>
<p>a distance which spreads up to 5Å from the center of the line</p>
</li>
<li>
<p>a brightening which is only visible in the wings of the line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex will generate, for each detection, an image showing the location of the detected bombs:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-location.jpg" alt="ellerman location">
</div>
</div>
<div class="paragraph">
<p>And for each bomb, it will create an image which shows the region of the spectrum which is used to detect the bomb.
This is for example what is automatically generated for the bomb described above:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/spectrum-detection.jpg" alt="spectrum detection">
</div>
</div>
<div class="sect2">
<h3 id="_algorithm_details">Algorithm details</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a description of the algorithm that I implemented in an <em>adhoc</em> fashion: I&#8217;m not a mathematician nor a scientist: I&#8217;m an engineer and the algorithm above was implemented using my "intuition" of what I thought would work. It is likely to change as new versions are released.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The algorithm is based on the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for each frame in the SER file, identify the "borders" of the sun</p>
</li>
<li>
<p>perform a Gaussian blur on the spectrum to reduce noise</p>
</li>
<li>
<p>within the borders, compute, for each column, the average intensity of the spectrum for the center of the line and the wings separately. The center of the line is defined as the range [-0.35Å, 0.35Å] and the wings as the range [-5Å, -0.35Å[ ∪ ]0.35Å, 5Å]</p>
</li>
<li>
<p>compute the maximum intensity of the wings, starting from the center of the line, and going outwards until we reach the maximum intensity (local extremum)</p>
</li>
<li>
<p>compute the average of each column average intensity for the wings (the "global average")</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Ellerman bomb scoring parameters defined below, the algorithm proceeds per column:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each column index <code>x</code> in the spectrum image:</p>
</li>
<li>
<p>Build a neighborhood of up to 16 columns around <code>x</code>:
<code>Nₓ = { x + k  |  k ∈ ℤ,  |k| ≤ 8 }</code>, clamped to the image boundaries.</p>
</li>
<li>
<p>Compute the overall mean column intensity
<code>Ī_global = (1 / N_total) ∑_{j=1..N_total} Ī(j)</code>.</p>
</li>
<li>
<p>Exclude any columns in <code>Nₓ</code> whose average intensity falls below 90 % of <code>Ī_global</code>, since very dark columns (usually sunspots) would pull down our estimate of the local wing background and hide true brightening events. Call the remaining set <code>Mₓ</code> and let <code>m = |Mₓ|</code>.</p>
</li>
<li>
<p>If <code>m &lt; 1</code>, there aren’t enough valid neighbors to form a reliable background—skip column <code>x</code>.</p>
</li>
<li>
<p>On the Gaussian-smoothed data, measure three key values at column <code>x</code>:</p>
</li>
<li>
<p><code>c₀ ≔ I_center(x)</code>, the mean intensity in the core region of the spectral line.</p>
</li>
<li>
<p><code>c_w ≔ I_wing(x)</code>, the average intensity across the two wing windows at ±1 Å.</p>
</li>
<li>
<p><code>c_max ≔ max_{p ∈ wing-pixels nearest ±1 Å} I(p, x)</code>, the single highest wing intensity near the expected shift.</p>
</li>
<li>
<p>Compute the local wing background
<code>r₀ = (1 / (m−1)) ∑_{j ∈ Mₓ, j≠x} I_wing(j)</code>.
Using only nearby “bright enough” columns keeps the background estimate from being skewed by dark features.</p>
</li>
<li>
<p>Define a line-brightening factor
<code>B = max(1, c₀ / min(r₀, I_center,global))</code>.
Ellerman bombs boost the wings without greatly brightening the core, whereas flares brighten both.</p>
</li>
<li>
<p>Form an initial score
<code>S₀ = 1 + c_max / min(r₀, I_wing,global)</code>,
where <code>I_wing,global = (1/N_total) ∑_{j=1..N_total} I_wing(j)</code>.
This compares the local wing peak to the typical wing level across the image.</p>
</li>
<li>
<p>Adjust for how many neighbors were used:
<code>S₁ = S₀ × (m / 16)</code>.
Fewer valid neighbors mean less confidence, so the score is scaled down proportionally.</p>
</li>
<li>
<p>Compute the wing-to-background ratio
<code>rᵢ = c_max / r₀</code>.
If <code>rᵢ ≤ 1.05</code>, the wing peak is too close to the local background and the column is discarded. Otherwise, we boost the score further:</p>
</li>
<li>
<p>Raise <code>S₁</code> to the power of <code>e^{rᵢ}</code>, giving
<code>S₂ = S₁^( e^{rᵢ} )</code>.
This makes the score grow quickly when the wing peak stands out strongly.</p>
</li>
<li>
<p>Multiply by <code>√(c_max / c₀)</code> to get
<code>S₃ = S₂ · √(c_max / c₀)</code>.
That emphasizes cases where the wings are much brighter than the core.</p>
</li>
<li>
<p>Finally, penalize any shift away from the ideal ±1 Å wing position. If <code>y_core</code> and <code>y_max</code> are the pixel locations of line center and wing peak, compute
<code>Δλ = |y_max – y_core| × (Å / pixel)</code>,
then
<code>S_final = S₃ / (1 + |1 Å – Δλ|)</code>.</p>
</li>
<li>
<p>If <code>S_final &gt; 12</code>, mark column <code>x</code> as a candidate event. Use the value of <code>B</code> to decide:</p>
</li>
<li>
<p>When <code>B &lt; 1.5</code>, it behaves like an Ellerman bomb (wings bright, core unchanged).</p>
</li>
<li>
<p>When <code>B &gt; 2</code>, it matches a flare (both core and wings bright).</p>
</li>
<li>
<p>If <code>1.5 ≤ B ≤ 2</code>, the result is ambiguous and ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All thresholds (0.9× global mean, 1.05 ratio, score &gt; 12, B cutoffs) were chosen by testing on data and visually inspecting results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_filtering">Post-filtering</h3>
<div class="paragraph">
<p>There will often be cases where the same bomb is detected in multiple frames.
Therefore, we need to do some merging of bombs which are spatially connected.</p>
</div>
<div class="paragraph">
<p>Eventually, we apply a limit threshold: if there are more than 5 Ellerman Bombs detected in an image, then we consider the detection to be false positives (this happens typically on saturated images, or images with too much noise).
This is a bit arbitrary, but it seems to work well in practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_data">Test data</h3>
<div class="paragraph">
<p>I had about ~1100 scans I could reuse for detection, and it successfully discovered Ellerman bombs candidates in about 10% of them.
Of course this required some tuning and several runs to get the parameters right.
This doesn&#8217;t mean that you have 10% chances of finding an Ellerman bomb in your data, because the test data I have is biased (I often do 10 to 20 scans in a row, within a few minutes, to perform stacking, so if a bomb is detected in an image, it has decent chances of being detected in the next one).
Also, I am using the term "Ellerman Bomb candidate", because there&#8217;s nothing better than visual confirmation to make sure that what you see is indeed an Ellerman bomb: an algorithm is not perfect, and it may fail for many reasons (noise, saturation, artifacts, etc.)</p>
</div>
<div class="paragraph">
<p>Here are a few examples of Ellerman bombs candidates detected in my data:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate1.jpg" alt="candidate1">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate2.jpg" alt="candidate2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate3.jpg" alt="candidate3">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate4.jpg" alt="candidate4">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate5.jpg" alt="candidate5">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate6.jpg" alt="candidate6">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post described my first visual Ellerman bomb detection.
Then I described how I implemented an algorithm to automatically detect Ellerman bombs in JSol&#8217;Ex 3.2.
I am very happy to release this to the wild, so that this kind of discovery is made more accessible to everyone.
Of course, as I always say, you should take the detections with care, and always review the results.
This is why you get both a global "map" of the detected bombs, and a detailed view of each bomb, which can be used to confirm the detection.
In addition, I recommend that you create animations of the regions, which you can simply do in JSol&#8217;Ex by CTLR+clicking on the image then selecting an area around the bomb.</p>
</div>
<div class="paragraph">
<p>Finally, I&#8217;d like to thank my friends of the Astro Club de Challans, who heard me talk about Ellerman bombs detection for a while, showing them preliminary results, and who were very supportive of my work.
Last but not least, thanks again to my wife for her patience, seeing me work on this (too) late at night!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibiography">Bibiography</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1917ApJ&#8230;&#8203;.46..298E/abstract">Ellerman, F. (1917) - Solar Hydrogen "Bombs"</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">S. Rondi, A. Rondi - Bombes d&#8217;Ellerman</a></p>
</li>
<li>
<p><a href="https://dx.doi.org/10.1051/0004-6361/201321632">N. Bello González , S. Danilovic , and F. Kneer - On the structure and dynamics of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://www.jstage.jst.go.jp/article/starsandgalaxies/6/0/6_3/_article/-char/en">R. Ichikawa, S. Nozawa - Detailed altitude analysis of Ellerman bomb using the domeless solar telescope at the Hida Observatory, Kyoto University</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1407.3048">Jie Hong, M. D. Ding, Ying Li, Cheng Fang, Wenda Cao - Spectral observations of Ellerman bombs and fitting with a two-cloud model</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1406.5702">A. Berlicki, P. Heinzel - Observations and NLTE modeling of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://adsabs.harvard.edu/full/2007ASPC..368..253P">E. Pariat, B. Schmieder, A. Berlicki., A. López Ariste - Spectrophotometry of Ellerman Bombs with THEMIS</a></p>
</li>
</ul>
</div>
</div>
</div></p>
  			<a href="/blog/2025/05-02-jsolex-3-1-0.html"><h1>Jagged Edges Correction with JSol&#8217;Ex 3.1</h1></a>
  			<p>02 May 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
<div class="paragraph">
<p>I&#8217;m happy to announce the release of JSol&#8217;Ex 3.1, which ships with a long awaited feature: jagged edges correction! Let&#8217;s explore in this article what this is about.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_dreaded_jagged_edges">The dreaded jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spectroheliographs like the Sol&#8217;Ex or the Sunscan are not using a traditional imaging system like, for example, in planetary imaging, where you can capture dozens to hundreds of frames per second and do the so called "lucky imaging" to get the best frames and stack them together to get a high resolution image.</p>
</div>
<div class="paragraph">
<p>In the case of a spectroheliograph, the image is built by scanning the solar disk in a series of "slices" of the sun: it takes several seconds and sometimes minutes (~3 minutes when you let the sun pass "naturally" through the slit) to get a full image of the sun.</p>
</div>
<div class="paragraph">
<p>In practice, this means that between each frame, each "slice" of the sun, the atmosphere will have slightly moved, causing some misalignment between the frames.
This is also particularly visible when there is some wind, which can cause the telescope to shake a bit, and the image to be misaligned.
Lastly, you may even have a mount which is not perfectly balanced, or which has some resonance at certain scan speeds.</p>
</div>
<div class="paragraph">
<p>As an illustration, let&#8217;s take this image captured using a Sunscan (courtesy of Oscar Canales):</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/original.jpg" alt="original">
</div>
</div>
<div class="paragraph">
<p>This image shows 3 problems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the jagged edges, which cause some unpleasant "spikes" on the edges of the sun</p>
</li>
<li>
<p>misalignment of features of the sun, particularly visible on filaments</p>
</li>
<li>
<p>a disk which isn&#8217;t perfectly round</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These issues are typical of spectroheliographs, and are the main limiting factor when it comes to achieving high resolution images.
Therefore, excellent seeing conditions are a must to get high quality images.
Even if you do stacking, the fact that the reference image will show spikes is often a problem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_correcting_jagged_edges">Correcting jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with release 3.1.0, JSol&#8217;Ex ships with an <strong>experimental</strong> feature to correct jagged edges.
It is not perfect yet, but good enough for you to provide feedback and even improve the quality of your images.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the same image, but with jagged edges correction applied:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/corrected.jpg" alt="corrected">
</div>
</div>
<div class="paragraph">
<p>And so that it&#8217;s even easier to see the difference, here&#8217;s a blinking animation of the two images:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/blink.gif" alt="blink">
</div>
</div>
<div class="paragraph">
<p>The jagged edges are now mostly gone, the features in the sun are better aligned, and the image is much more pleasant to look at.
There is still some jagging visible, the correction will never be perfect, but it is a good start.</p>
</div>
<div class="paragraph">
<p>In particular, you should be careful when applying the correction, because it could cause some artifacts in the image, in particular on prominences.
As usual, with great powers comes great responsibilities!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_does_it_work">How does it work?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To illustrate how the correction works, let&#8217;s imagine a perfect scan: a scan speed giving us a perfectly circular disk, no turbulence, no wind, etc.</p>
</div>
<div class="paragraph">
<p>In this case, what we would see during the scan is a spectrum which width slowly increases, reaches a maximum, and then decreases.
The pace at which the width increases and decreases is determined by the scan speed and is predictable.
In particular, the left and right borders of the spectrum will follow a circular curve.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get back to a "real world" scan.
In that case, the left and right edges will slightly deviate from the circular curve.
They will also follow the path of an ellipse: in fact, this ellipse is already required in order to perform geometric correction.</p>
</div>
<div class="paragraph">
<p>The idea is therefore quite simple in theory: we need to detect the left and right edges of the spectrum, then compare them to the ideal ellipse that we have computed.
Pixels which deviate from this curve give us an information about the jagged edges.
We can then compute a distortion map, which will be used to correct the image.</p>
</div>
<div class="paragraph">
<p>In practice, we also need to apply some filtering of samples: in practice, while the detection of edges is robust enough to provide us with a good geometric correction, it is not perfect.
It can also be skewed by the presence of proms for example.
Therefore, we are performing a sigma clipping on the detected edges, in order to remove outliers, that is to say pixels which deviate too much from the average deviation.</p>
</div>
<div class="paragraph">
<p>This is also why the correction will not work properly if the image is not focused correctly: you would combine two problems in one, and the correction would not be able to detect the edges properly.</p>
</div>
<div class="paragraph">
<p>In addition, in the image above you can see that the bottom most prominence is slightly distorted, which is caused by the fact that it&#8217;s far away from the 2 points which were used to compute the distortion.
It may be possible to reduce such artifacts by using a smaller sigma factor (at the risk of undercorrecting edges).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this blog post, I have described the new jagged edges correction feature in JSol&#8217;Ex 3.1.
This solves one of the most common issues users are having with spectroheliographs, and I hope it will help you get better images.
However, as usual, it&#8217;s a work in progress, so do not hesitate to provide feedback!</p>
</div>
</div>
</div></p>
	
	<hr />
	
	<p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
   <script>hljs.highlightAll();</script>
  </body>
</html>
