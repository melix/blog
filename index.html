<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <script defer data-domain="melix.github.io" src="https://analytics.champeau.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		          <li><a href="/blog/projects.html">Projects</a></li>
				    <li><a href="/blog/jsolex.html">JSol'Ex</a></li>
		<li><a href="/blog/astrophotography.html">Astrophotography</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
		          <li><a href="/blog/tags/jsolex.html">JSol'Ex</a></li>
				    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://bsky.app/profile/melix.champeau.me"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">

	<div class="page-header">
		<h1>Blog</h1>
	</div>
  			<a href="/blog/2025/09-11-jsolex-4.0.0.html"><h1>JSol&#8217;Ex 4.0.0 est sorti !</h1></a>
  			<p>11 septembre 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solaire.html">solaire</a> 
	
		<a href="/blog/tags/astronomie.html">astronomie</a> 
	
		<a href="/blog/tags/ia.html">ia</a> 
	
		<a href="/blog/tags/claude.html">claude</a> 
	
		<a href="/blog/tags/bass2000.html">bass2000</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Le 18 février 2023, je montais à l&#8217;Observatoire du Pic du Midi de Bigorre pour y passer une "Nuit au Sommet", une expérience mêlant observation nocturne et visite des installations scientifiques. J&#8217;y ai découvert avec fascination le coronographe Bernard-Lyot, l&#8217;expérience <a href="https://climso.fr/">CLIMSO</a> gérée par les Observateurs Associés de l&#8217;Observatoire Midi-Pyrénées.</p>
</div>
<div class="paragraph">
<p>Des étoiles plein les yeux (et une en particulier, notre soleil), ma vie d&#8217;astronome amateur centrée sur le ciel profond allait basculer vers l&#8217;observation de notre Soleil. De retour à la maison, j&#8217;ai commencé à me renseigner sur le matériel solaire, et découvrait avec stupéfaction qu&#8217;il fallait investir, beaucoup, pour pouvoir observer notre astre en toute sécurité : filtres pleine ouverture, étalons, &#8230;&#8203; tout avait un coût démesuré pour un débutant comme moi. De quoi décourager, jusqu&#8217;à ce que je tombe par hasard <a href="http://www.astrosurf.com/solex/">sur le projet Sol&#8217;Ex</a>, initié par la légende Christian Buil.</p>
</div>
<div class="paragraph">
<p>Ce projet, très didactique, permet de se construire un spectrohéliographe, par impression 3D. Un tel instrument présente de nombreux avantages : coût modeste, résolution élevée et la possibilité d&#8217;observer dans de nombreuses longueurs d&#8217;ondes tout en mettant à disposition des données exploitables scientifiquement !</p>
</div>
<div class="paragraph">
<p>L&#8217;inconvénient, si c&#8217;en est vraiment un, de cet instrument est qu&#8217;il ne produit pas une image du soleil observable directement à l&#8217;oculaire. Il est nécessaire d&#8217;utiliser un logiciel de reconstruction qui, à partir d&#8217;une vidéo enregistrant un "scan" du soleil, permet de générer une (voir plus) images du soleil. Ce processus de reconstruction, bien mystérieux pour moi à l&#8217;époque, était réalisé par un <a href="http://valerie.desnoux.free.fr/inti/">logiciel écrit par Valérie Desnoux, nommé INTI</a>. Etant développeur (Java), je me suis alors lancé un challenge à l&#8217;époque : puisque je ne comprenais pas comment ça fonctionnait, j&#8217;allais essayer de créer moi-même un logiciel pour faire cette reconstruction. De cet appétit est né <a href="https://melix.github.io/astro4j/latest/fr/jsolex.html">JSol&#8217;Ex</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_4_0_et_la_collaboration_scientifique">JSol&#8217;Ex 4.0 et la collaboration scientifique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous voici 2 ans et demi plus tard, JSol&#8217;Ex arrive en version 4. Entre temps, le nombre d&#8217;utilisateurs a explosé et mon logiciel est exploité non seulement par les utilisateurs du Sol&#8217;Ex de Christian Buil, mais aussi pour des spectrohéliographes commerciaux comme le <a href="https://mlastro.com/mlastro-shg">MLAstro SHG 700</a> (que j&#8217;utilise désormais). JSol&#8217;Ex a apporté de nombreuses innovations, comme la possibilité d&#8217;exécuter des scripts pour générer des animations, faire du stacking, créer des images personnalisées, ou encore la détection automatique d&#8217;éruptions, des régions actives (avec annotation), la détection de bombes d&#8217;Ellerman, la correction des bords dentelés et j&#8217;en passe.</p>
</div>
<div class="paragraph">
<p>Récemment, JSol&#8217;Ex a été utilisé pour réaliser un <a href="https://iopscience.iop.org/article/10.3847/2515-5172/adef50">Atlas de Spectrohéliogrammes</a>, et mentionné dans <a href="https://arxiv.org/abs/2508.10853">un article précisément sur la détection des bombes d&#8217;Ellerman</a>. Bref, JSol&#8217;Ex était devenu suffisamment mature pour faire de la "vraie science", chose qui m&#8217;a toujours un peu effrayé pour être honnête.</p>
</div>
<div class="paragraph">
<p>Ainsi, j&#8217;ai toujours refusé d&#8217;intégrer une fonctionnalité dans JSol&#8217;Ex, qui m&#8217;a pourtant été demandée de nombreuses fois : la possibilité de l&#8217;utiliser pour soumettre des images dans la <a href="https://bass2000.obspm.fr/">base de données BASS2000</a> de l&#8217;<a href="https://www.linkedin.com/school/lira-observatoire-de-paris/">Observatoire de Paris-Meudon</a>. Plusieurs raisons à cela : d&#8217;une, je ne faisais pas confiance à mon propre logiciel pour sa qualité "scientifique". Si je le savais capable de produire de "belles images", il est tout à fait différent de s&#8217;en servir pour une exploitation scientifique. D&#8217;autre part, il n&#8217;était pas question pour moi d&#8217;intégrer une fonctionnalité qui avait été développée par Valérie Desnoux (autrice de INTI) et l&#8217;équipe de Meudon sans son accord, par respect pour son travail.</p>
</div>
<div class="paragraph">
<p>Cependant, vous aurez compris que les temps ont changé et que la pression des utilisateurs ainsi que mes discussions avec Florence Cornu, du projet SOLAP, aux Rencontres du Ciel et de l&#8217;Espace fin 2024, puis aux <a href="https://www.mars60.fr/jason2025/">JASON</a> en Juin dernier ont eu raison de mes doutes. Avec son accord et celui de Valérie, je suis donc heureux de vous annoncer que JSol&#8217;Ex 4 est officiellement supporté pour soumettre vos images dans la base de données BASS 2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_un_assistant_pas_à_pas">Un assistant pas à pas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ne souhaitant pas faire les choses à moitié, j&#8217;ai particulièrement peaufiné le logiciel pour simplifier cette procédure. J&#8217;ai souhaité faire les choses avec sérieux, puisqu&#8217;il s&#8217;agit d&#8217;une base de données professionnelle, exploitée par des scientifiques. Ainsi, une chose importante pour moi était de guider l&#8217;utilisateur dans ce processus et de lui faire comprendre l&#8217;importance de la qualité des données, tout en simplifiant le processus de soumission.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/bass2000.jpg" alt="bass2000">
</div>
<div class="title">Figure 1. Assistant de soumission BASS2000</div>
</div>
<div class="paragraph">
<p>Ainsi par exemple, BASS2000 n&#8217;a que très peu de tolérance sur les problèmes d&#8217;orientation de l&#8217;image : il faut que le Nord solaire soit à moins de 1 degré d&#8217;erreur, sinon l&#8217;image sera refusée. L&#8217;assistant intègre donc un outil pour aider à vérifier l&#8217;orientation et corriger les erreurs minimes dues par exemple à une mise en station imparfaite.</p>
</div>
<div class="paragraph">
<p>L&#8217;assistant guidera aussi l&#8217;utilisateur dans son processus de soumission, en lui demandant de bien vérifier toutes les métadonnées associées à l&#8217;observation, et ira jusqu&#8217;à envoyer l&#8217;image sur le serveur FTP de BASS2000 pour validation par les équipes.</p>
</div>
<div class="paragraph">
<p>Je suis particulièrement reconnaissant à Florence CORNU pour son aide afin que les images JSol&#8217;Ex soient acceptées dans la base et je remercie mes beta-testeurs qui ont patiemment testé mes versions de développement pendant l&#8217;été.</p>
</div>
<div class="paragraph">
<p>Je ne vous cache pas qu&#8217;il s&#8217;agit là d&#8217;une forme de reconnaissance de mon travail, des centaines d&#8217;heures passées soirs et week-ends à développer ce logiciel qui rappelons-le est <a href="https://github.com/melix/astro4j">entièrement Open Source et gratuit</a>.</p>
</div>
<div class="paragraph">
<p>Enfin, je ne peux pas m&#8217;arrêter sans vous annoncer une deuxième bonne nouvelle : non seulement vous pourrez utiliser JSol&#8217;Ex pour soumettre vos images acquises avec un Sol&#8217;Ex, mais aussi avec le MLAstro SHG 700, qui devient officiellement supporté dans la base BASS2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changements_dans_linterface">Changements dans l&#8217;interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour cette version j&#8217;ai aussi souhaité moderniser un peu l&#8217;interface graphique et la simplifier : avec le nombre de fonctionnalités croissantes arrive ce moment fatidique que tout développeur redoute : que l&#8217;interface ne devienne trop complexe pour les nouveaux utilisateurs et ne parle qu&#8217;aux anciens. J&#8217;ai essayé d&#8217;éviter cet écueil au cours du temps en refusant certaines fonctionnalités trop "de niche", mais sans pouvoir pour autant réussir à avoir une interface totalement claire.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/interface-overview.jpg" alt="interface overview">
</div>
<div class="title">Figure 2. Aperçu des changements d&#8217;interface</div>
</div>
<div class="paragraph">
<p>Cette nouvelle version essaie donc de regrouper les paramètres par sections plus claires, tout en ajoutant des infobulles pour guider les utilisateurs, anciens comme nouveaux, dans cet esprit qui est que le logiciel se doit d&#8217;être le plus didactique possible : j&#8217;essaie, autant que faire se peut, de vous transmettre en tant qu&#8217;utilisateurs ce que moi-même j&#8217;apprends en développant ce logiciel. Un exemple frappant de cette philosophie, c&#8217;est cette fonctionnalité que j&#8217;avais ajoutée qui permet de montrer en cliquant sur le disque solaire, à quelle image il correspond dans le fichier source (une vidéo contenant des spectres).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_détection_dellipse_assistée_par_lutilisateur">Détection d&#8217;ellipse assistée par l&#8217;utilisateur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je vous parlais un peu plus haut de l&#8217;Atlas des Spectrohéliogrammes. Cet atlas, réalisé par Pál Váradi Nagy, nécessite un travail énorme d&#8217;analyse des données et est réalisé à l&#8217;aide de scripts JSol&#8217;Ex. Cependant, pour certaines longueurs d&#8217;ondes ou pour parfois des images un peu compliquées à traiter, le logiciel peut échouer à détecter correctement les contours du disque solaire. Ceci peut arriver notamment lorsque les images sont peu contrastées ou lorsqu&#8217;il y a des réflexions internes qui biaisent la détection.</p>
</div>
<div class="paragraph">
<p>Afin de résoudre ces cas complexes qui, encore une fois, nuisent à l&#8217;analyse scientifiques, j&#8217;ai ajouté la possibilité d&#8217;aider le logiciel à détecter les contours, et ainsi à obtenir un image solaire bien ronde:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/ellipse-detection-assistant.jpg" alt="ellipse detection assistant">
</div>
<div class="title">Figure 3. Détection d&#8217;ellipse assistée par l&#8217;utilisateur</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lia_à_la_rescousse">L&#8217;IA à la rescousse</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je suis développeur et en tant que tel, sur ce media, il me semblait pertinent d&#8217;ajouter une section sur la façon dont cette version a été développée.</p>
</div>
<div class="paragraph">
<p>Cette version est la première version qui a été développée avec l&#8217;aide de l&#8217;IA, en particulier Claude Code. En effet, les dernières innovations en matière d&#8217;IA agentique sont pour le coup la véritable révolution à venir : autant avant, avoir une IA qui n&#8217;était pas capable de comprendre le contexte, faire des refactorings ou prévoir un plan de développement ne les rendait pas particulièrement utiles, autant les IA à base d&#8217;agents, qui sont capables d&#8217;analyser votre code, appeler des outils de manière autonome et avoir de vraies interactions avec vous sont un "game changer" de mon point de vue.</p>
</div>
<div class="paragraph">
<p>Dans cette version, j&#8217;ai donc utilisé Claude Code (plan Pro) pour m&#8217;aider à faire les refactorings dont j&#8217;avais besoin et m&#8217;assister dans une tâche où je ne suis pas particulièrement à l&#8217;aise : le design d&#8217;interfaces graphiques.</p>
</div>
<div class="paragraph">
<p>De manière générale, ça fonctionne plutôt bien. Très bien même. La capacité de l&#8217;outil à définir un plan d&#8217;implémentation et comprendre les besoins est assez fascinante. Le code généré, en revanche, nécessite toujours beaucoup de review. On pourrait dire que j&#8217;ai l&#8217;impression d&#8217;avoir un (très bon) stagiaire avec moi, en permanence. En tant que développeur senior, je suis assez rapide à identifier là où l&#8217;IA complique les choses inutilement, ou utilise des design pattern dépréciés, ou ne respecte pas les conventions de code. Je serai, par exemple, terrifié si le code original produit était parti en production sans review. Mais, en lui donnant les bonnes directions, en lui expliquant ses erreurs, on arrive rapidement à ce que l&#8217;on souhaite avec la qualité que l&#8217;on souhaite.</p>
</div>
<div class="paragraph">
<p>Quelques exemples de choses qui ne fonctionnent pour le coup vraiment pas bien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Claude vous demande de créer un fichier CLAUDE.md qui comprend des instructions sur comment compiler votre projet, comment il est organisé, etc. Bref, du contexte qui est systématiquement ajouté à chaque session. Pourtant, à l&#8217;utilisation, Claude ignore allègrement ces instructions.</p>
</li>
<li>
<p>En Java, les fichiers .properties sont encodés en ISO-8859-1, même dans une base où tous les sources sont en UTF-8. C&#8217;est une bizarrerie historique, mais Claude ne la comprend absolument pas. A chaque fois qu&#8217;il modifie mes fichiers properties (qui servent à l&#8217;internationalisation de l&#8217;interface), il casse systématiquement l&#8217;encodage. Pour l&#8217;éviter, le dois systématiquement, avant de lui faire faire une opération dont je sais qu&#8217;elle implique ces fichiers, lui dire "respecte les guidelines du fichier CLAUDE" où je lui ai donné une technique pour éviter les problèmes (convertir le fichier en UTF-8, puis l&#8217;éditer, puis le reconvertir en ISO-8859-1)</p>
</li>
<li>
<p>Les commentaires dans le code. Quand on commence à avoir un peu de bouteille comme moi, il est assez insupportable de lire des commentaires "captain obvious", ce genre de commentaires qui dit "la ligne suivante calcule 1+1". Claude en génère beaucoup. Trop. Et malgré le fait que mon fichier CLAUDE lui interdise explicitement.</p>
</li>
<li>
<p>La confiance en soi. Claude est bien trop optimiste et tend trop à flatter l&#8217;utilisateur. Par exemple, si je lui mens explicitement ("ton algorithme est faux parce que XXX"), il répondra systématiquement "Tu as raison !" sans "réfléchir" (j&#8217;utilise les guillemets avec intention), comme un tic de langage ! Ca devient assez frustrant à la longue, lorsqu&#8217;il ne comprend pas un problème ou complique inutilement l&#8217;implémentation.</p>
</li>
<li>
<p>Les limites : on arrive, sur un projet de la taille de JSol&#8217;Ex, très rapidement aux limites d&#8217;usage même sur un forfait Pro. Si je suis satisfait de ce que ça m&#8217;apporte pour le prix, je ne suis pas prêt à payer les 200€ / mois pour augmenter ces limites. N&#8217;oublions pas que je fais ça sur mon temps libre&#8230;&#8203; je n&#8217;ai aucune obligation de résultat !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quoi qu&#8217;il en soit, il s&#8217;agit là d&#8217;avancées qu&#8217;il devient difficile d&#8217;ignorer. Et ceux qui me connaissent savent à quel point je suis critique sur l&#8217;utilisation des IA, les mythes autour de ce qu&#8217;elle est capable de faire et son impact écologique. Néanmoins, une chose est certaine : les dirigeants qui pensent économiser du temps et de l&#8217;argent en virant leurs développeurs pour les remplacer par de l&#8217;IA se mettent une balle dans le pied : elle pose de sérieux problèmes de qualité de code et donc de maintenance, et, avec l&#8217;arrivée des agents, posent de graves problèmes de sécurité (un outil autonome qui décide par lui même s&#8217;il faut vous demander l&#8217;autorisation pour exécuter une commande !"). L&#8217;IA doit être vue comme une aide à la productivité, mais qui doit être cadrée par des gens d&#8217;expérience. Bref, nous sommes à un tournant et je ne suis pas encore bien à l&#8217;aise avec ce que cela implique. Nous n&#8217;avons jamais été aussi près du rêve de gosse que j&#8217;avais d&#8217;IA "autonomes", mais la maturité me force à en avoir peur.</p>
</div>
<div class="paragraph">
<p>Mais nous nous éloignons là du sujet initial et concluons donc ce billet : dites bienvenue à JSol&#8217;Ex 4, consultez la vidéo de présentation ci-dessous et n&#8217;hésitez pas à contribuer !</p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/4SPKsNvnzKo?si=KuqIIMc1H6SLgVec" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div></p>
  			<a href="/blog/2025/05-19-jsolex-3-2-0.html"><h1>Ellerman Bombs Detection with JSol&#8217;Ex 3.2</h1></a>
  			<p>17 mai 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	
		<a href="/blog/tags/ellerman.html">ellerman</a> 
	
		<a href="/blog/tags/bombs.html">bombs</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
</div>
</div>
<div class="sect1">
<h2 id="_about_ellerman_bombs">About Ellerman Bombs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ellerman bombs were first described by Ferdinand Ellerman back in 1917.
Ellerman&#8217;s article was named -Solar Hydrogen "Bombs"- and it&#8217;s only later that these were commonly referred to as "Ellerman bombs".</p>
</div>
<div class="paragraph">
<p>I came upon this term while reading <a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">an article from Sylvain or André Rondi</a> quite early in my solar imaging journey, and I was since then obsessed by these phenomena.</p>
</div>
<div class="paragraph">
<p>Ellerman Bombs are small, transient, and explosive events that occur in the solar atmosphere, particularly in the vicinity of sunspots.
These are very short lived compared to other solar features: from several dozens of seconds to a few minutes.
The most common explanation is magnetic reconnection, which occurs when two magnetic regions opposite polarity come into contact and reconnect, releasing energy in the form of heat and light.
This is for example described in <a href="https://dx.doi.org/10.1051/0004-6361/201321632">this article from González, Danilovic and Kneer</a>.</p>
</div>
<div class="paragraph">
<p>Amateur observations of Ellerman bombs are quite rare, but Rondi described such observations using a spectroheliograph back in 2005.
They are rare because they are mostly invisible where the amateur observations are made (the center of the H-alpha line), and are too small to notice.
However, these are visible in the wings of the H-alpha line: this is where a spectroheliograph comes in handy, since the cropping window that is used to capture an image contains more than just the H-alpha line.</p>
</div>
<div class="paragraph">
<p>I had a <a href="https://github.com/melix/astro4j/issues/382">long standing issue</a> to do something about it in JSol&#8217;Ex, and I finally got around to it: all it took was getting some test data to entertain the ideas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_observation_of_an_ellerman_bomb">Observation of an Ellerman Bomb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I am doing many observations of the sun: I started in 2023 with a Sol&#8217;Ex, then I recently got an SHG 700, so I have accumulated quite a bit of data, which is completed by scans which are shared with me by other users of JSol&#8217;Ex.</p>
</div>
<div class="paragraph">
<p>I have been looking for Ellerman bombs in my data, but I never found any yet.
This changed a couple weeks ago: I was doing some routine work on JSol&#8217;Ex and using a capture I had done in April, 29, 2025 at 08:32 UTC, when I noticed, by accident, a bright spot in the continuum image:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/continuum.jpg" alt="continuum">
</div>
</div>
<div class="paragraph">
<p>It may not be obvious at first, which is precisely why these are hard to spot, so here&#8217;s a hint:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/zoom-continuum.png" alt="zoom continuum">
</div>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex offers the ability to easily generate animations of the data captured at different wavelengths, so I generated a quick animation, which shows the same image at ±2.5Å from the center of the H-alpha line:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/anim_ellerman.gif" alt="anim ellerman">
</div>
</div>
<div class="paragraph">
<p>We can see the typical behavior of an Ellerman bomb: it is bright in the wings of the H-alpha line,  but it vanishes when we are at the center of the line.
The fine spectral dispersion of the spectroheliograph makes it possible to highlight this phenomenon very precisely.</p>
</div>
<div class="paragraph">
<p>The corresponding frame of the SER file shows the aspect of the Ellerman bomb in the spectrum:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-spectrum.png" alt="ellerman spectrum">
</div>
</div>
<div class="paragraph">
<p>The shape that you can see is often referred to as the "moustache".
At this stage I was pretty sure I had observed my first Ellerman bomb, and that I could implement an algorithm to detect it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_3_2_auto_detection">JSol&#8217;Ex 3.2 auto-detection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSol&#8217;Ex 3.2 ships with a new feature to automatically detect Ellerman bombs in the data.
Currently, it is limited to H-alpha, but it should be possible to detect these in CaII as well.</p>
</div>
<div class="paragraph">
<p>The algorithm I implemented uses statistical analysis of the spectrum to match the characteristics of the "moustache" shape, in particular:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a maximum of intensity around 1Å from the center of the line</p>
</li>
<li>
<p>a distance which spreads up to 5Å from the center of the line</p>
</li>
<li>
<p>a brightening which is only visible in the wings of the line</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex will generate, for each detection, an image showing the location of the detected bombs:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/ellerman-location.jpg" alt="ellerman location">
</div>
</div>
<div class="paragraph">
<p>And for each bomb, it will create an image which shows the region of the spectrum which is used to detect the bomb.
This is for example what is automatically generated for the bomb described above:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/spectrum-detection.jpg" alt="spectrum detection">
</div>
</div>
<div class="sect2">
<h3 id="_algorithm_details">Algorithm details</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a description of the algorithm that I implemented in an <em>adhoc</em> fashion: I&#8217;m not a mathematician nor a scientist: I&#8217;m an engineer and the algorithm above was implemented using my "intuition" of what I thought would work. It is likely to change as new versions are released.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The algorithm is based on the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for each frame in the SER file, identify the "borders" of the sun</p>
</li>
<li>
<p>perform a Gaussian blur on the spectrum to reduce noise</p>
</li>
<li>
<p>within the borders, compute, for each column, the average intensity of the spectrum for the center of the line and the wings separately. The center of the line is defined as the range [-0.35Å, 0.35Å] and the wings as the range [-5Å, -0.35Å[ ∪ ]0.35Å, 5Å]</p>
</li>
<li>
<p>compute the maximum intensity of the wings, starting from the center of the line, and going outwards until we reach the maximum intensity (local extremum)</p>
</li>
<li>
<p>compute the average of each column average intensity for the wings (the "global average")</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With Ellerman bomb scoring parameters defined below, the algorithm proceeds per column:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For each column index <code>x</code> in the spectrum image:</p>
</li>
<li>
<p>Build a neighborhood of up to 16 columns around <code>x</code>:
<code>Nₓ = { x + k  |  k ∈ ℤ,  |k| ≤ 8 }</code>, clamped to the image boundaries.</p>
</li>
<li>
<p>Compute the overall mean column intensity
<code>Ī_global = (1 / N_total) ∑_{j=1..N_total} Ī(j)</code>.</p>
</li>
<li>
<p>Exclude any columns in <code>Nₓ</code> whose average intensity falls below 90 % of <code>Ī_global</code>, since very dark columns (usually sunspots) would pull down our estimate of the local wing background and hide true brightening events. Call the remaining set <code>Mₓ</code> and let <code>m = |Mₓ|</code>.</p>
</li>
<li>
<p>If <code>m &lt; 1</code>, there aren’t enough valid neighbors to form a reliable background—skip column <code>x</code>.</p>
</li>
<li>
<p>On the Gaussian-smoothed data, measure three key values at column <code>x</code>:</p>
</li>
<li>
<p><code>c₀ ≔ I_center(x)</code>, the mean intensity in the core region of the spectral line.</p>
</li>
<li>
<p><code>c_w ≔ I_wing(x)</code>, the average intensity across the two wing windows at ±1 Å.</p>
</li>
<li>
<p><code>c_max ≔ max_{p ∈ wing-pixels nearest ±1 Å} I(p, x)</code>, the single highest wing intensity near the expected shift.</p>
</li>
<li>
<p>Compute the local wing background
<code>r₀ = (1 / (m−1)) ∑_{j ∈ Mₓ, j≠x} I_wing(j)</code>.
Using only nearby “bright enough” columns keeps the background estimate from being skewed by dark features.</p>
</li>
<li>
<p>Define a line-brightening factor
<code>B = max(1, c₀ / min(r₀, I_center,global))</code>.
Ellerman bombs boost the wings without greatly brightening the core, whereas flares brighten both.</p>
</li>
<li>
<p>Form an initial score
<code>S₀ = 1 + c_max / min(r₀, I_wing,global)</code>,
where <code>I_wing,global = (1/N_total) ∑_{j=1..N_total} I_wing(j)</code>.
This compares the local wing peak to the typical wing level across the image.</p>
</li>
<li>
<p>Adjust for how many neighbors were used:
<code>S₁ = S₀ × (m / 16)</code>.
Fewer valid neighbors mean less confidence, so the score is scaled down proportionally.</p>
</li>
<li>
<p>Compute the wing-to-background ratio
<code>rᵢ = c_max / r₀</code>.
If <code>rᵢ ≤ 1.05</code>, the wing peak is too close to the local background and the column is discarded. Otherwise, we boost the score further:</p>
</li>
<li>
<p>Raise <code>S₁</code> to the power of <code>e^{rᵢ}</code>, giving
<code>S₂ = S₁^( e^{rᵢ} )</code>.
This makes the score grow quickly when the wing peak stands out strongly.</p>
</li>
<li>
<p>Multiply by <code>√(c_max / c₀)</code> to get
<code>S₃ = S₂ · √(c_max / c₀)</code>.
That emphasizes cases where the wings are much brighter than the core.</p>
</li>
<li>
<p>Finally, penalize any shift away from the ideal ±1 Å wing position. If <code>y_core</code> and <code>y_max</code> are the pixel locations of line center and wing peak, compute
<code>Δλ = |y_max – y_core| × (Å / pixel)</code>,
then
<code>S_final = S₃ / (1 + |1 Å – Δλ|)</code>.</p>
</li>
<li>
<p>If <code>S_final &gt; 12</code>, mark column <code>x</code> as a candidate event. Use the value of <code>B</code> to decide:</p>
</li>
<li>
<p>When <code>B &lt; 1.5</code>, it behaves like an Ellerman bomb (wings bright, core unchanged).</p>
</li>
<li>
<p>When <code>B &gt; 2</code>, it matches a flare (both core and wings bright).</p>
</li>
<li>
<p>If <code>1.5 ≤ B ≤ 2</code>, the result is ambiguous and ignored.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All thresholds (0.9× global mean, 1.05 ratio, score &gt; 12, B cutoffs) were chosen by testing on data and visually inspecting results.</p>
</div>
</div>
<div class="sect2">
<h3 id="_post_filtering">Post-filtering</h3>
<div class="paragraph">
<p>There will often be cases where the same bomb is detected in multiple frames.
Therefore, we need to do some merging of bombs which are spatially connected.</p>
</div>
<div class="paragraph">
<p>Eventually, we apply a limit threshold: if there are more than 5 Ellerman Bombs detected in an image, then we consider the detection to be false positives (this happens typically on saturated images, or images with too much noise).
This is a bit arbitrary, but it seems to work well in practice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_data">Test data</h3>
<div class="paragraph">
<p>I had about ~1100 scans I could reuse for detection, and it successfully discovered Ellerman bombs candidates in about 10% of them.
Of course this required some tuning and several runs to get the parameters right.
This doesn&#8217;t mean that you have 10% chances of finding an Ellerman bomb in your data, because the test data I have is biased (I often do 10 to 20 scans in a row, within a few minutes, to perform stacking, so if a bomb is detected in an image, it has decent chances of being detected in the next one).
Also, I am using the term "Ellerman Bomb candidate", because there&#8217;s nothing better than visual confirmation to make sure that what you see is indeed an Ellerman bomb: an algorithm is not perfect, and it may fail for many reasons (noise, saturation, artifacts, etc.)</p>
</div>
<div class="paragraph">
<p>Here are a few examples of Ellerman bombs candidates detected in my data:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate1.jpg" alt="candidate1">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate2.jpg" alt="candidate2">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate3.jpg" alt="candidate3">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate4.jpg" alt="candidate4">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate5.jpg" alt="candidate5">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/ellerman/candidate6.jpg" alt="candidate6">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post described my first visual Ellerman bomb detection.
Then I described how I implemented an algorithm to automatically detect Ellerman bombs in JSol&#8217;Ex 3.2.
I am very happy to release this to the wild, so that this kind of discovery is made more accessible to everyone.
Of course, as I always say, you should take the detections with care, and always review the results.
This is why you get both a global "map" of the detected bombs, and a detailed view of each bomb, which can be used to confirm the detection.
In addition, I recommend that you create animations of the regions, which you can simply do in JSol&#8217;Ex by CTLR+clicking on the image then selecting an area around the bomb.</p>
</div>
<div class="paragraph">
<p>Finally, I&#8217;d like to thank my friends of the Astro Club de Challans, who heard me talk about Ellerman bombs detection for a while, showing them preliminary results, and who were very supportive of my work.
Last but not least, thanks again to my wife for her patience, seeing me work on this (too) late at night!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibiography">Bibiography</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1917ApJ&#8230;&#8203;.46..298E/abstract">Ellerman, F. (1917) - Solar Hydrogen "Bombs"</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/rondi/obs/shg/Bombes_ellerman.htm">S. Rondi, A. Rondi - Bombes d&#8217;Ellerman</a></p>
</li>
<li>
<p><a href="https://dx.doi.org/10.1051/0004-6361/201321632">N. Bello González , S. Danilovic , and F. Kneer - On the structure and dynamics of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://www.jstage.jst.go.jp/article/starsandgalaxies/6/0/6_3/_article/-char/en">R. Ichikawa, S. Nozawa - Detailed altitude analysis of Ellerman bomb using the domeless solar telescope at the Hida Observatory, Kyoto University</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1407.3048">Jie Hong, M. D. Ding, Ying Li, Cheng Fang, Wenda Cao - Spectral observations of Ellerman bombs and fitting with a two-cloud model</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/1406.5702">A. Berlicki, P. Heinzel - Observations and NLTE modeling of Ellerman bombs</a></p>
</li>
<li>
<p><a href="https://adsabs.harvard.edu/full/2007ASPC..368..253P">E. Pariat, B. Schmieder, A. Berlicki., A. López Ariste - Spectrophotometry of Ellerman Bombs with THEMIS</a></p>
</li>
</ul>
</div>
</div>
</div></p>
  			<a href="/blog/2025/05-02-jsolex-3-1-0.html"><h1>Jagged Edges Correction with JSol&#8217;Ex 3.1</h1></a>
  			<p>02 mai 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
<div class="paragraph">
<p>I&#8217;m happy to announce the release of JSol&#8217;Ex 3.1, which ships with a long awaited feature: jagged edges correction! Let&#8217;s explore in this article what this is about.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_dreaded_jagged_edges">The dreaded jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spectroheliographs like the Sol&#8217;Ex or the Sunscan are not using a traditional imaging system like, for example, in planetary imaging, where you can capture dozens to hundreds of frames per second and do the so called "lucky imaging" to get the best frames and stack them together to get a high resolution image.</p>
</div>
<div class="paragraph">
<p>In the case of a spectroheliograph, the image is built by scanning the solar disk in a series of "slices" of the sun: it takes several seconds and sometimes minutes (~3 minutes when you let the sun pass "naturally" through the slit) to get a full image of the sun.</p>
</div>
<div class="paragraph">
<p>In practice, this means that between each frame, each "slice" of the sun, the atmosphere will have slightly moved, causing some misalignment between the frames.
This is also particularly visible when there is some wind, which can cause the telescope to shake a bit, and the image to be misaligned.
Lastly, you may even have a mount which is not perfectly balanced, or which has some resonance at certain scan speeds.</p>
</div>
<div class="paragraph">
<p>As an illustration, let&#8217;s take this image captured using a Sunscan (courtesy of Oscar Canales):</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/original.jpg" alt="original">
</div>
</div>
<div class="paragraph">
<p>This image shows 3 problems:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the jagged edges, which cause some unpleasant "spikes" on the edges of the sun</p>
</li>
<li>
<p>misalignment of features of the sun, particularly visible on filaments</p>
</li>
<li>
<p>a disk which isn&#8217;t perfectly round</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These issues are typical of spectroheliographs, and are the main limiting factor when it comes to achieving high resolution images.
Therefore, excellent seeing conditions are a must to get high quality images.
Even if you do stacking, the fact that the reference image will show spikes is often a problem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_correcting_jagged_edges">Correcting jagged edges</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting with release 3.1.0, JSol&#8217;Ex ships with an <strong>experimental</strong> feature to correct jagged edges.
It is not perfect yet, but good enough for you to provide feedback and even improve the quality of your images.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the same image, but with jagged edges correction applied:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/corrected.jpg" alt="corrected">
</div>
</div>
<div class="paragraph">
<p>And so that it&#8217;s even easier to see the difference, here&#8217;s a blinking animation of the two images:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex_3_1/blink.gif" alt="blink">
</div>
</div>
<div class="paragraph">
<p>The jagged edges are now mostly gone, the features in the sun are better aligned, and the image is much more pleasant to look at.
There is still some jagging visible, the correction will never be perfect, but it is a good start.</p>
</div>
<div class="paragraph">
<p>In particular, you should be careful when applying the correction, because it could cause some artifacts in the image, in particular on prominences.
As usual, with great powers comes great responsibilities!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_does_it_work">How does it work?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To illustrate how the correction works, let&#8217;s imagine a perfect scan: a scan speed giving us a perfectly circular disk, no turbulence, no wind, etc.</p>
</div>
<div class="paragraph">
<p>In this case, what we would see during the scan is a spectrum which width slowly increases, reaches a maximum, and then decreases.
The pace at which the width increases and decreases is determined by the scan speed and is predictable.
In particular, the left and right borders of the spectrum will follow a circular curve.</p>
</div>
<div class="paragraph">
<p>Now, let&#8217;s get back to a "real world" scan.
In that case, the left and right edges will slightly deviate from the circular curve.
They will also follow the path of an ellipse: in fact, this ellipse is already required in order to perform geometric correction.</p>
</div>
<div class="paragraph">
<p>The idea is therefore quite simple in theory: we need to detect the left and right edges of the spectrum, then compare them to the ideal ellipse that we have computed.
Pixels which deviate from this curve give us an information about the jagged edges.
We can then compute a distortion map, which will be used to correct the image.</p>
</div>
<div class="paragraph">
<p>In practice, we also need to apply some filtering of samples: in practice, while the detection of edges is robust enough to provide us with a good geometric correction, it is not perfect.
It can also be skewed by the presence of proms for example.
Therefore, we are performing a sigma clipping on the detected edges, in order to remove outliers, that is to say pixels which deviate too much from the average deviation.</p>
</div>
<div class="paragraph">
<p>This is also why the correction will not work properly if the image is not focused correctly: you would combine two problems in one, and the correction would not be able to detect the edges properly.</p>
</div>
<div class="paragraph">
<p>In addition, in the image above you can see that the bottom most prominence is slightly distorted, which is caused by the fact that it&#8217;s far away from the 2 points which were used to compute the distortion.
It may be possible to reduce such artifacts by using a smaller sigma factor (at the risk of undercorrecting edges).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this blog post, I have described the new jagged edges correction feature in JSol&#8217;Ex 3.1.
This solves one of the most common issues users are having with spectroheliographs, and I hope it will help you get better images.
However, as usual, it&#8217;s a work in progress, so do not hesitate to provide feedback!</p>
</div>
</div>
</div></p>
  			<a href="/blog/2025/04-14-jsolex-3-0-0.html"><h1>JSol&#8217;Ex 3.0.0 is out!</h1></a>
  			<p>14 avril 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<style>
.videoWrapper {
  position: relative;
  padding-bottom: 56.25%;
  /* 16:9 */
  padding-top: 25px;
  height: 0;
}

.videoWrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
</style>
<div class="paragraph">
<p>After dozens of hours of work, I&#8217;m happy to announce the release of JSol&#8217;Ex 3.0.0!
This major release is a new milestone in the development of JSol&#8217;Ex, and it brings new features and improvements that I hope you will enjoy.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_bit_of_history">A bit of history</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since its inception as an educational project for understanding how the Sol&#8217;Ex works, JSol&#8217;Ex has grown into a powerful tool for processing and analyzing images captured with the Sol&#8217;Ex.
However, it became very popular over time and started to be used outside the sole Sol&#8217;Ex community.
In particular, it is now a tool of choice for many spectroheliographs owners.</p>
</div>
<div class="paragraph">
<p>I have always been keen on providing a user-friendly interface while keeping a good innovation pace.
JSol&#8217;Ex was the first SHG software to offer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>automatic colorization of images</p>
</li>
<li>
<p>automatic detection of spectral lines</p>
</li>
<li>
<p>Doppler eclipse image, inverted image and orientation grid</p>
</li>
<li>
<p>automatic correction of the P angle</p>
</li>
<li>
<p>single click processing of Helium line images</p>
</li>
<li>
<p>embedded stacking</p>
</li>
<li>
<p>automatic trimming and compression of SER files</p>
</li>
<li>
<p>identifying what frame of a SER file matches a particular point of the solar disk</p>
</li>
<li>
<p>an optimal exposure calculator</p>
</li>
<li>
<p>automatic detection of redshifts</p>
</li>
<li>
<p>automatic detection and annotation of sunspots</p>
</li>
<li>
<p>automatic creation of animations of a single image taken at different wavelengths</p>
</li>
<li>
<p>a full-fledged scripting engine which allows creation of custom images, animations, etc.</p>
</li>
<li>
<p>support for home-made SHGs</p>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>and more!</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>All integrated into a single, easy to use, cross-platform application: no need for Gimp, ImPPG or Autostakkert! (but you can use them if you want to!).</p>
</div>
<div class="paragraph">
<p>For this new release, I wondered if I should <a href="https://github.com/melix/astro4j/issues/502">change the name</a> so that it better matches the new scope of the project, but eventually decided to keep it as it is, because it is already well known in the community and that changing it also implies significant amount of time spent on this that wouldn&#8217;t go into the new features.</p>
</div>
<div class="sect2">
<h3 id="_here_comes_jsolex_3_0_0">Here comes JSol&#8217;Ex 3.0.0!</h3>
<div class="paragraph">
<p>In addition to performance improvements and bugfixes, this release deserves its major version number because of many significant improvements.</p>
</div>
<div class="videoWrapper">
<iframe src="https://www.youtube.com/embed/9mU_8j3lNcg" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_improved_image_quality">Improved image quality</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_better_line_detection">Better line detection</h3>
<div class="paragraph">
<p>The first thing you may notice is the improved image quality.
The algorithm to detect the spectral lines have been improved, which will result in a better polynomial detection and therefore a more accurate image reconstruction.
This will be noticeable in images which have low signal, which is often the case in calcium.</p>
</div>
</div>
<div class="sect2">
<h3 id="_background_removal">Background removal</h3>
<div class="paragraph">
<p>Next, a new background removal algorithm has been added.
It is fairly common to have either internal reflections or light leaks in the optical path of a spectroheliograph.
This results in images which are hard to process or not usable at all.
This version of JSol&#8217;Ex is capable of removing difficult gradients.
To illustrate this, here&#8217;s an image that a user with a Sunscan sent me:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex3/sunscan_ca_bg.jpg" alt="sunscan ca bg">
</div>
</div>
<div class="paragraph">
<p>The image on the left is <em>unprocessed</em> and shows important internal reflections.
These are completely removed in the image on the right, processed automatically with JSol&#8217;Ex.</p>
</div>
<div class="paragraph">
<p>This background removal will only be applied to the "Autostretch" image, which is the default "enhanced" image that JSol&#8217;Ex is using, but it is also available as a standalone function in ImageMath scripts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_physical_flat_correction">Physical flat correction</h3>
<div class="paragraph">
<p>Another common issue with SHGs is the presence of vignetting, visible on the poles of the solar disk.
The vignetting issue stems from the following factors, in the order of their impact:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the physical size of the SHG’s optical components — including the lens diameter, grating size, and slit length</p>
</li>
<li>
<p>the telescope’s focal ratio and focal length</p>
</li>
<li>
<p>the telescope’s own intrinsic vignetting (though this is rarely a significant factor)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For prebuilt SHGs like the MLAstro SHG 700, the size of the lens and grating is typically constrained by the housing design and cost limitations.
As a result, vignetting often becomes an issue when using longer focal length telescopes,—especially when paired with a longer slit.</p>
</div>
<div class="paragraph">
<p>To fix this, JSol&#8217;Ex had until now the option to use artificial flat correction: the idea was basicaly to model the illumination of the solar disk via a polynomial and to apply a correction to the image.
This works relatively well, but it can sometimes introduce some noise, or even bias the reconstruction on low-contrast images.
On even longer slits, this artificial correction is not sufficient to remove the vignetting, so JSol&#8217;Ex 3 introduces the ability to use a <strong>physical flat correction</strong>.</p>
</div>
<div class="paragraph">
<p>The idea with a physical flat correction is to take a series of 10 to 20 images of the sun, using a light diffuser device at the entrance of the telescope, such as tracing paper, in order to diffuse light.
The flat should be captured with the same cropping window as the one used for the solar images, but exposure will be longer, and possibly higher gain as well.
The result is a SER file that JSol&#8217;Ex can use to create a model of the illumination of the disk, which can be used to correct the images.</p>
</div>
<div class="paragraph">
<p>As an illustration, here&#8217;s a series of 3 images of the Sun, taken with a prototype of a 10mm slit:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex3/flat_correction.jpg" alt="flat correction">
</div>
</div>
<div class="paragraph">
<p>The image on the left is done without any correction and shows very strong vignetting.
The image in the middle is done with the artificial flat correction, improves the situation, but still shows some vignetting.
The image on the right is done with the physical flat correction, which is much better and shows no vignetting at all.</p>
</div>
<div class="paragraph">
<p>Flats can be reused between sessions, as long as you use the same cropping window and the same wavelength.</p>
</div>
<div class="paragraph">
<p>The physical flat correction can also be used on images taken with a Sol&#8217;Ex, in particular for some wavelengths like H-beta which show stronger illumination of the middle of the solar disk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Flat correction is not designed to fix transversalliums: it has to apply low pass filtering to the image to compute a good flat, which will remove the transverse lines.
To correct transversalliums, use the banding correction parameters.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_new_stretching_options">New Stretching Options</h3>
<div class="paragraph">
<p>By default, JSol&#8217;Ex used to display images applying a linear stretch.
Starting with this version, it is possible to select which stretching algorithm to use: linear, curve or no stretching at all.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex3/stretching.jpg" alt="stretching">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_distance_measurement_tool">Distance measurement tool</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This version introduces a new tool to measure distances!
This feature was suggested by Minh Nguyen from <a href="https://mlastro.com/">MLAstro</a>, after seeing one of my images in Calcium H, which showed a very long filament:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex3/open-measure.jpg" alt="open measure">
</div>
</div>
<div class="paragraph">
<p>This tool lets you click on waypoints to follow a path and make measurements on the disk, in which case the distances take the curvature into account, or outside the disk, for example to measure the size of prominences, in which case the distances are linear.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex3/measurements.jpg" alt="measurements">
</div>
</div>
<div class="paragraph">
<p>The measured distances are always an approximation, because it&#8217;s basically impossible to know at what height a particular feature is located, but it gives a good rough estimate.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_new_scripting_features">New scripting features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Last but not least, this version significantly improves the scripting engine, aka ImageMath.
While this feature is for more advanced users, it is an extremely powerful tool which lets you generate custom images, automatically stack images, create animations, etc.</p>
</div>
<div class="paragraph">
<p>In this version, the scripting engine has been rewritten to make it more enjoyable to use.
It adds:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the ability to write expressions on several lines</p>
</li>
<li>
<p>the possibility to use named parameters</p>
</li>
<li>
<p>the ability to define your own functions</p>
</li>
<li>
<p>call an external web service to generate script snippets</p>
</li>
<li>
<p>the ability to import scripts into other scripts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As well as new functions.
Let&#8217;s take a deeper look.</p>
</div>
<div class="sect2">
<h3 id="_declaring_your_own_functions">Declaring your own functions</h3>
<div class="paragraph">
<p>You may have faced the situation where you wanted to apply the same operation to several images.
For example, let&#8217;s imagine that you want to decorate an image with the observation details and the solar parameters.</p>
</div>
<div class="paragraph">
<p>Before, you would write something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>image1=draw_solar_params(draw_obs_details(some_image)
image2=draw_solar_params(draw_obs_details(some_other_image)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, you can define a function, let&#8217;s call it <code>decorate</code>, which will take an image and return the decorated image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>[fun:decorate img]
    result = draw_solar_params(draw_obs_details(img))

[outputs]
image1=decorate(some_image)
image2=decorate(some_other_image)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can take a look at the <a href="https://melix.github.io/astro4j/3.0.0/en/jsolex.html#custom-functions">documentation</a> for more details.</p>
</div>
</div>
<div class="sect2">
<h3 id="_importing_scripts">Importing scripts</h3>
<div class="paragraph">
<p>In the previous section we have seen how to define functions.
It can be useful to externalize these functions in a separate file, so that they can be reused in other scripts.
This is now possible with the <code>import</code> statement.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s say you have a file called <code>utils.math</code> which contains the <code>decorate</code> function.</p>
</div>
<div class="paragraph">
<p>We can now import this file in our script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>[include "utils"]

[outputs]
image1=decorate(some_image)
image2=decorate(some_other_image)</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will import the <code>utils.math</code> file and make the <code>decorate</code> function available in the current script.</p>
</div>
</div>
<div class="sect2">
<h3 id="_named_parameters">Named parameters</h3>
<div class="paragraph">
<p>Named parameters are a new feature that allows you to pass parameters to functions by name, instead of by position.
This is particularly useful for functions that take a lot of parameters, or when you want to make your code more readable.</p>
</div>
<div class="paragraph">
<p>For example, in the example above, we could have written:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>[include "utils"]

[outputs]
image1=decorate(img: some_image)
image2=decorate(img: some_other_image)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The names of the parameters are <a href="https://melix.github.io/astro4j/3.0.0/en/jsolex.html#_functions_available_in_imagemath">documented here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_new_functions">New functions</h3>
<div class="paragraph">
<p>This version introduces a few new functions, which are available in the scripting engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bg_model</code>: background sky modeling</p>
</li>
<li>
<p><code>a2px</code> and <code>px2a</code>: conversion between pixels and Angstroms</p>
</li>
<li>
<p><code>wavelen</code>: returns the wavelength of an image, based on its pixel shift, dispersion, and reference wavelength</p>
</li>
<li>
<p><code>remote_scriptgen</code>: allows calling an external web service to generate a script or images</p>
</li>
<li>
<p><code>transition</code>: creates a transition between two or more images</p>
</li>
<li>
<p><code>curve_transform</code>: applies a transformation to the image based on a curve</p>
</li>
<li>
<p><code>equalize</code>: equalizes the histograms of a series of images so that they look similar in brightness and contrast</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And others have been improved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>find_shift</code>: added an optional parameter for the reference wavelength</p>
</li>
<li>
<p><code>continuum</code>: improved function reliability, enhancing Helium line extraction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>transition</code> function, for example, is capable of generating intermediate frames in an animation, based on the actual difference of time between two images, offering the ability to have smooth, uniform transitions between images.</p>
</div>
<div class="paragraph">
<p>This is how my <a href="https://melix.github.io/blog/2025/03-30-partial-eclipse.html">partial solar eclipse</a> animation was created!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I would like to thank all the users who have contributed to this release by reporting bugs, suggesting features, and testing the software.
In particular, I would like to recognize the following people:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minh Nguyen, <a href="https://mlastro.com/">MLAstro&#8217;s founder</a> for his help with the background removal and flat correction algorithms, as well as the new distance measurement tool and review of this blog post</p>
</li>
<li>
<p>Yves Robin for his testing and improvement ideas</p>
</li>
<li>
<p>my wife for her patience, while I was going to bed late every night to work on this release</p>
</li>
</ul>
</div>
</div>
</div></p>
	
	<hr />
	
	<p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
   <script>hljs.highlightAll();</script>
  </body>
</html>
