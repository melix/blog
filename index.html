<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cédric Champeau's blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">    

    <!-- Le styles -->
    <link href="/blog/css/bootstrap.min.css" rel="stylesheet">
    <link href="/blog/css/asciidoctor.css" rel="stylesheet">
    <link href="/blog/css/base.css" rel="stylesheet">
   <script src="https://kit.fontawesome.com/fefa3ec5bf.js" crossorigin="anonymous"></script>
      
    <script src="/blog/js/highlight.min.js"></script>
    <link href="/blog/css/equilibrium-gray-light.min.css" rel="stylesheet">

    <!-- MathJax for LaTeX math rendering -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['\\(', '\\)']],
          displayMath: [['\\[', '\\]']],
          processEscapes: true
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="favicon.ico">
    <script defer data-domain="melix.github.io" src="https://analytics.champeau.me/js/script.js"></script>
  </head>
  <body>
    <div id="wrap">
   
	
	<!-- Fixed navbar -->
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">
	    <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/blog">Cédric Champeau's blog</a>
	    </div>
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">                
                <li><a href="/blog/about.html">About</a></li>
		          <li><a href="/blog/projects.html">Projects</a></li>
				    <li><a href="/blog/jsolex.html">JSol'Ex</a></li>
		<li><a href="/blog/astrophotography.html">Astrophotography</a></li>
		<li class="dropdown">
          		<a data-toggle="dropdown" href="#">Topics<b class="caret"></b></a>
		          <ul class="dropdown-menu" role="menu">
		          <li><a href="/blog/tags/jsolex.html">JSol'Ex</a></li>
				    <li><a href="/blog/tags/gradle.html">Gradle</a></li>
                <li><a href="/blog/tags/groovy.html">Groovy</a></li>
                <li><a href="/blog/tags/micronaut.html">Micronaut</a></li>
                <li><a href="/blog/tags/index.html">See all tags</a></li>
		          </ul>
	       </li>
                <li><a href="/blog/feed.xml">Feed</a></li>                
              </ul>
	      <ul class="nav navbar-nav navbar-right">
	      	<li><a href="https://github.com/melix"><i class="fa fa-github"></i></a></li>
	        <li><a href="https://bsky.app/profile/melix.champeau.me"><i class="fa fa-twitter"></i></a></li>
	        <li><a rel="me" href="https://mastodon.xyz/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	        <li><a rel="me" href="https://astrodon.social/@melix"><i class="fa-brands fa-mastodon"></i></a></li>
	      </ul>
            </div>
          </div>
      </div>
      <div class="container">

	<div class="page-header">
		<h1>Blog</h1>
	</div>
  			<a href="/blog/2026/02/17-announcing-tamboui.html"><h1>Announcing TamboUI</h1></a>
  			<p>17 February 2026</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/tamboui.html">tamboui</a> 
	
		<a href="/blog/tags/tui.html">tui</a> 
	
		<a href="/blog/tags/java.html">java</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>This blog post is co-authored by <a href="https://melix.github.io/blog/2026/02/17-announcing-tamboui.html">Cédric Champeau</a> (Micronaut) and <a href="https://xam.dk/blog/announcing-tamboui">Max Rydahl Andersen</a> (Quarkus), and cross-posted on our respective personal blogs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Today we are excited to announce <a href="https://tamboui.dev/">TamboUI</a>, an open-source Terminal UI framework for the Java ecosystem!</p>
</div>
<div class="paragraph">
<p>The terminal is having a renaissance.</p>
</div>
<div class="paragraph">
<p>AI coding tools live there. Developer workflows are increasingly CLI-first again. Rust has <a href="https://ratatui.rs/">Ratatui</a>. Python has Rich and Textual, Go has Charm, Typescript has OpenTUI. But Java, despite its performance, maturity, and tooling, didn’t have a modern, composable, developer-friendly TUI framework.</p>
</div>
<div class="paragraph">
<p>We thought that should change.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="640" height="480" src="https://www.youtube.com/embed/ERAp2vRHX3M?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_it_started">How it started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TamboUI (pronounced like the french word “tambouille”, slang for "cooking up something" or "makeshift creation") was born a bit by accident: a couple months ago, Cédric was <a href="https://bsky.app/profile/melix.champeau.me/post/3m7ulazaogt25">asking about which TUI libraries that tools like Claude Code were using</a>. Max Andersen answered that most likely this was <a href="https://ratatui.rs/">Ratatui</a>, a framework written in Rust. Both thought that it was a bit sad that there was no such library for Java.</p>
</div>
<div class="paragraph">
<p>A few weeks later, <a href="https://bsky.app/profile/melix.champeau.me/post/3mae3pyw4ek25">Cédric did an experiment by asking AI (Claude Code) to port Ratatui to Java</a>. The result was fairly impressive, and the beginning of a collaboration that led to the creation of TamboUI. In fact, Max <a href="https://xam.dk/blog/lets-make-2026-the-year-of-java-in-the-terminal/">gave you a hint last year</a> that this was going to happen.</p>
</div>
<div class="paragraph">
<p>That said, TamboUI is not a Ratatui port nor is it a Textual port. We’ve put a lot of effort in going beyond the initial AI generated port. The library was designed with Java developers in mind, inspired by the good things found in other ecosystems’ approach to TUI frameworks. It offers a multi-layer API: from low-level widget primitives (like Ratatui), to a managed TUI layer with event handling, up to a declarative Toolkit DSL that handles the event loop and rendering thread for you—things that Ratatui doesn’t really cover. This brings the power of Ratatui, Textual or Rich to the Java ecosystem, with the Java touch!</p>
</div>
<div class="paragraph">
<p>Not only that, TamboUI is also <a href="https://www.graalvm.org/latest/reference-manual/native-image/">GraalVM native</a> compatible! This means that you can compile your Java TUI applications as native binaries, making Java a first class citizen in terminal applications development, with low memory footprints and fast startup!</p>
</div>
<div class="paragraph">
<p>If you want to give it a try, the easiest is to run our demos using <a href="https://www.jbang.dev/">JBang</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell">jbang demos@tamboui</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_try_it_out">Try it out</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At this stage, the APIs are still unstable and subject to change. TamboUI is developed with the mindset of being framework-agnostic and having as few external dependencies as possible. You can choose between several backends like <a href="https://jline.org/">JLine</a>, <a href="https://aeshell.github.io/">Aesh</a> or the built-in Panama backend. By choosing the latter, you’ll get the best performance while not depending on any external library.</p>
</div>
<div class="paragraph">
<p>Whether you want to build:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a standalone CLI tool</p>
</li>
<li>
<p>an internal developer tool</p>
</li>
<li>
<p>a DevOps utility</p>
</li>
<li>
<p>add a TUI frontend to existing Java tool</p>
</li>
<li>
<p>an AI agent</p>
</li>
<li>
<p>or something entirely new</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Give TamboUI a try and let us know what worked and what could be improved!</p>
</div>
<div class="paragraph">
<p>Check out the documentation at <a href="https://tamboui.dev/docs/main/" class="bare">https://tamboui.dev/docs/main/</a>, join us on <a href="https://tamboui.zulipchat.com">Zulip</a>, or browse the source on <a href="https://github.com/tamboui/tamboui">GitHub</a>. We&#8217;d love your feedback and contributions!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgments">Acknowledgments</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We would like to thank the following people for their ideas, suggestions and contributions to the creation of first public release of TamboUI (in alphabetical order):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Andres Almiray</p>
</li>
<li>
<p>Charles Moulliard</p>
</li>
<li>
<p>Claus Ibsen</p>
</li>
<li>
<p>Graeme Rocher</p>
</li>
<li>
<p>Guillaume LaForge</p>
</li>
<li>
<p>James Cobb</p>
</li>
<li>
<p>Ståle Pedersen</p>
</li>
<li>
<p>Tako Schotanus</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and of course to the Ratatui and Textual creators for their inspiration and work.</p>
</div>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Max Rydahl Andersen &amp; Cédric Champeau</p>
</div>
</div>
</div>
</div>
</div></p>
  			<a href="/blog/2026/02/06-mesure-rotation-differentielle.html"><h1>Mesurer la rotation différentielle solaire avec JSol&#8217;Ex</h1></a>
  			<p>05 February 2026</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solaire.html">solaire</a> 
	
		<a href="/blog/tags/astronomie.html">astronomie</a> 
	
		<a href="/blog/tags/doppler.html">doppler</a> 
	
		<a href="/blog/tags/rotation.html">rotation</a> 
	</p>
			
  			<p><div class="sect1">
<h2 id="_une_boule_de_plasma_en_rotation">Une boule de plasma en rotation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;un des aspects fascinants du Soleil est qu&#8217;il ne tourne pas comme un corps solide.
Contrairement à la Terre, qui effectue une rotation en 24 heures quelle que soit la latitude, la vitesse de rotation du Soleil varie avec la latitude : l&#8217;équateur tourne plus vite que les pôles.
Ce phénomène, appelé <strong>rotation différentielle</strong>, est étudié depuis le 19ème siècle et reste un sujet de recherche important en physique solaire.</p>
</div>
<div class="paragraph">
<p>Les régions équatoriales du Soleil effectuent une rotation en environ 25 jours, tandis que près des pôles, cela prend environ 35 jours.
Cette rotation différentielle joue un rôle clé dans le mécanisme de dynamo solaire qui génère le champ magnétique du Soleil et pilote le cycle solaire de 11 ans.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/differential-rotation-concept-fr.svg" alt="Concept de rotation différentielle">
</div>
</div>
<div class="paragraph">
<p>Dans cet article, je vais expliquer comment j&#8217;ai ajouté une fonctionnalité dans JSol&#8217;Ex 4.5.0 qui permet aux astronomes amateurs de mesurer cette rotation différentielle directement à partir d&#8217;un scan obtenu avec un spectrohéliographe.
Une erreur fréquente est de penser que cette mesure n&#8217;est pas possible parce que la dispersion spectrale d&#8217;un spectrographe comme le Sol&#8217;Ex est typiquement d&#8217;environ 0.1 à 0.2 Å, c&#8217;est-à-dire plus grand que l&#8217;échelle de ce que nous essayons de mesurer (2 km/s, soit environ 0.04 Å).
En pratique, nous devrons obtenir une précision sub-pixellaire et cet article explique comment y arriver.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_leffet_doppler">L&#8217;effet Doppler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Le principe derrière la mesure est simple : l'<strong>effet Doppler</strong>.
Quand une source lumineuse se déplace vers nous, la longueur d&#8217;onde est décalée vers le bleu du spectre (blueshift).
Quand elle s&#8217;éloigne, la longueur d&#8217;onde se décale vers le rouge (redshift).</p>
</div>
<div class="paragraph">
<p>Puisque le Soleil tourne, un limbe se déplace toujours vers nous (le limbe Est) tandis que l&#8217;autre s&#8217;éloigne (le limbe Ouest).
En mesurant le décalage de longueur d&#8217;onde d&#8217;une raie spectrale aux deux limbes, nous pouvons calculer la vitesse de rotation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/doppler-effect-sun-fr.svg" alt="Effet Doppler pour mesurer la rotation solaire">
</div>
</div>
<div class="paragraph">
<p>On pourrait se demander ce qu&#8217;il en est du mouvement propre de la Terre : nous orbitons autour du Soleil à environ 30 km/s, ce qui est bien plus grand que la vitesse de rotation solaire d&#8217;environ 2 km/s que nous essayons de mesurer.
Ce mouvement orbital produit effectivement un décalage Doppler de tout le spectre solaire.
Cependant, cet effet s&#8217;applique de manière égale à tous les points que nous pouvons mesurer : en d&#8217;autres termes, puisque tout le spectre est décalé de manière uniforme, tout s&#8217;annule.
Il en va de même pour toute vitesse radiale du Soleil par rapport à la Terre (qui varie légèrement tout au long de l&#8217;année car l&#8217;orbite de la Terre est elliptique).</p>
</div>
<div class="paragraph">
<p>La formule fondamentale reliant le décalage Doppler à la vitesse est :</p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\Delta\lambda}{\lambda_0} = \frac{v}{c}\]
</div>
</div>
<div class="paragraph">
<p>Où :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\Delta\lambda\) est le décalage en longueur d&#8217;onde (ce qu&#8217;on cherche à mesurer)</p>
</li>
<li>
<p>\(\lambda_0\) est la longueur d&#8217;onde au repos de la raie spectrale (typiquement la longueur d&#8217;onde H-alpha)</p>
</li>
<li>
<p>\(v\) est la vitesse le long de la ligne de visée</p>
</li>
<li>
<p>\(c\) est la vitesse de la lumière (299 792 km/s)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_la_méthodologie_de_mesure">La méthodologie de mesure</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_travaux_antérieurs">Travaux antérieurs</h3>
<div class="paragraph">
<p>Je ne suis pas la première personne à essayer de faire cette mesure en spectrohéliographie amateur.
En 2017, Peter Zetner <a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">a expliqué sur CloudyNights</a> comment mesurer la vitesse différentielle en utilisant un spectrohéliographe.
Il a expliqué cette méthodologie en profondeur dans le livre <a href="https://astronomiesolaire.com/">Astronomie solaire - Observer, photographier et étudier le Soleil</a>.
Sa méthodologie repose sur des mesures utilisant la raie Na D2. mais peut aussi être appliquée sur d&#8217;autres raies brillantes incluant la raie Fe I couramment utilisée à 5250.2 Å, et implique de comparer les intensités des pixels, en les moyennant à différentes latitudes.
Les résultats sont meilleurs en effectuant plusieurs scans et en moyennant les données.
Bien que cela fonctionne, je voulais essayer une méthodologie différente :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Utiliser un seul scan : les images Doppler que JSol&#8217;Ex ou INTI peuvent produire sont en général très cohérentes et montrent que toutes les données dont nous avons besoin sont déjà présentes</p>
</li>
<li>
<p>Éviter les intensités de pixels : celles-ci sont très sensibles à l&#8217;assombrissement centre-bord, aux conditions d&#8217;observation (par exemple les nuages, même fins) ou au vignetage (assombrissement des images le long de la fente)</p>
</li>
<li>
<p>Rendre possible l&#8217;utilisation de scans H-alpha, non pas parce qu&#8217;ils donneraient une valeur précise de la vitesse du plasma de la photosphère, mais parce que c&#8217;est la raie la plus largement imagée dans les observations solaires amateurs</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Les résultats, bien sûr, dépendront de la raie observée.
La méthodologie que je décris ci-dessous est capable de retourner des résultats raisonnables sur plusieurs raies (H-alpha, Na D2. Fe I) mais échouera complètement sur certaines autres (par exemple Ca II K, typiquement parce que la raie est trop large).</p>
</div>
<div class="paragraph">
<p>Plongeons-nous dans la méthodologie.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
L&#8217;implémentation décrite ici a été développée de manière itérative basée sur des observations réelles. Je ne suis pas physicien solaire, juste un ingénieur essayant d&#8217;extraire des données significatives des captures de spectrohéliographe. L&#8217;algorithme fonctionne raisonnablement bien en pratique mais devrait être validé par rapport à des mesures professionnelles pour toute application scientifique. C&#8217;est pourquoi cette fonctionnalité est annoncée comme expérimentale.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_comparaison_des_limbes_est_ouest">Comparaison des limbes Est-Ouest</h3>
<div class="paragraph">
<p>La clé pour comprendre la méthodologie est qu&#8217;elle repose sur l&#8217;analyse et l&#8217;ajustement de profils de raies spectrales.
Elle nécessite d&#8217;extraire les profils de raies spectrales à différents endroits du disque solaire, de préférence près des limbes où les vitesses sont les plus élevées (plus on s&#8217;approche du méridien solaire, plus les vitesses sont faibles et donc difficiles à détecter).</p>
</div>
<div class="paragraph">
<p>La mesure de rotation différentielle extrait les vitesses de rotation solaire en comparant les décalages Doppler entre les points des limbes Est et Ouest à la même latitude héliographique.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/spectral-profiles-fr.svg" alt="Profils spectraux décalés">
</div>
</div>
<div class="paragraph">
<p>Pour chaque latitude (par exemple, 20° Nord), l&#8217;algorithme :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sélectionne un point sur le limbe Est</p>
</li>
<li>
<p>Sélectionne le point correspondant sur le limbe Ouest à la même latitude</p>
</li>
<li>
<p>Mesure la position de la raie spectrale à chaque point</p>
</li>
<li>
<p>Calcule la différence : Ouest - Est</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cette approche différentielle a un avantage crucial : elle annule les erreurs systématiques.
Tout décalage instrumental, erreur de calibration en longueur d&#8217;onde, ou décalage de référence affecte les deux mesures de manière égale et disparaît quand nous prenons la différence.</p>
</div>
<div class="paragraph">
<p>Cependant, une seule mesure Est-Ouest à chaque latitude n&#8217;est pas assez fiable.
Les conditions de seeing, l&#8217;activité solaire locale, ou les erreurs d&#8217;ajustement peuvent corrompre les mesures individuelles.
Pour améliorer la précision, JSol&#8217;Ex échantillonne <strong>plusieurs longitudes</strong> à travers la région du limbe (typiquement 14 points de 62° à 88° de longitude) et agrège ces mesures.
Cette redondance permet de rejeter les valeurs aberrantes et fournit une estimation d&#8217;erreur basée sur la cohérence des mesures.</p>
</div>
<div class="paragraph">
<p>La vitesse mesurée est alors :</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{measured} = \frac{\Delta\lambda}{\lambda_0} \times \frac{c}{2}\]
</div>
</div>
<div class="paragraph">
<p>Le facteur 2 apparaît parce que nous mesurons la différence entre les limbes s&#8217;approchant et s&#8217;éloignant.</p>
</div>
</div>
<div class="sect2">
<h3 id="_de_la_vitesse_mesurée_à_la_vitesse_équatoriale">De la vitesse mesurée à la vitesse équatoriale</h3>
<div class="paragraph">
<p>La vitesse que nous mesurons dépend de la géométrie : quelle fraction de la vitesse de rotation est projetée le long de notre ligne de visée.
À l&#8217;équateur et au limbe, nous voyons la vitesse de rotation complète.
À des latitudes plus élevées ou plus près du centre du disque, nous n&#8217;en voyons qu&#8217;une fraction.</p>
</div>
<div class="paragraph">
<p>Le facteur de correction géométrique est :</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{equatorial} = \frac{v_{measured}}{\cos(\phi) \times \sin(\theta)}\]
</div>
</div>
<div class="paragraph">
<p>Où :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) est la latitude héliographique</p>
</li>
<li>
<p>\(\theta\) est la longitude héliographique (0° au centre du disque, ±90° aux limbes)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trouver_le_centre_de_la_raie_spectrale">Trouver le centre de la raie spectrale</h3>
<div class="paragraph">
<p>La partie la plus difficile de la mesure est de déterminer précisément le centre de la raie d&#8217;absorption.
Un décalage de seulement 0.01 Å correspond à une vitesse d&#8217;environ 0.5 km/s, ce qui est significatif par rapport à la vitesse équatoriale typique d&#8217;environ 2 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex utilise l'<strong>ajustement de profil de Voigt</strong> pour mesurer le centre de la raie.
Le profil de Voigt est la convolution d&#8217;un profil gaussien et d&#8217;un profil lorentzien, qui modélise précisément la forme des raies d&#8217;absorption solaires.
La composante gaussienne représente l&#8217;élargissement Doppler thermique, tandis que la composante lorentzienne représente l&#8217;élargissement naturel et de pression.</p>
</div>
<div class="paragraph">
<p>Pour chaque point de mesure, l&#8217;algorithme :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extrait un profil spectral du fichier SER à la position correspondante</p>
</li>
<li>
<p>Ajuste un profil de Voigt à la raie d&#8217;absorption</p>
</li>
<li>
<p>Enregistre la position du centre de raie ajustée</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le paramètre configurable "demi-largeur d&#8217;ajustement de Voigt" (par défaut : 2 Å) contrôle quelle proportion des ailes de la raie sont incluses dans l&#8217;ajustement.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_systèmes_de_coordonnées">Systèmes de coordonnées</h2>
<div class="sectionbody">
<div class="paragraph">
<p>L&#8217;un des aspects les plus délicats de cette implémentation est de transformer correctement les coordonnées que nous manipulons.
L&#8217;algorithme commence avec les coordonnées héliographiques (où nous voulons mesurer) et les transforme en coordonnées des trames SER originales (où les données spectrales se trouvent).</p>
</div>
<div class="paragraph">
<p><strong>1. Coordonnées héliographiques (point de départ)</strong></p>
</div>
<div class="paragraph">
<p>Nous commençons par spécifier des points en coordonnées héliographiques :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Latitude</strong> : -90° (pôle sud) à +90° (pôle nord)</p>
</li>
<li>
<p><strong>Longitude</strong> : 0° au centre du disque, ±90° aux limbes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cela nécessite deux paramètres solaires calculés à partir de la date d&#8217;observation :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>B0</strong> : La latitude héliographique du centre du disque (varie tout au long de l&#8217;année)</p>
</li>
<li>
<p><strong>P</strong> : L&#8217;angle de position de l&#8217;axe de rotation (l&#8217;inclinaison du Soleil vu depuis la Terre)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>2. Coordonnées image</strong></p>
</div>
<div class="paragraph">
<p>Les coordonnées héliographiques sont converties en positions de pixels dans l&#8217;image reconstruite.
Cela implique d&#8217;inverser les corrections appliquées pendant la reconstruction :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Correction de l&#8217;angle P</p>
</li>
<li>
<p>Retournement/rotation</p>
</li>
<li>
<p>Distorsion géométrique</p>
</li>
<li>
<p>Angle d&#8217;inclinaison</p>
</li>
<li>
<p>Recadrage</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>3. Coordonnées du fichier SER (destination)</strong></p>
</div>
<div class="paragraph">
<p>Finalement, les coordonnées image sont mappées vers le fichier vidéo SER brut :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Numéro de trame</strong> : Position dans la séquence de scan (dérivée de la coordonnée x)</p>
</li>
<li>
<p><strong>Colonne</strong> : Position le long de la fente (dérivée de la coordonnée y)</p>
</li>
<li>
<p><strong>Ligne</strong> : Direction spectrale (longueur d&#8217;onde)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce mapping inverse nous permet d&#8217;extraire le profil spectral exact à n&#8217;importe quelle position héliographique.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_pipeline_de_traitement_des_données">Le pipeline de traitement des données</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Les mesures brutes sont bruitées.
Pour produire une courbe de rotation propre, JSol&#8217;Ex utilise un pipeline de traitement en deux étapes :</p>
</div>
<div class="sect2">
<h3 id="_étape_1_agrégation_en_longitude">Étape 1 : Agrégation en longitude</h3>
<div class="paragraph">
<p>Comme décrit précédemment, à chaque latitude, plusieurs longitudes sont échantillonnées (typiquement 14 points à travers la région du limbe).
Ces mesures sont combinées en utilisant l&#8217;une des trois méthodes (la médiane par défaut mais vous pouvez choisir) :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Médiane</strong> : Robuste aux valeurs aberrantes, utilise la valeur centrale</p>
</li>
<li>
<p><strong>Moyenne</strong> : Simple moyenne arithmétique</p>
</li>
<li>
<p><strong>Moyenne pondérée</strong> : Les points plus proches du limbe (où le signal Doppler est plus fort) ont un poids plus élevé</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;estimation d&#8217;erreur de cette étape représente la cohérence des mesures à travers les longitudes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_étape_2_lissage_en_latitude">Étape 2 : Lissage en latitude</h3>
<div class="paragraph">
<p>Même après l&#8217;agrégation en longitude, les mesures latitude par latitude restent bruitées.
Les bins de latitude individuels peuvent encore être affectés par des caractéristiques localisées (taches solaires, facules) ou simplement par la dispersion des mesures.</p>
</div>
<div class="paragraph">
<p>Puisque nous nous attendons à ce que la rotation solaire varie <strong>de manière lisse</strong> avec la latitude (suivant les termes \(\sin^2\phi\) et \(\sin^4\phi\) de la loi de rotation différentielle), nous pouvons exploiter cette contrainte physique pour réduire davantage le bruit.
JSol&#8217;Ex applique un filtre de lissage qui combine les points de latitude voisins dans une fenêtre configurable (par défaut : 5°).</p>
</div>
<div class="paragraph">
<p>De manière importante, les erreurs de l&#8217;étape 1 sont <strong>propagées</strong> plutôt que recalculées à partir de la dispersion dans la fenêtre de lissage.
Cela garantit que les barres d&#8217;erreur représentent l&#8217;incertitude de mesure, pas les variations physiques de latitude.</p>
</div>
<div class="paragraph">
<p>Pour l&#8217;agrégation médiane :</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{median(\sigma_i)}{\sqrt{n}}\]
</div>
</div>
<div class="paragraph">
<p>Pour la moyenne :</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{\sqrt{\sum \sigma_i^2}}{n}\]
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_résultat_et_la_comparaison_avec_la_théorie">Le résultat et la comparaison avec la théorie</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La forme standard de la loi de rotation différentielle (aussi connue comme la formule de Faye, même si la formule originale n&#8217;incluait pas le 3ème terme) est :</p>
</div>
<div class="stemblock">
<div class="content">
\[\omega(\phi) = A + B \sin^2(\phi) + C \sin^4(\phi)\]
</div>
</div>
<div class="paragraph">
<p>Où :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) est la latitude héliographique</p>
</li>
<li>
<p>\(A\) est le taux de rotation équatorial</p>
</li>
<li>
<p>\(B\) et \(C\) contrôlent la diminution de la vitesse avec la latitude</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex compare les résultats mesurés avec les coefficients largement utilisés de <strong>Snodgrass &amp; Ulrich (1990)</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(A = 14.713\) deg/jour (taux de rotation équatorial)</p>
</li>
<li>
<p>\(B = -2.396\) deg/jour</p>
</li>
<li>
<p>\(C = -1.787\) deg/jour</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cela donne une période de rotation équatoriale d&#8217;environ 24.5 jours et une période polaire d&#8217;environ 34 jours.
Convertie en vitesse linéaire à la surface solaire (rayon ≈ 696 000 km), la vitesse de rotation équatoriale est d&#8217;environ 2.0 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex ajuste également ses propres coefficients A, B, C à partir de vos mesures, permettant une comparaison directe avec les valeurs de référence.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_résultats">Résultats</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ci-dessous des exemples de profils de rotation différentielle mesurés avec JSol&#8217;Ex en utilisant deux raies spectrales différentes.
Ces mesures ont été prises à des dates différentes avec des conditions de seeing différentes.</p>
</div>
<div class="sect2">
<h3 id="_fe_i_5883_å">Fe I 5883 Å</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-FeI.png" alt="velocity FeI">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_h_alpha">H-alpha</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-Ha.png" alt="velocity Ha">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_observations">Observations</h3>
<div class="paragraph">
<p>Les profils mesurés montrent la forme générale attendue : des vitesses plus élevées à l&#8217;équateur, diminuant vers les pôles.
Les courbes ajustées suivent raisonnablement bien le profil théorique de Snodgrass.</p>
</div>
<div class="paragraph">
<p>Cependant, j&#8217;observe des différences entre les raies spectrales que je ne peux pas entièrement expliquer.
Les mesures Fe I montrent des vitesses absolues différentes de H-alpha, et les coefficients ajustés diffèrent entre les scans.</p>
</div>
<div class="paragraph">
<p>Plusieurs facteurs pourraient contribuer à ces différences :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hauteur de formation</strong> : Différentes raies spectrales se forment à différentes hauteurs dans l&#8217;atmosphère solaire, et les taux de rotation peuvent varier avec l&#8217;altitude (comme suggéré par des recherches récentes de la <a href="https://www.nature.com/articles/s41550-024-02299-4">mission CHASE</a>)</p>
</li>
<li>
<p><strong>Conditions de seeing</strong> : Les scans ont été pris à des dates différentes avec des conditions atmosphériques différentes</p>
</li>
<li>
<p><strong>Différences de profil de raie</strong> : H-alpha et Fe I ont des largeurs et profondeurs de raie différentes, ce qui peut affecter la précision de l&#8217;ajustement de Voigt</p>
</li>
<li>
<p><strong>Effets systématiques</strong> : Il peut y avoir des facteurs instrumentaux ou algorithmiques que je n&#8217;ai pas identifiés</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Je présente ces résultats tels qu&#8217;ils sont, sans essayer de tirer des conclusions sur quelle mesure est "correcte" ou ce qui cause les différences observées.
Plus de mesures sur différentes dates, raies spectrales et instruments seraient nécessaires pour comprendre ces variations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mesurer_en_pratique">Mesurer en pratique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>La qualité des résultats dépend fortement du seeing atmosphérique.
Un mauvais seeing floute les raies spectrales et rend la détermination précise du centre difficile.
Les meilleurs résultats sont obtenus avec d&#8217;excellentes conditions de seeing et un instrument bien focalisé.
Enfin et surtout, une haute résolution spectrale est préférée, ce qui est normalement le cas avec le Sol&#8217;Ex (HR) ou le SHG 700.</p>
</div>
<div class="paragraph">
<p>Vous pouvez aussi vous demander quelle raie spectrale vous devriez observer.
J&#8217;ai testé l&#8217;algorithme avec Fe I, Na D2 et H-alpha, donnant les résultats ci-dessous.
En pratique, les raies d&#8217;absorption fortes devraient en théorie produire les meilleurs résultats, car :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>La profondeur de raie devrait être suffisante pour un ajustement précis</p>
</li>
<li>
<p>Les ailes devraient être bien définies pour l&#8217;ajustement de Voigt</p>
</li>
<li>
<p>Le rapport signal sur bruit devrait être élevé</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Les raies très larges comme Ca II K sont trop larges pour un ajustement de Voigt précis et produiront des résultats peu fiables.
Les raies trop étroites peuvent aussi représenter un défi pour l&#8217;ajustement de Voigt mais peuvent fonctionner aussi.</p>
</div>
<div class="sect2">
<h3 id="_limpact_de_la_détection_de_la_raie_spectrale">L&#8217;impact de la détection de la raie spectrale</h3>
<div class="paragraph">
<p>Un facteur subtil mais important affectant la précision absolue des mesures est la <strong>correction polynomiale</strong> utilisée pendant la reconstruction d&#8217;image.
Comprendre ceci est essentiel pour interpréter correctement vos résultats.</p>
</div>
<div class="paragraph">
<p>Pendant le traitement du spectrohéliographe, JSol&#8217;Ex calcule un polynôme qui fait correspondre chaque position de colonne le long de la fente vers la position de ligne attendue du centre de la raie spectrale.
Ce polynôme est calculé à partir de la <strong>moyenne des trames SER</strong> dans le scan (une heuristique est utilisée pour inclure les trames contenant des données solaires réelles, pas le fond de ciel).</p>
</div>
<div class="paragraph">
<p>Une telle détection est cruciale car la raie spectrale n&#8217;est pas droite à travers la fente en raison de phénomènes optiques : elle constitue ce que nous appelons souvent le "smile".
Par conséquent, le centre de raie peut être à la ligne 300 à la colonne 500. mais à la ligne 350 à la colonne 1000.
Le polynôme capture cette courbure.</p>
</div>
<div class="paragraph">
<p>En mesurant les positions de raie <strong>relativement au polynôme</strong>, nous éliminons efficacement la distorsion optique de nos mesures.
Sans cette référence, nous mesurerions la somme de la courbure optique plus le décalage Doppler, rendant impossible l&#8217;extraction des minuscules signaux de vitesse que nous recherchons.</p>
</div>
<div class="paragraph">
<p>Une question clé est : pourquoi ne pouvons-nous pas simplement mesurer la position absolue de la raie spectrale dans chaque trame et calculer les vitesses directement ?</p>
</div>
<div class="paragraph">
<p>La réponse réside dans la précision requise.
Une vitesse de 2 km/s correspond à un décalage de longueur d&#8217;onde de seulement ~0.04 Å à H-alpha.
Avec une dispersion spectrale typique de 0.1-0.2 Å/pixel, c&#8217;est un décalage de seulement <strong>0.2 à 0.4 pixels</strong>.</p>
</div>
<div class="paragraph">
<p>La courbure optique à travers la fente, d&#8217;autre part, peut facilement s&#8217;étendre sur 10-30 pixels ou plus.
Toute tentative de mesurer les positions absolues de raie serait complètement dominée par cette courbure, rendant la détection Doppler impossible.</p>
</div>
<div class="paragraph">
<p>Le polynôme sert de <strong>référence de base</strong>.
En mesurant comment la position de raie dans chaque trame individuelle <strong>dévie du polynôme</strong>, nous isolons la composante Doppler de la composante optique.
C&#8217;est l&#8217;idée clé qui rend les mesures de précision sub-pixellaire possibles, avec l&#8217;ajustement de Voigt.</p>
</div>
</div>
<div class="sect2">
<h3 id="_un_mot_sur_les_images_doppler">Un mot sur les images Doppler</h3>
<div class="paragraph">
<p>Ceci, d&#8217;ailleurs, est aussi une raison pour laquelle les images Doppler sont différentes quand on scanne en AD vs DEC.
Parce que c&#8217;est une question souvent posée, et qu&#8217;il m&#8217;a fallu <strong>des mois</strong> pour comprendre la raison, je pense qu&#8217;il vaut la peine de passer un peu de temps à expliquer le phénomène.
Je dois cette explication à Jean-François Pittet et Christian Buil, d&#8217;une discussion il y a quelques semaines sur la mailing list Sol&#8217;Ex.</p>
</div>
<div class="sect3">
<h4 id="_scan_en_ad_vs_scan_en_dec_une_différence_critique_pour_les_images_doppler">Scan en AD vs scan en DEC : une différence critique pour les images Doppler</h4>
<div class="paragraph">
<p>Les spectrohéliographes peuvent scanner le Soleil dans deux directions :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scan en AD</strong> (Ascension Droite) : La fente est orientée Nord-Sud, et le scan procède Est-Ouest</p>
</li>
<li>
<p><strong>Scan en DEC</strong> (Déclinaison) : La fente est orientée Est-Ouest, et le scan procède Nord-Sud</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ce choix a des <strong>implications profondes</strong> pour la visibilité Doppler, comme expliqué par Jean-François Pittet sur la mailing list Sol&#8217;Ex.</p>
</div>
<div class="sect4">
<h5 id="_scan_en_ad_doppler_visible_dans_les_images">Scan en AD : Doppler visible dans les images</h5>
<div class="paragraph">
<p>En mode scan AD, chaque trame capture une tranche verticale du Soleil du pôle Nord au pôle Sud.
Au cours du scan :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les premières trames capturent le <strong>limbe Est</strong> (s&#8217;approchant, décalé vers le bleu)</p>
</li>
<li>
<p>Les trames du milieu capturent le <strong>centre du disque</strong> (pas de vitesse radiale)</p>
</li>
<li>
<p>Les dernières trames capturent le <strong>limbe Ouest</strong> (s&#8217;éloignant, décalé vers le rouge)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quand JSol&#8217;Ex calcule le polynôme à partir de la moyenne de toutes les trames, les contributions Est et Ouest <strong>s&#8217;équilibrent</strong>.
Le blueshift du limbe Est est annulé par le redshift du limbe Ouest.
Le polynôme résultant représente la référence "neutre" : approximativement la position de raie au centre du disque sans décalage Doppler.</p>
</div>
<div class="paragraph">
<p>En conséquence, quand nous reconstruisons l&#8217;image au décalage de pixel 0. les décalages Doppler deviennent <strong>visibles comme différences de contraste</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le limbe Est apparaît plus sombre (raie décalée dans la bande passante)</p>
</li>
<li>
<p>Le limbe Ouest apparaît plus clair (raie décalée hors de la bande passante)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C&#8217;est pourquoi les images Doppler des scans AD montrent l&#8217;asymétrie caractéristique Est-Ouest.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scan_en_dec_doppler_absorbé_par_le_polynôme">Scan en DEC : Doppler "absorbé" par le polynôme</h5>
<div class="paragraph">
<p>En mode scan DEC, chaque trame capture une tranche horizontale du Soleil d&#8217;Est en Ouest.
Voici la différence critique : <strong>tous les pixels dans une seule trame voient approximativement le même décalage Doppler</strong>.</p>
</div>
<div class="paragraph">
<p>Par exemple, si la trame actuelle capture la moitié Est du disque :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tous les points dans cette trame s&#8217;approchent de nous</p>
</li>
<li>
<p>Tous les points ont un blueshift similaire</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quand JSol&#8217;Ex calcule le polynôme à partir de la moyenne de toutes les trames, il ne capture pas seulement la courbure optique : il capture aussi le <strong>décalage Doppler moyen</strong> à travers le scan.
Mais voici le problème : le décalage Doppler varie systématiquement à travers le scan (les trames Est sont décalées vers le bleu, les trames Ouest sont décalées vers le rouge).</p>
</div>
<div class="paragraph">
<p>Le polynôme "absorbe" effectivement une moyenne pondérée de ces décalages Doppler.
Quand nous mesurons ensuite les positions de raie relativement à ce polynôme, une grande partie du signal Doppler a déjà été soustraite.
Les images Doppler résultantes ne <strong>montreront plus la rotation du soleil</strong> (ce qui peut aussi être un avantage, pour d&#8217;autres types d&#8217;observations).</p>
</div>
<div class="paragraph">
<p>C&#8217;est pourquoi les spectrohéliographes expérimentés préfèrent souvent le scan AD pour le travail Doppler : le signal Doppler est plus visible et plus facile à détecter.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_la_complication_de_langle_p">La complication de l&#8217;angle P</h4>
<div class="paragraph">
<p>Il y a une subtilité supplémentaire : l&#8217;axe de rotation du Soleil n&#8217;est pas perpendiculaire à l&#8217;écliptique.
L'<strong>angle P</strong> (angle de position de l&#8217;axe de rotation) varie tout au long de l&#8217;année d&#8217;environ -26° à +26°.</p>
</div>
<div class="paragraph">
<p>Deux fois par an (vers début juin et début décembre) l&#8217;angle P est proche de zéro.
À ces moments :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le scan AD est vraiment parallèle à l&#8217;équateur solaire</p>
</li>
<li>
<p>Le motif Doppler Est-Ouest s&#8217;aligne parfaitement avec la direction de scan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>À d&#8217;autres moments, quand P est non nul :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L&#8217;axe de rotation est incliné par rapport à la direction de scan</p>
</li>
<li>
<p>Le motif Doppler est tourné par rapport aux axes de l&#8217;image</p>
</li>
<li>
<p>Une partie du signal Doppler "fuit" dans la moyenne polynomiale même en mode AD</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>C&#8217;est une des raisons pour lesquelles les mesures de rotation différentielle peuvent montrer des résultats légèrement différents à différentes périodes de l&#8217;année, bien que nous prenions en compte les angles P et B0.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implications_pour_les_mesures_de_rotation_différentielle">Implications pour les mesures de rotation différentielle</h4>
<div class="paragraph">
<p>Ceci explique pourquoi le <strong>scan AD est essentiel</strong> pour les mesures de vitesse différentielle :</p>
</div>
<div class="paragraph">
<p>En mode AD, les points des limbes Est et Ouest à la même latitude correspondent à la <strong>même colonne</strong> sur la fente (même position de fente, trames différentes).
La valeur du polynôme à cette colonne est calculée à partir de la moyenne de toutes les trames (limbe Est, centre du disque, et limbe Ouest) donc les décalages Doppler s&#8217;annulent dans la moyenne.
Quand nous calculons <code>(Ouest - polynôme) - (Est - polynôme)</code>, les termes du polynôme sont identiques et s&#8217;annulent, nous laissant avec la vraie différence Doppler <code>Ouest - Est</code>.</p>
</div>
<div class="paragraph">
<p>En mode DEC, les points des limbes Est et Ouest à la même latitude correspondent aux <strong>extrémités opposées de la fente</strong> (colonnes différentes, même trame).
Le polynôme à la colonne Est est calculé à partir de trames qui <strong>voient toutes le limbe Est</strong> à cette position, donc le polynôme absorbe le blueshift.
De même, le polynôme à la colonne Ouest absorbe le redshift.
Quand nous calculons la différence, ces décalages Doppler absorbés ne s&#8217;annulent pas : ils <strong>se soustraient</strong> de notre mesure, réduisant significativement le signal mesuré.</p>
</div>
<div class="paragraph">
<p>C&#8217;est pourquoi, en pratique, les scans DEC ne produisent pas d&#8217;images Doppler utilisables ou de mesures de vitesse différentielle fiables.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conseils_de_configuration">Conseils de configuration</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Longitude du limbe</strong> (par défaut 75°) : Les mesures plus proches du limbe donnent des signaux Doppler plus forts mais risquent des effets d&#8217;assombrissement centre-bord</p>
</li>
<li>
<p><strong>Pas de latitude</strong> (par défaut 2°) : Des valeurs plus petites donnent une résolution plus fine mais des temps de traitement plus longs</p>
</li>
<li>
<p><strong>Fenêtre de lissage</strong> : Devrait être au moins 2× le pas de latitude pour un lissage efficace</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Mesurer la rotation différentielle avec du matériel amateur aurait semblé impossible il y a quelques années seulement.
Des pionniers comme Peter Zetner ou Christian Buil nous ont montré la voie.
Ce que j&#8217;essaie de faire, comme toujours avec JSol&#8217;Ex, c&#8217;est de rendre ceci accessible à encore plus de personnes au prix de la "magie", c&#8217;est-à-dire que certaines personnes partageront très probablement des résultats sans comprendre la science derrière.
Je ne suis pas trop inquiet par cela, parce que je suis moi-même passé par là : apprécier la reconstruction d&#8217;images SHG, puis comprendre comment ça fonctionne, puis me poser des questions comme "pourquoi est-il même possible de mesurer des vitesses Doppler si petites ?" : c&#8217;est une construction intellectuelle qui prend du temps.
Nous, membres de la communauté Sol&#8217;Ex, pouvons faire mieux, je pense, pour apporter cela aux masses, en partageant nos idées et en écrivant des logiciels comme celui-ci.</p>
</div>
<div class="paragraph">
<p>Cette fonctionnalité rejoint la liste croissante des capacités scientifiques dans JSol&#8217;Ex : détection des bombes d&#8217;Ellerman, identification des régions actives, et maintenant mesure de la rotation différentielle.
Chacune de celles-ci met des analyses de niveau professionnel à la portée des astronomes amateurs, mais, comme toujours, soyez prudent avec ce que je dis : je ne suis pas un scientifique, juste un ingénieur.
Je n&#8217;ai aucun doute que j&#8217;ai fait des approximations, ou pris des libertés que je n&#8217;aurais probablement pas dû prendre.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliographie">Bibliographie</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_articles_scientifiques">Articles scientifiques</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1951MNRAS.111..413N/abstract">Newton, H.W. &amp; Nunn, M.L. (1951) - The Sun&#8217;s rotation derived from sunspots 1934-1944. MNRAS 111, 413</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF02276562">Howard, R. &amp; Harvey, J. (1970) - Spectroscopic determinations of solar rotation. Sol Phys 12. 23-51</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF00154804">Snodgrass, H.B. (1984) - Separation of large-scale photospheric Doppler patterns. Sol Phys 94, 13-31</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1086/168467">Snodgrass, H.B. &amp; Ulrich, R.K. (1990) - Rotation of Doppler features in the solar photosphere. ApJ 351, 309</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1023/A:1005226402796">Beck, J.G. (2000) - A comparison of differential rotation measurements. Sol Phys 191, 47-70</a></p>
</li>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/2000A%26A&#8230;&#8203;357..763W/abstract">Wöhl, H. &amp; Schmidt, W. (2000) - Solar equatorial plasma rotation: a comparison of different spectroscopic measurements. A&amp;A 357, 763-766</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2406.18271">Takeda, Y. &amp; Ueno, S. (2024) - Measurement of Solar Differential Rotation by Absolutely Calibrated Iodine-Cell Spectroscopy</a></p>
</li>
<li>
<p><a href="https://www.aanda.org/articles/aa/full_html/2025/10/aa56102-25/aa56102-25.html">Corbard, T. et al. (2025) - Rotational radial shear in the low solar photosphere. A&amp;A 702. A93</a></p>
</li>
<li>
<p><a href="https://www.nature.com/articles/s41550-024-02299-4">Li, Z. et al. (2024) - Height-dependent differential rotation of the solar atmosphere detected by CHASE. Nature Astronomy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ressources_amateurs">Ressources amateurs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">Zetner, P. (2017) - Solar differential rotation measured with a spectroheliograph (CloudyNights)</a></p>
</li>
<li>
<p><a href="https://solar-astronomy-book.com/">Zetner, P. et al. - Solar Astronomy: Observing, imaging and studying the Sun</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/solex/">Sol&#8217;Ex - Projet de spectrohéliographe de Christian Buil</a></p>
</li>
<li>
<p><a href="https://melix.github.io/astro4j/latest/fr/jsolex.html">Documentation JSol&#8217;Ex</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></p>
  			<a href="/blog/2026/02/05-measuring-solar-rotation.html"><h1>Measuring Solar Differential Rotation with JSol&#8217;Ex</h1></a>
  			<p>05 February 2026</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solar.html">solar</a> 
	
		<a href="/blog/tags/astronomy.html">astronomy</a> 
	
		<a href="/blog/tags/doppler.html">doppler</a> 
	
		<a href="/blog/tags/rotation.html">rotation</a> 
	</p>
			
  			<p><div class="sect1">
<h2 id="_a_rotating_ball_of_plasma">A Rotating Ball of Plasma</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One fascinating aspect of the Sun is that it doesn&#8217;t rotate like a solid body.
Unlike the Earth, which completes one rotation in 24 hours regardless of latitude, the Sun&#8217;s rotation rate varies with latitude: the equator rotates faster than the poles.
This phenomenon, called <strong>differential rotation</strong>, has been studied since the 19th century and remains an important research topic in solar physics.</p>
</div>
<div class="paragraph">
<p>The equatorial regions of the Sun complete a rotation in approximately 25 days, while near the poles, it takes about 35 days.
This differential rotation is thought to play a key role in the solar dynamo mechanism that generates the Sun&#8217;s magnetic field and drives the 11-year solar cycle.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/differential-rotation-concept.svg" alt="Differential rotation concept" width="600">
</div>
</div>
<div class="paragraph">
<p>In this blog post, I will explain how I implemented a feature in JSol&#8217;Ex 4.5.0 that allows amateur astronomers to measure this differential rotation directly from their spectroheliograph data.
A common mistake is to think that this measurement is not possible because the spectral dispersion of a SHG like the Sol&#8217;Ex is typically around 0.1 to 0.2Å, which larger than the scale of what we&#8217;re trying to measure (2 km/s, which is about 0.04Å).
In fact, what we are trying to measure requires sub-pixel precision and we can achieve that.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_doppler_effect">The Doppler Effect</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The principle behind the measurement is simple: the <strong>Doppler effect</strong>.
When a light source moves towards us, the wavelength is shifted towards the blue end of the spectrum (blueshift).
When it moves away, the wavelength shifts towards the red (redshift).</p>
</div>
<div class="paragraph">
<p>Since the Sun rotates, one limb is always moving towards us (let&#8217;s say the East limb) while the other is moving away (the West limb).
By measuring the wavelength shift of a spectral line at both limbs, we can calculate the rotation velocity.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/doppler-effect-sun.svg" alt="Doppler effect for measuring solar rotation" width="700">
</div>
</div>
<div class="paragraph">
<p>One might wonder about the Earth&#8217;s own motion: we orbit the Sun at approximately 30 km/s, which is much larger than the ~2 km/s solar rotation velocity we&#8217;re trying to measure.
This orbital motion does produce a Doppler shift of the entire solar spectrum.
However, this affects equally all points we can measure: this is a global shift which affects all measurements equally and cancels out.
The same is true for any radial velocity of the Sun relative to the Earth (which varies slightly throughout the year as Earth&#8217;s orbit is elliptical).</p>
</div>
<div class="paragraph">
<p>The fundamental formula relating Doppler shift to velocity is:</p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\Delta\lambda}{\lambda_0} = \frac{v}{c}\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\Delta\lambda\) is the wavelength shift</p>
</li>
<li>
<p>\(\lambda_0\) is the rest wavelength of the spectral line (typically the H-alpha wavelength)</p>
</li>
<li>
<p>\(v\) is the velocity along the line of sight</p>
</li>
<li>
<p>\(c\) is the speed of light (299,792 km/s)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_measurement_methodology">The Measurement Methodology</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_previous_work">Previous Work</h3>
<div class="paragraph">
<p>I am not the first person to try to make this measurement in amateur spectroheliography.
In 2017, Peter Zetner <a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">explained on CloudyNights</a> how to measure differential velocity using a spectroheliograph.
He explained this methodology in depth in the <a href="https://solar-astronomy-book.com/">Solar Astronomy - Observing, imaging and studying the Sun</a> book.
His methodology relies on measurements using the Na D2 line, but can also be applied on other bright lines including the commonly used Fe I line at 5250.2 Å, and involves comparing the pixel intensities, by averaging them at different latitudes.
The best results are obtained by performing several scans and averaging data.
While this works, I wanted to try a different methodology:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a single scan: the Doppler images that JSol&#8217;Ex or INTI can produce are in general very consistent and show that all the data we need is already present</p>
</li>
<li>
<p>Avoid pixel intensities: these are very sensitive to limb darkening, observing conditions (e.g clouds, even if thin) or vignetting (darkening of the images along the slit)</p>
</li>
<li>
<p>Make it possible to use H-alpha scans, not because they would give an accurate value of the velocity of the photosphere plasma, but because that&#8217;s the most widely imaged line in amateur solar observations</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The results, of course, will depend on the observed line.
The methodology that I describe below is capable of returning reasonable results on several lines (H-alpha, Na D2, Fe I) but will completely fail on some others (e.g Ca II K, typically because the line is too wide).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s dive into the methodology.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The implementation described here was developed iteratively based on real observations. I&#8217;m not a solar physicist, just an engineer trying to extract meaningful data from spectroheliograph captures. The algorithm works reasonably well in practice but should be validated against professional measurements for any scientific application. Therefore why it is advertised as experimental.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_east_west_limb_comparison">East-West Limb Comparison</h3>
<div class="paragraph">
<p>The key to understanding the methodology is that it relies on spectral line profile analysis and fitting.
It requires extracting the spectral line profiles at different locations of the solar disk, preferably near the limbs where the velocities are highest.</p>
</div>
<div class="paragraph">
<p>The differential rotation measurement extracts solar rotation velocities by comparing Doppler shifts between East and West limb points at the same heliographic latitude.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/spectral-profiles.svg" alt="Doppler Shifted Profiles" width="500">
</div>
</div>
<div class="paragraph">
<p>For each latitude (say, 20° North), the algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selects a point on the East limb</p>
</li>
<li>
<p>Selects the corresponding point on the West limb at the same latitude</p>
</li>
<li>
<p>Measures the spectral line position at each point</p>
</li>
<li>
<p>Computes the difference: West - East</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This differential approach has a crucial advantage: it cancels out systematic errors.
Any instrumental offset, wavelength calibration error, or baseline shift affects both measurements equally and disappears when we take the difference.</p>
</div>
<div class="paragraph">
<p>However, a single East-West measurement at each latitude is not reliable enough.
Seeing conditions, local solar activity, or fitting errors can corrupt individual measurements.
To improve accuracy, JSol&#8217;Ex samples <strong>multiple longitudes</strong> across the limb region (typically 14 points from 62° to 88° longitude) and aggregates these measurements.
This redundancy allows outliers to be rejected and provides an error estimate based on measurement consistency.</p>
</div>
<div class="paragraph">
<p>The measured velocity is then:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{measured} = \frac{\Delta\lambda}{\lambda_0} \times \frac{c}{2}\]
</div>
</div>
<div class="paragraph">
<p>The factor of 2 appears because we&#8217;re measuring the difference between approaching and receding limbs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_from_measured_velocity_to_equatorial_velocity">From Measured Velocity to Equatorial Velocity</h3>
<div class="paragraph">
<p>The velocity we measure depends on the geometry: how much of the rotation velocity is projected along our line of sight.
At the equator and at the limb, we see the full rotation velocity.
At higher latitudes or closer to disk center, we see only a fraction.</p>
</div>
<div class="paragraph">
<p>The geometric correction factor is:</p>
</div>
<div class="stemblock">
<div class="content">
\[v_{equatorial} = \frac{v_{measured}}{\cos(\phi) \times \sin(\theta)}\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) is the heliographic latitude</p>
</li>
<li>
<p>\(\theta\) is the heliographic longitude (0° at disk center, ±90° at the limbs)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_finding_the_spectral_line_center">Finding the Spectral Line Center</h3>
<div class="paragraph">
<p>The most challenging part of the measurement is accurately determining the center of the absorption line.
A shift of just 0.01 Å corresponds to a velocity of about 0.5 km/s, which is significant compared to the typical equatorial velocity of ~2 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex uses <strong>Voigt profile fitting</strong> to measure the line center.
The Voigt profile is the convolution of a Gaussian and a Lorentzian profile, which accurately models the shape of solar absorption lines.
The Gaussian component represents thermal Doppler broadening, while the Lorentzian component represents natural and pressure broadening.</p>
</div>
<div class="paragraph">
<p>For each measurement point, the algorithm:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extracts a spectral profile from the SER file at the corresponding position</p>
</li>
<li>
<p>Fits a Voigt profile to the absorption line</p>
</li>
<li>
<p>Records the fitted line center position</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The configurable "Voigt fit half-width" parameter (default: 2 Å) controls how much of the line wings are included in the fit.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coordinate_systems">Coordinate Systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the trickier aspects of this implementation is correctly mapping between the different coordinate systems involved.
The algorithm starts with heliographic coordinates (where we want to measure) and maps them back to the original SER frames (where the spectral data lives).</p>
</div>
<div class="paragraph">
<p><strong>1. Heliographic Coordinates (starting point)</strong></p>
</div>
<div class="paragraph">
<p>We begin by specifying points in heliographic coordinates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Latitude</strong>: -90° (south pole) to +90° (north pole)</p>
</li>
<li>
<p><strong>Longitude</strong>: 0° at disk center, ±90° at the limbs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This requires two solar parameters computed from the observation date:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>B0</strong>: The heliographic latitude of the disk center (varies throughout the year)</p>
</li>
<li>
<p><strong>P</strong>: The position angle of the rotation axis (the "tilt" of the Sun as seen from Earth)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>2. Image Coordinates</strong></p>
</div>
<div class="paragraph">
<p>The heliographic coordinates are converted to pixel positions in the reconstructed image.
This involves reversing the corrections applied during reconstruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>P-angle correction</p>
</li>
<li>
<p>Flip/rotation</p>
</li>
<li>
<p>Geometric distortion</p>
</li>
<li>
<p>Tilt angle</p>
</li>
<li>
<p>Cropping</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>3. SER File Coordinates (destination)</strong></p>
</div>
<div class="paragraph">
<p>Finally, the image coordinates are mapped to the raw SER video file:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Frame number</strong>: Position in the scan sequence (derived from x-coordinate)</p>
</li>
<li>
<p><strong>Column</strong>: Position along the slit (derived from y-coordinate)</p>
</li>
<li>
<p><strong>Row</strong>: Spectral direction (wavelength)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This reverse mapping allows us to extract the exact spectral profile at any heliographic location.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_data_processing_pipeline">The Data Processing Pipeline</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The raw measurements are noisy.
To produce a clean rotation curve, JSol&#8217;Ex uses a two-stage processing pipeline:</p>
</div>
<div class="sect2">
<h3 id="_stage_1_longitude_aggregation">Stage 1: Longitude Aggregation</h3>
<div class="paragraph">
<p>As described earlier, at each latitude, multiple longitudes are sampled (typically 14 points across the limb region).
These measurements are combined using one of three methods (the default is median but you can choose):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Median</strong>: Robust to outliers, uses the middle value</p>
</li>
<li>
<p><strong>Average</strong>: Simple arithmetic mean</p>
</li>
<li>
<p><strong>Weighted Average</strong>: Points closer to the limb (where Doppler signal is stronger) get higher weight</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The error estimate from this stage represents the consistency of measurements across longitudes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stage_2_latitude_smoothing">Stage 2: Latitude Smoothing</h3>
<div class="paragraph">
<p>Even after longitude aggregation, the latitude-by-latitude measurements remain noisy.
Individual latitude bins can still be affected by localized features (sunspots, faculae) or simply measurement scatter.</p>
</div>
<div class="paragraph">
<p>Since we expect solar rotation to vary <strong>smoothly</strong> with latitude (following the \(\sin^2\phi\) and \(\sin^4\phi\) terms of the differential rotation law), we can exploit this physical constraint to reduce noise further.
JSol&#8217;Ex applies a smoothing filter that combines nearby latitude points within a configurable window (default: 5°).</p>
</div>
<div class="paragraph">
<p>Importantly, the errors from Stage 1 are <strong>propagated</strong> rather than recomputed from the spread in the smoothing window.
This ensures the error bars represent measurement uncertainty, not physical latitude variations.</p>
</div>
<div class="paragraph">
<p>For the median aggregation:</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{median(\sigma_i)}{\sqrt{n}}\]
</div>
</div>
<div class="paragraph">
<p>For the average:</p>
</div>
<div class="stemblock">
<div class="content">
\[\sigma_{smoothed} = \frac{\sqrt{\sum \sigma_i^2}}{n}\]
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_outcome_and_comparison_with_theory">The Outcome and Comparison with Theory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The standard form of the differential rotation law (also known as the Faye formula, even if the original formula didn&#8217;t include the 3rd term) is:</p>
</div>
<div class="stemblock">
<div class="content">
\[\omega(\phi) = A + B \sin^2(\phi) + C \sin^4(\phi)\]
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(\phi\) is the heliographic latitude</p>
</li>
<li>
<p>\(A\) is the equatorial rotation rate</p>
</li>
<li>
<p>\(B\) and \(C\) control the decrease in velocity with latitude</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex compares measured results with the widely-used coefficients from <strong>Snodgrass &amp; Ulrich (1990)</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\(A = 14.713\) deg/day (equatorial rotation rate)</p>
</li>
<li>
<p>\(B = -2.396\) deg/day</p>
</li>
<li>
<p>\(C = -1.787\) deg/day</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This gives an equatorial rotation period of about 24.5 days and a polar period of about 34 days.
Converting to linear velocity at the solar surface (radius ≈ 696,000 km), the equatorial rotation velocity is approximately 2.0 km/s.</p>
</div>
<div class="paragraph">
<p>JSol&#8217;Ex also fits its own A, B, C coefficients from your measurements, allowing direct comparison with the reference values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_results">Results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Below are example differential rotation profiles measured with JSol&#8217;Ex using two different spectral lines.
These measurements were taken on different dates with different seeing conditions.</p>
</div>
<div class="sect2">
<h3 id="_fe_i_5883_å">Fe I 5883 Å</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-FeI.png" alt="velocity FeI">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_h_alpha">H-alpha</h3>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-diff-velocity/velocity-Ha.png" alt="velocity Ha">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_observations">Observations</h3>
<div class="paragraph">
<p>The measured profiles show the expected general shape: higher velocities at the equator, decreasing toward the poles.
The fitted curves follow the theoretical Snodgrass profile reasonably well.</p>
</div>
<div class="paragraph">
<p>However, I observe differences between spectral lines that I cannot fully explain.
The Fe I measurements show different absolute velocities than H-alpha, and the fitted coefficients differ between scans.</p>
</div>
<div class="paragraph">
<p>Several factors could contribute to these differences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Formation height</strong>: Different spectral lines form at different heights in the solar atmosphere, and rotation rates may vary with height (as suggested by recent research from the <a href="https://www.nature.com/articles/s41550-024-02299-4">CHASE mission</a>)</p>
</li>
<li>
<p><strong>Seeing conditions</strong>: The scans were taken on different dates with different atmospheric conditions</p>
</li>
<li>
<p><strong>Line profile differences</strong>: H-alpha and Fe I have different line widths and depths, which may affect the Voigt fitting precision</p>
</li>
<li>
<p><strong>Systematic effects</strong>: There may be instrumental or algorithmic factors I haven&#8217;t identified</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>I present these results as they are, without attempting to draw conclusions about which measurement is "correct" or what causes the observed differences.
More measurements across different dates, spectral lines, and instruments would be needed to understand these variations.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_measuring_in_practice">Measuring in Practice</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The quality of results depends heavily on atmospheric seeing.
Poor seeing blurs the spectral lines and makes accurate center determination difficult.
Best results are obtained with excellent seeing conditions and a well-focused instrument.
Last but not least, a high spectral resolution is preferred, which is normally the case with Sol&#8217;Ex (HR) or the SHG 700.</p>
</div>
<div class="paragraph">
<p>You may also wonder which spectral line you should observe.
I tested the algorithm with Fe I, Na D2 and H-alpha, giving the results below.
In practice, strong absorption lines should in theory produce the best results, because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The line depth should be sufficient for accurate fitting</p>
</li>
<li>
<p>The wings should be well-defined for Voigt fitting</p>
</li>
<li>
<p>The signal-to-noise ratio should be high</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Very broad lines like Ca II K are too wide for accurate Voigt fitting and will produce unreliable results.
Too narrow lines may also represent a challenge for Voigt fitting but may work too.</p>
</div>
<div class="sect2">
<h3 id="_the_impact_of_the_spectral_line_detection">The Impact of the Spectral Line Detection</h3>
<div class="paragraph">
<p>One subtle but important factor affecting the absolute accuracy of the measurements is the <strong>polynomial correction</strong> used during image reconstruction.
Understanding this is essential for interpreting your results correctly.</p>
</div>
<div class="paragraph">
<p>During spectroheliograph processing, JSol&#8217;Ex computes a polynomial that maps each column position along the slit to the expected row position of the spectral line center.
This polynomial is computed from the <strong>average of SER frames</strong> in the scan (a heuristic is used to include frames containing actual solar data, not sky background).</p>
</div>
<div class="paragraph">
<p>Such a detection is crucial because the spectral line is not straight across the slit due to optical phenomenons: it consistutes what we often call the "smile".
Therefore, the line center might be at row 300 at column 500, but at row 350 at column 1000.
The polynomial captures this curvature.</p>
</div>
<div class="paragraph">
<p>By measuring line positions <strong>relative to the polynomial</strong>, we effectively remove the optical distortion from our measurements.
Without this reference, we would be measuring the sum of optical curvature plus Doppler shift, making it impossible to extract the tiny velocity signals we&#8217;re after.</p>
</div>
<div class="paragraph">
<p>A key question is: why can&#8217;t we just measure the absolute position of the spectral line in each frame and compute velocities directly?</p>
</div>
<div class="paragraph">
<p>The answer lies in the precision required.
A velocity of 2 km/s corresponds to a wavelength shift of only ~0.04 Å at H-alpha.
With a typical spectral dispersion of 0.1-0.2 Å/pixel, this is a shift of only <strong>0.2 to 0.4 pixels</strong>.</p>
</div>
<div class="paragraph">
<p>The optical curvature across the slit, on the other hand, can easily span 10-30 pixels or more.
Any attempt to measure absolute line positions would be completely dominated by this curvature, making Doppler detection impossible.</p>
</div>
<div class="paragraph">
<p>The polynomial serves as our <strong>reference baseline</strong>.
By measuring how the line position in each individual frame <strong>deviates from the polynomial</strong>, we isolate the Doppler component from the optical component.
This is the key insight that makes sub-pixel precision measurements possible, alongside the Voigt fitting.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_word_about_doppler_images">A Word About Doppler Images</h3>
<div class="paragraph">
<p>This, by the way, is also a reason why the Doppler images look different when scanning in RA vs DEC.
Because this is a question that is often asked, and that it took <strong>months</strong> for me to understand the reason, I think it&#8217;s worth spending a bit of time explaining the phenomenon.
I owe this explanation to Jean-François Pittet and Christian Buil, from a discussion weeks ago on the Sol&#8217;Ex mailing list.</p>
</div>
<div class="sect3">
<h4 id="_ra_scanning_vs_dec_scanning_a_critical_difference_for_doppler_images">RA Scanning vs DEC Scanning: A Critical Difference for Doppler Images</h4>
<div class="paragraph">
<p>Spectroheliographs can scan the Sun in two directions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>RA scanning</strong> (Right Ascension): The slit is oriented North-South, and the scan proceeds East-West</p>
</li>
<li>
<p><strong>DEC scanning</strong> (Declination): The slit is oriented East-West, and the scan proceeds North-South</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This choice has <strong>profound implications</strong> for Doppler visibility, as explained by Jean-François Pittet on the Sol&#8217;Ex mailing list.</p>
</div>
<div class="sect4">
<h5 id="_ra_scanning_doppler_visible_in_images">RA Scanning: Doppler Visible in Images</h5>
<div class="paragraph">
<p>In RA scanning mode, each frame captures a vertical slice of the Sun from North pole to South pole.
Over the course of the scan:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Early frames capture the <strong>East limb</strong> (approaching, blueshifted)</p>
</li>
<li>
<p>Middle frames capture the <strong>disk center</strong> (no radial velocity)</p>
</li>
<li>
<p>Late frames capture the <strong>West limb</strong> (receding, redshifted)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When JSol&#8217;Ex computes the polynomial from the average of all frames, the East and West contributions <strong>balance out</strong>.
The blueshift from the East limb is canceled by the redshift from the West limb.
The resulting polynomial represents the "neutral" baseline: approximately the line position at disk center with no Doppler shift.</p>
</div>
<div class="paragraph">
<p>As a result, when we reconstruct the image at pixel shift 0, the Doppler shifts become <strong>visible as contrast differences</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>East limb appears darker (line shifted into the passband)</p>
</li>
<li>
<p>West limb appears brighter (line shifted out of the passband)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is why Doppler images from RA scans show the characteristic East-West asymmetry.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dec_scanning_doppler_absorbed_by_the_polynomial">DEC Scanning: Doppler "Absorbed" by the Polynomial</h5>
<div class="paragraph">
<p>In DEC scanning mode, each frame captures a horizontal slice of the Sun from East to West.
Here&#8217;s the critical difference: <strong>all pixels within a single frame see approximately the same Doppler shift</strong>.</p>
</div>
<div class="paragraph">
<p>For example, if the current frame is capturing the Eastern half of the disk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All points in that frame are approaching us</p>
</li>
<li>
<p>All points have similar blueshift</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When JSol&#8217;Ex computes the polynomial from the average of all frames, it doesn&#8217;t just capture the optical curvature: it also captures the <strong>average Doppler shift</strong> across the scan.
But here&#8217;s the problem: the Doppler shift varies systematically across the scan (East frames are blueshifted, West frames are redshifted).</p>
</div>
<div class="paragraph">
<p>The polynomial effectively "absorbs" a weighted average of these Doppler shifts.
When we then measure line positions relative to this polynomial, much of the Doppler signal has already been subtracted out.
The resulting Doppler images will <strong>no longer show the rotation of the sun</strong> (which can also be a benefit, for other kind of observations).</p>
</div>
<div class="paragraph">
<p>This is why experienced spectroheliographers often prefer RA scanning for Doppler work: the Doppler signal is more visible and easier to detect.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_the_p_angle_complication">The P-Angle Complication</h4>
<div class="paragraph">
<p>There&#8217;s an additional subtlety: the Sun&#8217;s rotation axis is not perpendicular to the ecliptic.
The <strong>P-angle</strong> (position angle of the rotation axis) varies throughout the year from about -26° to +26°.</p>
</div>
<div class="paragraph">
<p>Only twice per year (around early June and early December) is the P-angle close to zero.
At these times:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RA scanning is truly parallel to the solar equator</p>
</li>
<li>
<p>The East-West Doppler pattern aligns perfectly with the scan direction</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At other times, when P is non-zero:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The rotation axis is tilted relative to the scan direction</p>
</li>
<li>
<p>The Doppler pattern is rotated relative to the image axes</p>
</li>
<li>
<p>Some Doppler signal "leaks" into the polynomial average even in RA mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This is one reason why differential rotation measurements can show slightly different results at different times of year, despite us taking the P and B0 angles into account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implications_for_differential_rotation_measurements">Implications for Differential Rotation Measurements</h4>
<div class="paragraph">
<p>This explains why <strong>RA scanning is essential</strong> for differential velocity measurements:</p>
</div>
<div class="paragraph">
<p>In RA mode, East and West limb points at the same latitude correspond to the <strong>same column</strong> on the slit (same slit position, different frames).
The polynomial value at that column is computed from the average of all frames (East limb, disk center, and West limb) so the Doppler shifts cancel out in the average.
When we compute <code>(West - polynomial) - (East - polynomial)</code>, the polynomial terms are identical and cancel, leaving us with the true Doppler difference <code>West - East</code>.</p>
</div>
<div class="paragraph">
<p>In DEC mode, East and West limb points at the same latitude correspond to <strong>opposite ends of the slit</strong> (different columns, same frame).
The polynomial at the East column is computed from frames that <strong>all see the East limb</strong> at that position, so the polynomial absorbs the blueshift.
Similarly, the polynomial at the West column absorbs the redshift.
When we compute the difference, these absorbed Doppler shifts don&#8217;t cancel: they <strong>subtract from</strong> our measurement, significantly reducing the measured signal.</p>
</div>
<div class="paragraph">
<p>This is why, in practice, DEC scans do not produce usable Doppler images or reliable differential velocity measurements.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_tips">Configuration Tips</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Limb longitude</strong> (default 75°): Measurements closer to the limb give stronger Doppler signals but risk limb darkening effects</p>
</li>
<li>
<p><strong>Latitude step</strong> (default 2°): Smaller values give finer resolution but longer processing times</p>
</li>
<li>
<p><strong>Smoothing window</strong>: Should be at least 2× the latitude step for effective smoothing</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Measuring differential rotation with amateur equipment would have seemed impossible just a few years ago.
Pioneers like Peter Zetner or Christian Buil showed us the path.
What I&#8217;m trying to do, as always with JSol&#8217;Ex, is to make this accessible to even more people at the cost of "magic", which is that some people will very likely share results without understanding the science behind it.
I&#8217;m not too concerned by this, as I, myself, have been going this way: enjoying SHG image reconstruction, then figuring out how it works, then asking myself questions like "why is it even possible that we measure Doppler velocities so small?": this is an intellectual construct that takes time and we can do better, I think, at brining this to the masses, sharing our insights.</p>
</div>
<div class="paragraph">
<p>This feature joins the growing list of scientific capabilities in JSol&#8217;Ex: Ellerman bomb detection, active region identification, and now differential rotation measurement.
Each of these brings professional-level analysis within reach of amateur astronomers, but, as always, be cautious with what I&#8217;m saying: I&#8217;m not a scientist, just an engineer.
I have no doubts that I made approximations, or took liberties that I should probably not have taken.</p>
</div>
<div class="paragraph">
<p>However, I do think that this brings value to the ecosystem.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliography">Bibliography</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scientific_papers">Scientific Papers</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/1951MNRAS.111..413N/abstract">Newton, H.W. &amp; Nunn, M.L. (1951) - The Sun&#8217;s rotation derived from sunspots 1934-1944. MNRAS 111, 413</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF02276562">Howard, R. &amp; Harvey, J. (1970) - Spectroscopic determinations of solar rotation. Sol Phys 12, 23-51</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1007/BF00154804">Snodgrass, H.B. (1984) - Separation of large-scale photospheric Doppler patterns. Sol Phys 94, 13-31</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1086/168467">Snodgrass, H.B. &amp; Ulrich, R.K. (1990) - Rotation of Doppler features in the solar photosphere. ApJ 351, 309</a></p>
</li>
<li>
<p><a href="https://doi.org/10.1023/A:1005226402796">Beck, J.G. (2000) - A comparison of differential rotation measurements. Sol Phys 191, 47-70</a></p>
</li>
<li>
<p><a href="https://ui.adsabs.harvard.edu/abs/2000A%26A&#8230;&#8203;357..763W/abstract">Wöhl, H. &amp; Schmidt, W. (2000) - Solar equatorial plasma rotation: a comparison of different spectroscopic measurements. A&amp;A 357, 763-766</a></p>
</li>
<li>
<p><a href="https://arxiv.org/abs/2406.18271">Takeda, Y. &amp; Ueno, S. (2024) - Measurement of Solar Differential Rotation by Absolutely Calibrated Iodine-Cell Spectroscopy</a></p>
</li>
<li>
<p><a href="https://www.aanda.org/articles/aa/full_html/2025/10/aa56102-25/aa56102-25.html">Corbard, T. et al. (2025) - Rotational radial shear in the low solar photosphere. A&amp;A 702, A93</a></p>
</li>
<li>
<p><a href="https://www.nature.com/articles/s41550-024-02299-4">Li, Z. et al. (2024) - Height-dependent differential rotation of the solar atmosphere detected by CHASE. Nature Astronomy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_amateur_resources">Amateur Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.cloudynights.com/forums/topic/574571-solar-differential-rotation-measured-with-a-spectroheliograph/">Zetner, P. (2017) - Solar differential rotation measured with a spectroheliograph (CloudyNights)</a></p>
</li>
<li>
<p><a href="https://solar-astronomy-book.com/">Zetner, P. et al. - Solar Astronomy: Observing, imaging and studying the Sun</a></p>
</li>
<li>
<p><a href="http://www.astrosurf.com/solex/">Sol&#8217;Ex - Christian Buil&#8217;s spectroheliograph project</a></p>
</li>
<li>
<p><a href="https://melix.github.io/astro4j/latest/en/jsolex.html">JSol&#8217;Ex Documentation</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></p>
  			<a href="/blog/2025/09-11-jsolex-4.0.0.html"><h1>JSol&#8217;Ex 4.0.0 est sorti !</h1></a>
  			<p>11 September 2025</p>
			<p><em>Tags: </em>
		<a href="/blog/tags/solex.html">solex</a> 
	
		<a href="/blog/tags/jsolex.html">jsolex</a> 
	
		<a href="/blog/tags/solaire.html">solaire</a> 
	
		<a href="/blog/tags/astronomie.html">astronomie</a> 
	
		<a href="/blog/tags/ia.html">ia</a> 
	
		<a href="/blog/tags/claude.html">claude</a> 
	
		<a href="/blog/tags/bass2000.html">bass2000</a> 
	</p>
			
  			<p><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Le 18 février 2023, je montais à l&#8217;Observatoire du Pic du Midi de Bigorre pour y passer une "Nuit au Sommet", une expérience mêlant observation nocturne et visite des installations scientifiques. J&#8217;y ai découvert avec fascination le coronographe Bernard-Lyot, l&#8217;expérience <a href="https://climso.fr/">CLIMSO</a> gérée par les Observateurs Associés de l&#8217;Observatoire Midi-Pyrénées.</p>
</div>
<div class="paragraph">
<p>Des étoiles plein les yeux (et une en particulier, notre soleil), ma vie d&#8217;astronome amateur centrée sur le ciel profond allait basculer vers l&#8217;observation de notre Soleil. De retour à la maison, j&#8217;ai commencé à me renseigner sur le matériel solaire, et découvrait avec stupéfaction qu&#8217;il fallait investir, beaucoup, pour pouvoir observer notre astre en toute sécurité : filtres pleine ouverture, étalons, &#8230;&#8203; tout avait un coût démesuré pour un débutant comme moi. De quoi décourager, jusqu&#8217;à ce que je tombe par hasard <a href="http://www.astrosurf.com/solex/">sur le projet Sol&#8217;Ex</a>, initié par la légende Christian Buil.</p>
</div>
<div class="paragraph">
<p>Ce projet, très didactique, permet de se construire un spectrohéliographe, par impression 3D. Un tel instrument présente de nombreux avantages : coût modeste, résolution élevée et la possibilité d&#8217;observer dans de nombreuses longueurs d&#8217;ondes tout en mettant à disposition des données exploitables scientifiquement !</p>
</div>
<div class="paragraph">
<p>L&#8217;inconvénient, si c&#8217;en est vraiment un, de cet instrument est qu&#8217;il ne produit pas une image du soleil observable directement à l&#8217;oculaire. Il est nécessaire d&#8217;utiliser un logiciel de reconstruction qui, à partir d&#8217;une vidéo enregistrant un "scan" du soleil, permet de générer une (voir plus) images du soleil. Ce processus de reconstruction, bien mystérieux pour moi à l&#8217;époque, était réalisé par un <a href="http://valerie.desnoux.free.fr/inti/">logiciel écrit par Valérie Desnoux, nommé INTI</a>. Etant développeur (Java), je me suis alors lancé un challenge à l&#8217;époque : puisque je ne comprenais pas comment ça fonctionnait, j&#8217;allais essayer de créer moi-même un logiciel pour faire cette reconstruction. De cet appétit est né <a href="https://melix.github.io/astro4j/latest/fr/jsolex.html">JSol&#8217;Ex</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsolex_4_0_et_la_collaboration_scientifique">JSol&#8217;Ex 4.0 et la collaboration scientifique</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nous voici 2 ans et demi plus tard, JSol&#8217;Ex arrive en version 4. Entre temps, le nombre d&#8217;utilisateurs a explosé et mon logiciel est exploité non seulement par les utilisateurs du Sol&#8217;Ex de Christian Buil, mais aussi pour des spectrohéliographes commerciaux comme le <a href="https://mlastro.com/mlastro-shg">MLAstro SHG 700</a> (que j&#8217;utilise désormais). JSol&#8217;Ex a apporté de nombreuses innovations, comme la possibilité d&#8217;exécuter des scripts pour générer des animations, faire du stacking, créer des images personnalisées, ou encore la détection automatique d&#8217;éruptions, des régions actives (avec annotation), la détection de bombes d&#8217;Ellerman, la correction des bords dentelés et j&#8217;en passe.</p>
</div>
<div class="paragraph">
<p>Récemment, JSol&#8217;Ex a été utilisé pour réaliser un <a href="https://iopscience.iop.org/article/10.3847/2515-5172/adef50">Atlas de Spectrohéliogrammes</a>, et mentionné dans <a href="https://arxiv.org/abs/2508.10853">un article précisément sur la détection des bombes d&#8217;Ellerman</a>. Bref, JSol&#8217;Ex était devenu suffisamment mature pour faire de la "vraie science", chose qui m&#8217;a toujours un peu effrayé pour être honnête.</p>
</div>
<div class="paragraph">
<p>Ainsi, j&#8217;ai toujours refusé d&#8217;intégrer une fonctionnalité dans JSol&#8217;Ex, qui m&#8217;a pourtant été demandée de nombreuses fois : la possibilité de l&#8217;utiliser pour soumettre des images dans la <a href="https://bass2000.obspm.fr/">base de données BASS2000</a> de l&#8217;<a href="https://www.linkedin.com/school/lira-observatoire-de-paris/">Observatoire de Paris-Meudon</a>. Plusieurs raisons à cela : d&#8217;une, je ne faisais pas confiance à mon propre logiciel pour sa qualité "scientifique". Si je le savais capable de produire de "belles images", il est tout à fait différent de s&#8217;en servir pour une exploitation scientifique. D&#8217;autre part, il n&#8217;était pas question pour moi d&#8217;intégrer une fonctionnalité qui avait été développée par Valérie Desnoux (autrice de INTI) et l&#8217;équipe de Meudon sans son accord, par respect pour son travail.</p>
</div>
<div class="paragraph">
<p>Cependant, vous aurez compris que les temps ont changé et que la pression des utilisateurs ainsi que mes discussions avec Florence Cornu, du projet SOLAP, aux Rencontres du Ciel et de l&#8217;Espace fin 2024, puis aux <a href="https://www.mars60.fr/jason2025/">JASON</a> en Juin dernier ont eu raison de mes doutes. Avec son accord et celui de Valérie, je suis donc heureux de vous annoncer que JSol&#8217;Ex 4 est officiellement supporté pour soumettre vos images dans la base de données BASS 2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_un_assistant_pas_à_pas">Un assistant pas à pas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ne souhaitant pas faire les choses à moitié, j&#8217;ai particulièrement peaufiné le logiciel pour simplifier cette procédure. J&#8217;ai souhaité faire les choses avec sérieux, puisqu&#8217;il s&#8217;agit d&#8217;une base de données professionnelle, exploitée par des scientifiques. Ainsi, une chose importante pour moi était de guider l&#8217;utilisateur dans ce processus et de lui faire comprendre l&#8217;importance de la qualité des données, tout en simplifiant le processus de soumission.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/bass2000.jpg" alt="bass2000">
</div>
<div class="title">Figure 1. Assistant de soumission BASS2000</div>
</div>
<div class="paragraph">
<p>Ainsi par exemple, BASS2000 n&#8217;a que très peu de tolérance sur les problèmes d&#8217;orientation de l&#8217;image : il faut que le Nord solaire soit à moins de 1 degré d&#8217;erreur, sinon l&#8217;image sera refusée. L&#8217;assistant intègre donc un outil pour aider à vérifier l&#8217;orientation et corriger les erreurs minimes dues par exemple à une mise en station imparfaite.</p>
</div>
<div class="paragraph">
<p>L&#8217;assistant guidera aussi l&#8217;utilisateur dans son processus de soumission, en lui demandant de bien vérifier toutes les métadonnées associées à l&#8217;observation, et ira jusqu&#8217;à envoyer l&#8217;image sur le serveur FTP de BASS2000 pour validation par les équipes.</p>
</div>
<div class="paragraph">
<p>Je suis particulièrement reconnaissant à Florence CORNU pour son aide afin que les images JSol&#8217;Ex soient acceptées dans la base et je remercie mes beta-testeurs qui ont patiemment testé mes versions de développement pendant l&#8217;été.</p>
</div>
<div class="paragraph">
<p>Je ne vous cache pas qu&#8217;il s&#8217;agit là d&#8217;une forme de reconnaissance de mon travail, des centaines d&#8217;heures passées soirs et week-ends à développer ce logiciel qui rappelons-le est <a href="https://github.com/melix/astro4j">entièrement Open Source et gratuit</a>.</p>
</div>
<div class="paragraph">
<p>Enfin, je ne peux pas m&#8217;arrêter sans vous annoncer une deuxième bonne nouvelle : non seulement vous pourrez utiliser JSol&#8217;Ex pour soumettre vos images acquises avec un Sol&#8217;Ex, mais aussi avec le MLAstro SHG 700, qui devient officiellement supporté dans la base BASS2000 !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changements_dans_linterface">Changements dans l&#8217;interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Pour cette version j&#8217;ai aussi souhaité moderniser un peu l&#8217;interface graphique et la simplifier : avec le nombre de fonctionnalités croissantes arrive ce moment fatidique que tout développeur redoute : que l&#8217;interface ne devienne trop complexe pour les nouveaux utilisateurs et ne parle qu&#8217;aux anciens. J&#8217;ai essayé d&#8217;éviter cet écueil au cours du temps en refusant certaines fonctionnalités trop "de niche", mais sans pouvoir pour autant réussir à avoir une interface totalement claire.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/interface-overview.jpg" alt="interface overview">
</div>
<div class="title">Figure 2. Aperçu des changements d&#8217;interface</div>
</div>
<div class="paragraph">
<p>Cette nouvelle version essaie donc de regrouper les paramètres par sections plus claires, tout en ajoutant des infobulles pour guider les utilisateurs, anciens comme nouveaux, dans cet esprit qui est que le logiciel se doit d&#8217;être le plus didactique possible : j&#8217;essaie, autant que faire se peut, de vous transmettre en tant qu&#8217;utilisateurs ce que moi-même j&#8217;apprends en développant ce logiciel. Un exemple frappant de cette philosophie, c&#8217;est cette fonctionnalité que j&#8217;avais ajoutée qui permet de montrer en cliquant sur le disque solaire, à quelle image il correspond dans le fichier source (une vidéo contenant des spectres).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_détection_dellipse_assistée_par_lutilisateur">Détection d&#8217;ellipse assistée par l&#8217;utilisateur</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je vous parlais un peu plus haut de l&#8217;Atlas des Spectrohéliogrammes. Cet atlas, réalisé par Pál Váradi Nagy, nécessite un travail énorme d&#8217;analyse des données et est réalisé à l&#8217;aide de scripts JSol&#8217;Ex. Cependant, pour certaines longueurs d&#8217;ondes ou pour parfois des images un peu compliquées à traiter, le logiciel peut échouer à détecter correctement les contours du disque solaire. Ceci peut arriver notamment lorsque les images sont peu contrastées ou lorsqu&#8217;il y a des réflexions internes qui biaisent la détection.</p>
</div>
<div class="paragraph">
<p>Afin de résoudre ces cas complexes qui, encore une fois, nuisent à l&#8217;analyse scientifiques, j&#8217;ai ajouté la possibilité d&#8217;aider le logiciel à détecter les contours, et ainsi à obtenir un image solaire bien ronde:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/blog/img/jsolex-4.0/ellipse-detection-assistant.jpg" alt="ellipse detection assistant">
</div>
<div class="title">Figure 3. Détection d&#8217;ellipse assistée par l&#8217;utilisateur</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lia_à_la_rescousse">L&#8217;IA à la rescousse</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Je suis développeur et en tant que tel, sur ce media, il me semblait pertinent d&#8217;ajouter une section sur la façon dont cette version a été développée.</p>
</div>
<div class="paragraph">
<p>Cette version est la première version qui a été développée avec l&#8217;aide de l&#8217;IA, en particulier Claude Code. En effet, les dernières innovations en matière d&#8217;IA agentique sont pour le coup la véritable révolution à venir : autant avant, avoir une IA qui n&#8217;était pas capable de comprendre le contexte, faire des refactorings ou prévoir un plan de développement ne les rendait pas particulièrement utiles, autant les IA à base d&#8217;agents, qui sont capables d&#8217;analyser votre code, appeler des outils de manière autonome et avoir de vraies interactions avec vous sont un "game changer" de mon point de vue.</p>
</div>
<div class="paragraph">
<p>Dans cette version, j&#8217;ai donc utilisé Claude Code (plan Pro) pour m&#8217;aider à faire les refactorings dont j&#8217;avais besoin et m&#8217;assister dans une tâche où je ne suis pas particulièrement à l&#8217;aise : le design d&#8217;interfaces graphiques.</p>
</div>
<div class="paragraph">
<p>De manière générale, ça fonctionne plutôt bien. Très bien même. La capacité de l&#8217;outil à définir un plan d&#8217;implémentation et comprendre les besoins est assez fascinante. Le code généré, en revanche, nécessite toujours beaucoup de review. On pourrait dire que j&#8217;ai l&#8217;impression d&#8217;avoir un (très bon) stagiaire avec moi, en permanence. En tant que développeur senior, je suis assez rapide à identifier là où l&#8217;IA complique les choses inutilement, ou utilise des design pattern dépréciés, ou ne respecte pas les conventions de code. Je serai, par exemple, terrifié si le code original produit était parti en production sans review. Mais, en lui donnant les bonnes directions, en lui expliquant ses erreurs, on arrive rapidement à ce que l&#8217;on souhaite avec la qualité que l&#8217;on souhaite.</p>
</div>
<div class="paragraph">
<p>Quelques exemples de choses qui ne fonctionnent pour le coup vraiment pas bien:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Claude vous demande de créer un fichier CLAUDE.md qui comprend des instructions sur comment compiler votre projet, comment il est organisé, etc. Bref, du contexte qui est systématiquement ajouté à chaque session. Pourtant, à l&#8217;utilisation, Claude ignore allègrement ces instructions.</p>
</li>
<li>
<p>En Java, les fichiers .properties sont encodés en ISO-8859-1, même dans une base où tous les sources sont en UTF-8. C&#8217;est une bizarrerie historique, mais Claude ne la comprend absolument pas. A chaque fois qu&#8217;il modifie mes fichiers properties (qui servent à l&#8217;internationalisation de l&#8217;interface), il casse systématiquement l&#8217;encodage. Pour l&#8217;éviter, le dois systématiquement, avant de lui faire faire une opération dont je sais qu&#8217;elle implique ces fichiers, lui dire "respecte les guidelines du fichier CLAUDE" où je lui ai donné une technique pour éviter les problèmes (convertir le fichier en UTF-8, puis l&#8217;éditer, puis le reconvertir en ISO-8859-1)</p>
</li>
<li>
<p>Les commentaires dans le code. Quand on commence à avoir un peu de bouteille comme moi, il est assez insupportable de lire des commentaires "captain obvious", ce genre de commentaires qui dit "la ligne suivante calcule 1+1". Claude en génère beaucoup. Trop. Et malgré le fait que mon fichier CLAUDE lui interdise explicitement.</p>
</li>
<li>
<p>La confiance en soi. Claude est bien trop optimiste et tend trop à flatter l&#8217;utilisateur. Par exemple, si je lui mens explicitement ("ton algorithme est faux parce que XXX"), il répondra systématiquement "Tu as raison !" sans "réfléchir" (j&#8217;utilise les guillemets avec intention), comme un tic de langage ! Ca devient assez frustrant à la longue, lorsqu&#8217;il ne comprend pas un problème ou complique inutilement l&#8217;implémentation.</p>
</li>
<li>
<p>Les limites : on arrive, sur un projet de la taille de JSol&#8217;Ex, très rapidement aux limites d&#8217;usage même sur un forfait Pro. Si je suis satisfait de ce que ça m&#8217;apporte pour le prix, je ne suis pas prêt à payer les 200€ / mois pour augmenter ces limites. N&#8217;oublions pas que je fais ça sur mon temps libre&#8230;&#8203; je n&#8217;ai aucune obligation de résultat !</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Quoi qu&#8217;il en soit, il s&#8217;agit là d&#8217;avancées qu&#8217;il devient difficile d&#8217;ignorer. Et ceux qui me connaissent savent à quel point je suis critique sur l&#8217;utilisation des IA, les mythes autour de ce qu&#8217;elle est capable de faire et son impact écologique. Néanmoins, une chose est certaine : les dirigeants qui pensent économiser du temps et de l&#8217;argent en virant leurs développeurs pour les remplacer par de l&#8217;IA se mettent une balle dans le pied : elle pose de sérieux problèmes de qualité de code et donc de maintenance, et, avec l&#8217;arrivée des agents, posent de graves problèmes de sécurité (un outil autonome qui décide par lui même s&#8217;il faut vous demander l&#8217;autorisation pour exécuter une commande !"). L&#8217;IA doit être vue comme une aide à la productivité, mais qui doit être cadrée par des gens d&#8217;expérience. Bref, nous sommes à un tournant et je ne suis pas encore bien à l&#8217;aise avec ce que cela implique. Nous n&#8217;avons jamais été aussi près du rêve de gosse que j&#8217;avais d&#8217;IA "autonomes", mais la maturité me force à en avoir peur.</p>
</div>
<div class="paragraph">
<p>Mais nous nous éloignons là du sujet initial et concluons donc ce billet : dites bienvenue à JSol&#8217;Ex 4, consultez la vidéo de présentation ci-dessous et n&#8217;hésitez pas à contribuer !</p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/4SPKsNvnzKo?si=KuqIIMc1H6SLgVec" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>
</div></p>
	
	<hr />
	
	<p>Older posts are available in the <a href="/blog/archive.html">archive</a>.</p>

		</div>
		<div id="push"></div>
    </div>
    
    <div id="footer">
      <div class="container">
	<p class="muted credit">All posts on this blog are published with a <em>Creative Commons by-nc-sa</em> license.<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/2.0/fr/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/2.0/fr/88x31.png"/></a></p>
        <p class="muted credit">Baked with <a href="https://jbake.org">JBake v2.6.6</a></p>
      </div>
    </div>
    
    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    
    <script src="/blog/js/jquery-1.11.1.min.js"></script>
    <script src="/blog/js/bootstrap.min.js"></script>
   <script>hljs.highlightAll();</script>
  </body>
</html>
